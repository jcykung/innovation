<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Unit Conversion Tutor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@18",
          "react-dom": "https://esm.sh/react-dom@18",
          "react-dom/client": "https://esm.sh/react-dom@18/client",
          "lucide-react": "https://esm.sh/lucide-react@0.263.1?external=react",
          "recharts": "https://esm.sh/recharts?external=react,react-dom",
          "mathjs": "https://esm.sh/mathjs",
          "lodash": "https://esm.sh/lodash",
          "d3": "https://esm.sh/d3",
          "plotly": "https://esm.sh/plotly.js",
          "three": "https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.module.min.js",
          "papaparse": "https://esm.sh/papaparse",
          "xlsx": "https://esm.sh/xlsx",
          "@/components/ui/alert": "https://esm.sh/@radix-ui/react-alert-dialog",
          "chart.js": "https://esm.sh/chart.js",
          "tone": "https://esm.sh/tone",
          "mammoth": "https://esm.sh/mammoth",
          "tensorflow": "https://esm.sh/@tensorflow/tfjs"
        }
      }
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module">
      const encodedReactCode =
        "CiAgICBjb25zdCBfanN4RmlsZU5hbWUgPSAiIjsgZnVuY3Rpb24gX29wdGlvbmFsQ2hhaW4ob3BzKSB7IGxldCBsYXN0QWNjZXNzTEhTID0gdW5kZWZpbmVkOyBsZXQgdmFsdWUgPSBvcHNbMF07IGxldCBpID0gMTsgd2hpbGUgKGkgPCBvcHMubGVuZ3RoKSB7IGNvbnN0IG9wID0gb3BzW2ldOyBjb25zdCBmbiA9IG9wc1tpICsgMV07IGkgKz0gMjsgaWYgKChvcCA9PT0gJ29wdGlvbmFsQWNjZXNzJyB8fCBvcCA9PT0gJ29wdGlvbmFsQ2FsbCcpICYmIHZhbHVlID09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBpZiAob3AgPT09ICdhY2Nlc3MnIHx8IG9wID09PSAnb3B0aW9uYWxBY2Nlc3MnKSB7IGxhc3RBY2Nlc3NMSFMgPSB2YWx1ZTsgdmFsdWUgPSBmbih2YWx1ZSk7IH0gZWxzZSBpZiAob3AgPT09ICdjYWxsJyB8fCBvcCA9PT0gJ29wdGlvbmFsQ2FsbCcpIHsgdmFsdWUgPSBmbigoLi4uYXJncykgPT4gdmFsdWUuY2FsbChsYXN0QWNjZXNzTEhTLCAuLi5hcmdzKSk7IGxhc3RBY2Nlc3NMSFMgPSB1bmRlZmluZWQ7IH0gfSByZXR1cm4gdmFsdWU7IH1pbXBvcnQgUmVhY3QsIHsgdXNlU3RhdGUsIHVzZUVmZmVjdCwgdXNlUmVmLCB1c2VNZW1vLCB1c2VDYWxsYmFjayB9IGZyb20gJ3JlYWN0JzsNCg0KLy8gLS0tIEljb24gQ29tcG9uZW50cyAoTHVjaWRlLVJlYWN0KSAtLS0NCi8vIFVzaW5nIGlubGluZSBTVkdzIHRvIGF2b2lkIGV4dGVybmFsIGRlcGVuZGVuY2llcw0KY29uc3QgQ2hlY2sgPSAocHJvcHMpID0+ICgNCiAgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3ZnJywgeyB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiwgd2lkdGg6ICIyNCIsIGhlaWdodDogIjI0Iiwgdmlld0JveDogIjAgMCAyNCAyNCIgICAsIGZpbGw6ICJub25lIiwgc3Ryb2tlOiAiY3VycmVudENvbG9yIiwgc3Ryb2tlV2lkdGg6ICIyIiwgc3Ryb2tlTGluZWNhcDogInJvdW5kIiwgc3Ryb2tlTGluZWpvaW46ICJyb3VuZCIsIC4uLnByb3BzLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNn19CiAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3BvbHlsaW5lJywgeyBwb2ludHM6ICIyMCA2IDkgMTcgNCAxMiIgICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDd9fSkKICApDQopOw0KY29uc3QgWCA9IChwcm9wcykgPT4gKA0KICBSZWFjdC5jcmVhdGVFbGVtZW50KCdzdmcnLCB7IHhtbG5zOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLCB3aWR0aDogIjI0IiwgaGVpZ2h0OiAiMjQiLCB2aWV3Qm94OiAiMCAwIDI0IDI0IiAgICwgZmlsbDogIm5vbmUiLCBzdHJva2U6ICJjdXJyZW50Q29sb3IiLCBzdHJva2VXaWR0aDogIjIiLCBzdHJva2VMaW5lY2FwOiAicm91bmQiLCBzdHJva2VMaW5lam9pbjogInJvdW5kIiwgLi4ucHJvcHMsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMX19CiAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2xpbmUnLCB7IHgxOiAiMTgiLCB5MTogIjYiLCB4MjogIjYiLCB5MjogIjE4IiwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEyfX0pCiAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2xpbmUnLCB7IHgxOiAiNiIsIHkxOiAiNiIsIHgyOiAiMTgiLCB5MjogIjE4IiwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEzfX0pCiAgKQ0KKTsNCmNvbnN0IFJlZnJlc2hDdyA9IChwcm9wcykgPT4gKA0KICBSZWFjdC5jcmVhdGVFbGVtZW50KCdzdmcnLCB7IHhtbG5zOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLCB3aWR0aDogIjI0IiwgaGVpZ2h0OiAiMjQiLCB2aWV3Qm94OiAiMCAwIDI0IDI0IiAgICwgZmlsbDogIm5vbmUiLCBzdHJva2U6ICJjdXJyZW50Q29sb3IiLCBzdHJva2VXaWR0aDogIjIiLCBzdHJva2VMaW5lY2FwOiAicm91bmQiLCBzdHJva2VMaW5lam9pbjogInJvdW5kIiwgLi4ucHJvcHMsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxN319CiAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3BhdGgnLCB7IGQ6ICJNMyAydjZoNiIgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTh9fSkKICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncGF0aCcsIHsgZDogIk0yMSAxMkE5IDkgMCAwIDAgNiA1LjNMMyA4IiAgICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTl9fSkKICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncGF0aCcsIHsgZDogIk0yMSAyMnYtNmgtNiIgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMjB9fSkKICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncGF0aCcsIHsgZDogIk0zIDEyYTkgOSAwIDAgMCAxNSA2LjdsMy0yLjciICAgICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDIxfX0pCiAgKQ0KKTsNCmNvbnN0IExpZ2h0YnVsYiA9IChwcm9wcykgPT4gKA0KICBSZWFjdC5jcmVhdGVFbGVtZW50KCdzdmcnLCB7IHhtbG5zOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLCB3aWR0aDogIjI0IiwgaGVpZ2h0OiAiMjQiLCB2aWV3Qm94OiAiMCAwIDI0IDI0IiAgICwgZmlsbDogIm5vbmUiLCBzdHJva2U6ICJjdXJyZW50Q29sb3IiLCBzdHJva2VXaWR0aDogIjIiLCBzdHJva2VMaW5lY2FwOiAicm91bmQiLCBzdHJva2VMaW5lam9pbjogInJvdW5kIiwgLi4ucHJvcHMsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAyNX19CiAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3BhdGgnLCB7IGQ6ICJNOSAxOGg2IiAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAyNn19KQogICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdwYXRoJywgeyBkOiAiTTEwIDIyaDQiICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDI3fX0pCiAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3BhdGgnLCB7IGQ6ICJNMTIgMmE3IDcgMCAwIDAtNyA3YzAgMyAyIDUgMiA3aDEwYzAtMiAyLTQgMi03YTcgNyAwIDAgMC03LTd6IiAgICAgICAgICAgICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMjh9fSkKICApDQopOw0KY29uc3QgVHJvcGh5ID0gKHByb3BzKSA9PiAoDQogIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3N2ZycsIHsgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsIHdpZHRoOiAiMjQiLCBoZWlnaHQ6ICIyNCIsIHZpZXdCb3g6ICIwIDAgMjQgMjQiICAgLCBmaWxsOiAibm9uZSIsIHN0cm9rZTogImN1cnJlbnRDb2xvciIsIHN0cm9rZVdpZHRoOiAiMiIsIHN0cm9rZUxpbmVjYXA6ICJyb3VuZCIsIHN0cm9rZUxpbmVqb2luOiAicm91bmQiLCAuLi5wcm9wcywgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDMyfX0KICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncGF0aCcsIHsgZDogIk02IDlINC41YTIuNSAyLjUgMCAwIDEgMC01SDYiICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMzN9fSkKICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncGF0aCcsIHsgZDogIk0xOCA5aDEuNWEyLjUgMi41IDAgMCAwIDAtNUgxOCIgICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAzNH19KQogICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdwYXRoJywgeyBkOiAiTTQgMjJoMTYiICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDM1fX0pCiAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3BhdGgnLCB7IGQ6ICJNMTAgMTQuNjZWMTdjMCAuNTUtLjQ3Ljk4LTEuMDcgMS4yOFM3LjQgMTguNzggNyAxOUg2Yy0xLjEgMC0yLS45LTItMnYtMy4zNCIgICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMzZ9fSkKICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncGF0aCcsIHsgZDogIk0xNCAxNC42NlYxN2MwIC41NS40Ny45OCAxLjA3IDEuMjhTMTYuNiAxOC43OCAxNyAxOWgxYzEuMSAwIDItLjkgMi0ydi0zLjM0IiAgICAgICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAzN319KQogICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdwYXRoJywgeyBkOiAiTTE4IDRINnY1YTYgNiAwIDAgMCAxMiAwVjR6IiAgICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAzOH19KQogICkNCik7DQpjb25zdCBDaGV2cm9uUmlnaHQgPSAocHJvcHMpID0+ICgNCiAgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3ZnJywgeyB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiwgd2lkdGg6ICIyNCIsIGhlaWdodDogIjI0Iiwgdmlld0JveDogIjAgMCAyNCAyNCIgICAsIGZpbGw6ICJub25lIiwgc3Ryb2tlOiAiY3VycmVudENvbG9yIiwgc3Ryb2tlV2lkdGg6ICIyIiwgc3Ryb2tlTGluZWNhcDogInJvdW5kIiwgc3Ryb2tlTGluZWpvaW46ICJyb3VuZCIsIC4uLnByb3BzLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNDJ9fQogICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdwYXRoJywgeyBkOiAibTkgMTggNi02LTYtNiIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDQzfX0pCiAgKQ0KKTsNCmNvbnN0IENoZXZyb25MZWZ0ID0gKHByb3BzKSA9PiAoDQogIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3N2ZycsIHsgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsIHdpZHRoOiAiMjQiLCBoZWlnaHQ6ICIyNCIsIHZpZXdCb3g6ICIwIDAgMjQgMjQiICAgLCBmaWxsOiAibm9uZSIsIHN0cm9rZTogImN1cnJlbnRDb2xvciIsIHN0cm9rZVdpZHRoOiAiMiIsIHN0cm9rZUxpbmVjYXA6ICJyb3VuZCIsIHN0cm9rZUxpbmVqb2luOiAicm91bmQiLCAuLi5wcm9wcywgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDQ3fX0KICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncGF0aCcsIHsgZDogIm0xNSAxOC02LTYgNi02IiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNDh9fSkKICApDQopOw0KLy8gUmVtb3ZlZCBTdW4vTW9vbiBpY29ucyBhcyBkYXJrIG1vZGUgaXMgbG9ja2VkDQoNCi8vIC0tLSBSZWFjdCBDb21wb25lbnRzIC0tLQ0KDQovLyBUYWIgMTogU2Vuc2Ugb2YgU2NhbGUNCmNvbnN0IFNlbnNlT2ZTY2FsZVRhYiA9ICgpID0+IHsNCiAgY29uc3QgW2N1cnJlbnRBY3Rpdml0eSwgc2V0Q3VycmVudEFjdGl2aXR5XSA9IHVzZVN0YXRlKDEpOw0KICBjb25zdCBbc2VsZWN0ZWRBbnN3ZXJzLCBzZXRTZWxlY3RlZEFuc3dlcnNdID0gdXNlU3RhdGUoe30pOw0KICBjb25zdCBbZmVlZGJhY2ssIHNldEZlZWRiYWNrXSA9IHVzZVN0YXRlKHt9KTsNCiAgLy8gUmVtb3ZlZCBzaG93UmVzdWx0cyBzdGF0ZSBhcyBmZWVkYmFjayBpcyBpbW1lZGlhdGUgbm93DQogIGNvbnN0IFtjdXJyZW50SXRlbXMsIHNldEN1cnJlbnRJdGVtc10gPSB1c2VTdGF0ZShbXSk7DQogIGNvbnN0IFt1c2VkSXRlbUlkcywgc2V0VXNlZEl0ZW1JZHNdID0gdXNlU3RhdGUoW10pOw0KDQogIC8vIFN0YXRlIGZvciBBY3Rpdml0eSAyDQogIGNvbnN0IFttZWFzdXJlV2lkdGgsIHNldE1lYXN1cmVXaWR0aF0gPSB1c2VTdGF0ZSgwKTsNCiAgY29uc3QgW2lzRHJhZ2dpbmcsIHNldElzRHJhZ2dpbmddID0gdXNlU3RhdGUoZmFsc2UpOw0KICBjb25zdCBbc3RhcnRYLCBzZXRTdGFydFhdID0gdXNlU3RhdGUoMCk7DQogIGNvbnN0IFtyb29tTWVhc3VyZWQsIHNldFJvb21NZWFzdXJlZF0gPSB1c2VTdGF0ZShmYWxzZSk7DQogIGNvbnN0IFttZWFzdXJlRmVlZGJhY2ssIHNldE1lYXN1cmVGZWVkYmFja10gPSB1c2VTdGF0ZShudWxsKTsNCiAgY29uc3Qgcm9vbVJlZiA9IHVzZVJlZihudWxsKTsNCg0KICAvLyBVc2UgdXNlTWVtbyBmb3IgYWxsSXRlbXMgdG8gcHJldmVudCByZS1jcmVhdGlvbg0KICBjb25zdCBhbGxJdGVtcyA9IHVzZU1lbW8oKCkgPT4gWw0KICAgIHsNCiAgICAgIGlkOiAxLA0KICAgICAgbmFtZTogJ1RoaWNrbmVzcyBvZiBhIHBob25lJywNCiAgICAgIGNvcnJlY3Q6ICdtbScsDQogICAgICBpbWFnZTogJ/Cfk7EnLA0KICAgICAgY29ycmVjdFZhbHVlOiAnOCBtbScsDQogICAgICB0eXBlOiAnZGlzdGFuY2UnLA0KICAgICAgd3JvbmdGZWVkYmFjazogew0KICAgICAgICBjbTogeyB2YWx1ZTogJzAuOCBjbScsIHJlYXNvbjogJ0F3a3dhcmQgZGVjaW1hbCAtIG5vdCBhcyBjbGVhciBhcyA4IG1tJyB9LA0KICAgICAgICBtOiB7IHZhbHVlOiAnMC4wMDggbScsIHJlYXNvbjogJ1dheSB0b28gbWFueSB6ZXJvcyAtIGhhcmQgdG8gcGljdHVyZSEnIH0sDQogICAgICAgIGttOiB7IHZhbHVlOiAnMC4wMDAwMDgga20nLCByZWFzb246ICdSaWRpY3Vsb3VzbHkgdGlueSBudW1iZXIgLSBpbXBvc3NpYmxlIHRvIHZpc3VhbGl6ZSEnIH0NCiAgICAgIH0NCiAgICB9LA0KICAgIHsNCiAgICAgIGlkOiAyLA0KICAgICAgbmFtZTogJ0hlaWdodCBvZiBhIHBlcnNvbicsDQogICAgICBjb3JyZWN0OiAnY20nLA0KICAgICAgaW1hZ2U6ICfwn6eNJywNCiAgICAgIGNvcnJlY3RWYWx1ZTogJzE3MCBjbScsDQogICAgICB0eXBlOiAnZGlzdGFuY2UnLA0KICAgICAgd3JvbmdGZWVkYmFjazogew0KICAgICAgICBtbTogeyB2YWx1ZTogJzE3MDAgbW0nLCByZWFzb246ICdUb28gbWFueSBkaWdpdHMgLSBoYXJkZXIgdG8gcmVhZCB0aGFuIDE3MCBjbScgfSwNCiAgICAgICAgbTogeyB2YWx1ZTogJzEuNyBtJywgcmVhc29uOiAnV29ya3MsIGJ1dCAxNzAgY20gaXMgbW9yZSBjb21tb25seSB1c2VkIGZvciBoZWlnaHQnIH0sDQogICAgICAgIGttOiB7IHZhbHVlOiAnMC4wMDE3IGttJywgcmVhc29uOiAnV2F5IHRvbyBzbWFsbCAtIG5vYm9keSBtZWFzdXJlcyBoZWlnaHQgaW4ga20hJyB9DQogICAgICB9DQogICAgfSwNCiAgICB7DQogICAgICBpZDogMywNCiAgICAgIG5hbWU6ICdEaXN0YW5jZSB0byBzY2hvb2wnLA0KICAgICAgY29ycmVjdDogJ2ttJywNCiAgICAgIGltYWdlOiAn8J+PqycsDQogICAgICBjb3JyZWN0VmFsdWU6ICcyIGttJywNCiAgICAgIHR5cGU6ICdkaXN0YW5jZScsDQogICAgICB3cm9uZ0ZlZWRiYWNrOiB7DQogICAgICAgIG1tOiB7IHZhbHVlOiAnMiwwMDAsMDAwIG1tJywgcmVhc29uOiAnSHVnZSBudW1iZXIgLSBpbXBvc3NpYmxlIHRvIGltYWdpbmUhJyB9LA0KICAgICAgICBjbTogeyB2YWx1ZTogJzIwMCwwMDAgY20nLCByZWFzb246ICdTdGlsbCB0b28gbGFyZ2UgYSBudW1iZXIgdG8gYmUgcHJhY3RpY2FsIScgfSwNCiAgICAgICAgbTogeyB2YWx1ZTogJzIwMDAgbScsIHJlYXNvbjogJ0JpZyBudW1iZXIgLSBtdWNoIG5pY2VyIGFzIDIga20hJyB9DQogICAgICB9DQogICAgfSwNCiAgICB7DQogICAgICBpZDogNCwNCiAgICAgIG5hbWU6ICdMZW5ndGggb2YgYSBwZW4nLA0KICAgICAgY29ycmVjdDogJ2NtJywNCiAgICAgIGltYWdlOiAn4pyP77iPJywNCiAgICAgIGNvcnJlY3RWYWx1ZTogJzE1IGNtJywNCiAgICAgIHR5cGU6ICdkaXN0YW5jZScsDQogICAgICB3cm9uZ0ZlZWRiYWNrOiB7DQogICAgICAgIG1tOiB7IHZhbHVlOiAnMTUwIG1tJywgcmVhc29uOiAnV29ya3MgYnV0IGNtIGlzIG1vcmUgc3RhbmRhcmQgZm9yIHBlbiBsZW5ndGgnIH0sDQogICAgICAgIG06IHsgdmFsdWU6ICcwLjE1IG0nLCByZWFzb246ICdBd2t3YXJkIGRlY2ltYWwgLSBub3QgYXMgY2xlYXIgYXMgMTUgY20nIH0sDQogICAgICAgIGttOiB7IHZhbHVlOiAnMC4wMDAxNSBrbScsIHJlYXNvbjogJ0Fic3VyZGx5IHNtYWxsIG51bWJlciEnIH0NCiAgICAgIH0NCiAgICB9LA0KICAgIHsNCiAgICAgIGlkOiA1LA0KICAgICAgbmFtZTogJ01lZGljaW5lIGRvc2UnLA0KICAgICAgY29ycmVjdDogJ21nJywNCiAgICAgIGltYWdlOiAn8J+SiicsDQogICAgICBjb3JyZWN0VmFsdWU6ICc1MDAgbWcnLA0KICAgICAgdHlwZTogJ21hc3MnLA0KICAgICAgd3JvbmdGZWVkYmFjazogew0KICAgICAgICBnOiB7IHZhbHVlOiAnMC41IGcnLCByZWFzb246ICdEZWNpbWFsIG1ha2VzIGl0IGxlc3MgY2xlYXIgdGhhbiA1MDAgbWcnIH0sDQogICAgICAgIGtnOiB7IHZhbHVlOiAnMC4wMDA1IGtnJywgcmVhc29uOiAnV2F5IHRvbyBzbWFsbCAtIGltcG9zc2libGUgdG8gd29yayB3aXRoIScgfSwNCiAgICAgICAgbUw6IHsgdmFsdWU6ICdOL0EnLCByZWFzb246ICdUaGF0IG1lYXN1cmVzIHZvbHVtZSwgbm90IG1hc3MhJyB9DQogICAgICB9DQogICAgfSwNCiAgICB7DQogICAgICBpZDogNiwNCiAgICAgIG5hbWU6ICdDb29raW5nIG9pbCBpbiByZWNpcGUnLA0KICAgICAgY29ycmVjdDogJ21MJywNCiAgICAgIGltYWdlOiAn8J+niCcsDQogICAgICBjb3JyZWN0VmFsdWU6ICcyNTAgbUwnLA0KICAgICAgdHlwZTogJ3ZvbHVtZScsDQogICAgICB3cm9uZ0ZlZWRiYWNrOiB7DQogICAgICAgIEw6IHsgdmFsdWU6ICcwLjI1IEwnLCByZWFzb246ICdBd2t3YXJkIGRlY2ltYWwgLSBlYXNpZXIgdG8gc2F5IDI1MCBtTCcgfSwNCiAgICAgICAgbWc6IHsgdmFsdWU6ICdOL0EnLCByZWFzb246ICdUaGF0IG1lYXN1cmVzIG1hc3MsIG5vdCB2b2x1bWUhJyB9LA0KICAgICAgICBnOiB7IHZhbHVlOiAnTi9BJywgcmVhc29uOiAnTGlxdWlkcyBhcmUgbWVhc3VyZWQgYnkgdm9sdW1lIGluIGNvb2tpbmchJyB9DQogICAgICB9DQogICAgfSwNCiAgICB7DQogICAgICBpZDogNywNCiAgICAgIG5hbWU6ICdNYXJhdGhvbiB0aW1lJywNCiAgICAgIGNvcnJlY3Q6ICdob3VycycsDQogICAgICBpbWFnZTogJ/Cfj4MnLA0KICAgICAgY29ycmVjdFZhbHVlOiAnMyBob3VycycsDQogICAgICB0eXBlOiAndGltZScsDQogICAgICB3cm9uZ0ZlZWRiYWNrOiB7DQogICAgICAgIHNlY29uZHM6IHsgdmFsdWU6ICcxMCw4MDAgc2Vjb25kcycsIHJlYXNvbjogJ0h1Z2UgbnVtYmVyIC0gdG9vIGhhcmQgdG8gcGljdHVyZSEnIH0sDQogICAgICAgIG1pbnV0ZXM6IHsgdmFsdWU6ICcxODAgbWludXRlcycsIHJlYXNvbjogJ0xhcmdlIG51bWJlciAtIG11Y2ggY2xlYXJlciBhcyAzIGhvdXJzJyB9LA0KICAgICAgICBkYXlzOiB7IHZhbHVlOiAnMC4xMjUgZGF5cycsIHJlYXNvbjogJ1dlaXJkIGRlY2ltYWwgLSBub3QgcHJhY3RpY2FsIScgfSwNCiAgICAgICAgbXM6IHsgdmFsdWU6ICcxMCw4MDAsMDAwIG1zJywgcmVhc29uOiAnQWJzdXJkbHkgaHVnZSBudW1iZXIhJyB9DQogICAgICB9DQogICAgfSwNCiAgICB7DQogICAgICBpZDogOCwNCiAgICAgIG5hbWU6ICdCbGluayBvZiBhbiBleWUnLA0KICAgICAgY29ycmVjdDogJ21zJywNCiAgICAgIGltYWdlOiAn8J+Rge+4jycsDQogICAgICBjb3JyZWN0VmFsdWU6ICczMDAgbXMnLA0KICAgICAgdHlwZTogJ3RpbWUnLA0KICAgICAgd3JvbmdGZWVkYmFjazogew0KICAgICAgICBzZWNvbmRzOiB7IHZhbHVlOiAnMC4zIHNlY29uZHMnLCByZWFzb246ICdEZWNpbWFsIC0gbWlsbGlzZWNvbmRzIGFyZSBtb3JlIHByZWNpc2UnIH0sDQogICAgICAgIG1pbnV0ZXM6IHsgdmFsdWU6ICcwLjAwNSBtaW51dGVzJywgcmVhc29uOiAnQWJzdXJkbHkgc21hbGwgZGVjaW1hbCEnIH0sDQogICAgICAgIGhvdXJzOiB7IHZhbHVlOiAnMC4wMDAwODMgaG91cnMnLCByZWFzb246ICdJbXBvc3NpYmxlIHRvIHZpc3VhbGl6ZSEnIH0sDQogICAgICAgIGRheXM6IHsgdmFsdWU6ICcwLjAwMDAwMzUgZGF5cycsIHJlYXNvbjogJ1JpZGljdWxvdXNseSB0aW55IG51bWJlciEnIH0NCiAgICAgIH0NCiAgICB9LA0KICAgIHsNCiAgICAgIGlkOiA5LA0KICAgICAgbmFtZTogJ1dpZHRoIG9mIGEgZmluZ2VybmFpbCcsDQogICAgICBjb3JyZWN0OiAnbW0nLA0KICAgICAgaW1hZ2U6ICfwn5KFJywNCiAgICAgIGNvcnJlY3RWYWx1ZTogJzEwIG1tJywNCiAgICAgIHR5cGU6ICdkaXN0YW5jZScsDQogICAgICB3cm9uZ0ZlZWRiYWNrOiB7DQogICAgICAgIGNtOiB7IHZhbHVlOiAnMSBjbScsIHJlYXNvbjogJ1dvcmtzLCBidXQgbW0gaXMgbW9yZSBwcmVjaXNlIGZvciBzbWFsbCBpdGVtcycgfSwNCiAgICAgICAgbTogeyB2YWx1ZTogJzAuMDEgbScsIHJlYXNvbjogJ1RpbnkgZGVjaW1hbCAtIGhhcmQgdG8gdmlzdWFsaXplIScgfSwNCiAgICAgICAga206IHsgdmFsdWU6ICcwLjAwMDAxIGttJywgcmVhc29uOiAnQWJzdXJkbHkgc21hbGwgbnVtYmVyIScgfQ0KICAgICAgfQ0KICAgIH0sDQogICAgew0KICAgICAgaWQ6IDEwLA0KICAgICAgbmFtZTogJ1dlaWdodCBvZiBhIGNhcicsDQogICAgICBjb3JyZWN0OiAna2cnLA0KICAgICAgaW1hZ2U6ICfwn5qXJywNCiAgICAgIGNvcnJlY3RWYWx1ZTogJzE1MDAga2cnLA0KICAgICAgdHlwZTogJ21hc3MnLA0KICAgICAgd3JvbmdGZWVkYmFjazogew0KICAgICAgICBtZzogeyB2YWx1ZTogJzEsNTAwLDAwMCwwMDAgbWcnLCByZWFzb246ICdJbXBvc3NpYmx5IGh1Z2UgbnVtYmVyIScgfSwNCiAgICAgICAgZzogeyB2YWx1ZTogJzEsNTAwLDAwMCBnJywgcmVhc29uOiAnU3RpbGwgd2F5IHRvbyBtYW55IGRpZ2l0cyEnIH0NCiAgICAgIH0NCiAgICB9LA0KICAgIHsNCiAgICAgIGlkOiAxMSwNCiAgICAgIG5hbWU6ICdNb3ZpZSBydW50aW1lJywNCiAgICAgIGNvcnJlY3Q6ICdtaW51dGVzJywNCiAgICAgIGltYWdlOiAn8J+OrCcsDQogICAgICBjb3JyZWN0VmFsdWU6ICcxMjAgbWludXRlcycsDQogICAgICB0eXBlOiAndGltZScsDQogICAgICB3cm9uZ0ZlZWRiYWNrOiB7DQogICAgICAgIHNlY29uZHM6IHsgdmFsdWU6ICc3MjAwIHNlY29uZHMnLCByZWFzb246ICdMYXJnZSBudW1iZXIgLSBlYXNpZXIgYXMgMTIwIG1pbnV0ZXMnIH0sDQogICAgICAgIGhvdXJzOiB7IHZhbHVlOiAnMiBob3VycycsIHJlYXNvbjogJ1dvcmtzIHdlbGwgdG9vISBNaW51dGVzIGFyZSBhbHNvIGNvbW1vbicgfSwNCiAgICAgICAgbXM6IHsgdmFsdWU6ICc3LDIwMCwwMDAgbXMnLCByZWFzb246ICdBYnN1cmRseSBodWdlIG51bWJlciEnIH0sDQogICAgICAgIGRheXM6IHsgdmFsdWU6ICcwLjA4MyBkYXlzJywgcmVhc29uOiAnU3RyYW5nZSBkZWNpbWFsIScgfQ0KICAgICAgfQ0KICAgIH0sDQogICAgew0KICAgICAgaWQ6IDEyLA0KICAgICAgbmFtZTogJ1N3aW1taW5nIHBvb2wgdm9sdW1lJywNCiAgICAgIGNvcnJlY3Q6ICdMJywNCiAgICAgIGltYWdlOiAn8J+PiicsDQogICAgICBjb3JyZWN0VmFsdWU6ICc1MDAwMCBMJywNCiAgICAgIHR5cGU6ICd2b2x1bWUnLA0KICAgICAgd3JvbmdGZWVkYmFjazogew0KICAgICAgICBtTDogeyB2YWx1ZTogJzUwLDAwMCwwMDAgbUwnLCByZWFzb246ICdXYXkgdG9vIG1hbnkgemVyb3MhJyB9DQogICAgICB9DQogICAgfSwNCiAgICB7DQogICAgICBpZDogMTMsDQogICAgICBuYW1lOiAnRXJhc2VyIHRoaWNrbmVzcycsDQogICAgICBjb3JyZWN0OiAnbW0nLA0KICAgICAgaW1hZ2U6ICfwn6e9JywNCiAgICAgIGNvcnJlY3RWYWx1ZTogJzEyIG1tJywNCiAgICAgIHR5cGU6ICdkaXN0YW5jZScsDQogICAgICB3cm9uZ0ZlZWRiYWNrOiB7DQogICAgICAgIGNtOiB7IHZhbHVlOiAnMS4yIGNtJywgcmVhc29uOiAnRGVjaW1hbCBtYWtlcyBpdCBsZXNzIGNsZWFyIHRoYW4gMTIgbW0nIH0sDQogICAgICAgIG06IHsgdmFsdWU6ICcwLjAxMiBtJywgcmVhc29uOiAnVG9vIG1hbnkgemVyb3MhJyB9LA0KICAgICAgICBrbTogeyB2YWx1ZTogJzAuMDAwMDEyIGttJywgcmVhc29uOiAnUmlkaWN1bG91c2x5IHRpbnkhJyB9DQogICAgICB9DQogICAgfSwNCiAgICB7DQogICAgICBpZDogMTQsDQogICAgICBuYW1lOiAnU2xlZXBpbmcgdGltZScsDQogICAgICBjb3JyZWN0OiAnaG91cnMnLA0KICAgICAgaW1hZ2U6ICfwn5i0JywNCiAgICAgIGNvcnJlY3RWYWx1ZTogJzggaG91cnMnLA0KICAgICAgdHlwZTogJ3RpbWUnLA0KICAgICAgd3JvbmdGZWVkYmFjazogew0KICAgICAgICBzZWNvbmRzOiB7IHZhbHVlOiAnMjgsODAwIHNlY29uZHMnLCByZWFzb246ICdIdWdlIG51bWJlciAtIGltcG9zc2libGUgdG8gcGljdHVyZSEnIH0sDQogICAgICAgIG1pbnV0ZXM6IHsgdmFsdWU6ICc0ODAgbWludXRlcycsIHJlYXNvbjogJ0xhcmdlIG51bWJlciAtIGJldHRlciBhcyA4IGhvdXJzIScgfSwNCiAgICAgICAgbXM6IHsgdmFsdWU6ICcyOCw4MDAsMDAwIG1zJywgcmVhc29uOiAnQWJzdXJkbHkgaHVnZSEnIH0sDQogICAgICAgIGRheXM6IHsgdmFsdWU6ICcwLjMzIGRheXMnLCByZWFzb246ICdXZWlyZCBmcmFjdGlvbiEnIH0NCiAgICAgIH0NCiAgICB9LA0KICAgIHsNCiAgICAgIGlkOiAxNSwNCiAgICAgIG5hbWU6ICdXZWlnaHQgb2YgYW4gYXBwbGUnLA0KICAgICAgY29ycmVjdDogJ2cnLA0KICAgICAgaW1hZ2U6ICfwn42OJywNCiAgICAgIGNvcnJlY3RWYWx1ZTogJzE4MCBnJywNCiAgICAgIHR5cGU6ICdtYXNzJywNCiAgICAgIHdyb25nRmVlZGJhY2s6IHsNCiAgICAgICAgbWc6IHsgdmFsdWU6ICcxODAsMDAwIG1nJywgcmVhc29uOiAnVG9vIG1hbnkgZGlnaXRzIScgfSwNCiAgICAgICAga2c6IHsgdmFsdWU6ICcwLjE4IGtnJywgcmVhc29uOiAnQXdrd2FyZCBkZWNpbWFsIC0gZWFzaWVyIGFzIDE4MCBnJyB9DQogICAgICB9DQogICAgfSwNCiAgXSwgW10pOw0KDQogIC8vIFVzZSB1c2VDYWxsYmFjayBmb3IgZnVuY3Rpb25zDQogIGNvbnN0IGdlbmVyYXRlTmV3RXhhbXBsZXMgPSB1c2VDYWxsYmFjaygoKSA9PiB7DQogICAgLy8gR2V0IGl0ZW1zIHRoYXQgaGF2ZW4ndCBiZWVuIHVzZWQgeWV0DQogICAgY29uc3QgYXZhaWxhYmxlSXRlbXMgPSBhbGxJdGVtcy5maWx0ZXIoaXRlbSA9PiAhdXNlZEl0ZW1JZHMuaW5jbHVkZXMoaXRlbS5pZCkpOw0KDQogICAgLy8gSWYgd2UndmUgdXNlZCBhbGwgaXRlbXMsIHJlc2V0IHRoZSB1c2VkIGxpc3QNCiAgICBpZiAoYXZhaWxhYmxlSXRlbXMubGVuZ3RoIDwgMykgew0KICAgICAgc2V0VXNlZEl0ZW1JZHMoW10pOw0KICAgICAgY29uc3Qgc2h1ZmZsZWQgPSBbLi4uYWxsSXRlbXNdLnNvcnQoKCkgPT4gTWF0aC5yYW5kb20oKSAtIDAuNSk7DQogICAgICBjb25zdCBzZWxlY3RlZCA9IHNodWZmbGVkLnNsaWNlKDAsIDMpOw0KICAgICAgc2V0Q3VycmVudEl0ZW1zKHNlbGVjdGVkKTsNCiAgICAgIHNldFVzZWRJdGVtSWRzKHNlbGVjdGVkLm1hcChpdGVtID0+IGl0ZW0uaWQpKTsNCiAgICB9IGVsc2Ugew0KICAgICAgLy8gU2h1ZmZsZSBhdmFpbGFibGUgaXRlbXMgYW5kIHRha2UgMw0KICAgICAgY29uc3Qgc2h1ZmZsZWQgPSBbLi4uYXZhaWxhYmxlSXRlbXNdLnNvcnQoKCkgPT4gTWF0aC5yYW5kb20oKSAtIDAuNSk7DQogICAgICBjb25zdCBzZWxlY3RlZCA9IHNodWZmbGVkLnNsaWNlKDAsIDMpOw0KICAgICAgc2V0Q3VycmVudEl0ZW1zKHNlbGVjdGVkKTsNCiAgICAgIHNldFVzZWRJdGVtSWRzKHByZXYgPT4gWy4uLnByZXYsIC4uLnNlbGVjdGVkLm1hcChpdGVtID0+IGl0ZW0uaWQpXSk7DQogICAgfQ0KDQogICAgc2V0U2VsZWN0ZWRBbnN3ZXJzKHt9KTsNCiAgICBzZXRGZWVkYmFjayh7fSk7DQogICAgLy9zZXRTaG93UmVzdWx0cyhmYWxzZSk7IC8vIFJlbW92ZWQNCiAgfSwgW2FsbEl0ZW1zLCB1c2VkSXRlbUlkc10pOw0KDQogIC8vIEluaXRpYWxpemUgd2l0aCByYW5kb20gMyBpdGVtcyBvbiBmaXJzdCBsb2FkDQogIHVzZUVmZmVjdCgoKSA9PiB7DQogICAgaWYgKGN1cnJlbnRJdGVtcy5sZW5ndGggPT09IDApIHsNCiAgICAgIGdlbmVyYXRlTmV3RXhhbXBsZXMoKTsNCiAgICB9DQogIH0sIFtjdXJyZW50SXRlbXMsIGdlbmVyYXRlTmV3RXhhbXBsZXNdKTsNCg0KICBjb25zdCB1bml0T3B0aW9ucyA9IHVzZU1lbW8oKCkgPT4gKHsNCiAgICBkaXN0YW5jZTogWydtbScsICdjbScsICdtJywgJ2ttJ10sDQogICAgbWFzczogWydtZycsICdnJywgJ2tnJ10sDQogICAgdm9sdW1lOiBbJ21MJywgJ0wnXSwNCiAgICB0aW1lOiBbJ21zJywgJ3NlY29uZHMnLCAnbWludXRlcycsICdob3VycycsICdkYXlzJ10NCiAgfSksIFtdKTsNCg0KICBjb25zdCBnZXRVbml0VHlwZSA9IHVzZUNhbGxiYWNrKCh1bml0KSA9PiB7DQogICAgZm9yIChjb25zdCBbdHlwZSwgdW5pdHNdIG9mIE9iamVjdC5lbnRyaWVzKHVuaXRPcHRpb25zKSkgew0KICAgICAgaWYgKHVuaXRzLmluY2x1ZGVzKHVuaXQpKSByZXR1cm4gdHlwZTsNCiAgICB9DQogICAgcmV0dXJuIG51bGw7DQogIH0sIFt1bml0T3B0aW9uc10pOw0KDQogIGNvbnN0IGhhbmRsZUFuc3dlciA9IChpdGVtSWQsIHVuaXQpID0+IHsNCiAgICAvLyBBY3Rpdml0eSAxOiBJbW1lZGlhdGUgZmVlZGJhY2sNCiAgICBjb25zdCBpdGVtID0gY3VycmVudEl0ZW1zLmZpbmQoaSA9PiBpLmlkID09PSBpdGVtSWQpOw0KICAgIHNldFNlbGVjdGVkQW5zd2VycyhwcmV2ID0+ICh7IC4uLnByZXYsIFtpdGVtSWRdOiB1bml0IH0pKTsNCg0KICAgIGNvbnN0IHVuaXRUeXBlID0gZ2V0VW5pdFR5cGUodW5pdCk7DQoNCiAgICAvLyBDaGVjayBpZiB3cm9uZyB0eXBlIG9mIHVuaXQgZW50aXJlbHkNCiAgICBpZiAodW5pdFR5cGUgIT09IGl0ZW0udHlwZSkgew0KICAgICAgY29uc3QgdHlwZU5hbWVzID0gew0KICAgICAgICBkaXN0YW5jZTogJ2Rpc3RhbmNlL2xlbmd0aCcsDQogICAgICAgIG1hc3M6ICdtYXNzL3dlaWdodCcsDQogICAgICAgIHZvbHVtZTogJ3ZvbHVtZScsDQogICAgICAgIHRpbWU6ICd0aW1lJw0KICAgICAgfTsNCiAgICAgIHNldEZlZWRiYWNrKHByZXYgPT4gKHsNCiAgICAgICAgLi4ucHJldiwNCiAgICAgICAgW2l0ZW1JZF06IHsNCiAgICAgICAgICBjb3JyZWN0OiBmYWxzZSwNCiAgICAgICAgICB3cm9uZ1R5cGU6IHRydWUsDQogICAgICAgICAgbWVzc2FnZTogYFdhaXQhICR7dW5pdH0gbWVhc3VyZXMgJHt0eXBlTmFtZXNbdW5pdFR5cGVdfSwgYnV0IHlvdSBuZWVkIHRvIG1lYXN1cmUgJHt0eXBlTmFtZXNbaXRlbS50eXBlXX0gaGVyZS4gVHJ5IGEgZGlmZmVyZW50IHR5cGUgb2YgdW5pdCFgDQogICAgICAgIH0NCiAgICAgIH0pKTsNCiAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICAvLyBHaXZlIGltbWVkaWF0ZSBmZWVkYmFjayBmb3IgY29ycmVjdCB0eXBlIGJ1dCB3cm9uZyBzaXplDQogICAgaWYgKHVuaXQgPT09IGl0ZW0uY29ycmVjdCkgew0KICAgICAgc2V0RmVlZGJhY2socHJldiA9PiAoew0KICAgICAgICAuLi5wcmV2LA0KICAgICAgICBbaXRlbUlkXTogew0KICAgICAgICAgIGNvcnJlY3Q6IHRydWUsDQogICAgICAgICAgbWVzc2FnZTogYFBlcmZlY3QhICR7aXRlbS5jb3JyZWN0VmFsdWV9IGlzIGNsZWFyIGFuZCBlYXN5IHRvIHVuZGVyc3RhbmQuYA0KICAgICAgICB9DQogICAgICB9KSk7DQogICAgfSBlbHNlIGlmIChpdGVtLndyb25nRmVlZGJhY2tbdW5pdF0pIHsNCiAgICAgIHNldEZlZWRiYWNrKHByZXYgPT4gKHsNCiAgICAgICAgLi4ucHJldiwNCiAgICAgICAgW2l0ZW1JZF06IHsNCiAgICAgICAgICBjb3JyZWN0OiBmYWxzZSwNCiAgICAgICAgICB2YWx1ZTogaXRlbS53cm9uZ0ZlZWRiYWNrW3VuaXRdLnZhbHVlLA0KICAgICAgICAgIG1lc3NhZ2U6IGl0ZW0ud3JvbmdGZWVkYmFja1t1bml0XS5yZWFzb24NCiAgICAgICAgfQ0KICAgICAgfSkpOw0KICAgIH0gZWxzZSB7DQogICAgICAvLyBUaGlzIGNhc2Ugc2hvdWxkIGJlIHJhcmUgZHVlIHRvIHRoZSBmbGF0IGxpc3Qgb2YgYWxsIHVuaXRzDQogICAgICBzZXRGZWVkYmFjayhwcmV2ID0+ICh7DQogICAgICAgIC4uLnByZXYsDQogICAgICAgIFtpdGVtSWRdOiB7DQogICAgICAgICAgY29ycmVjdDogZmFsc2UsDQogICAgICAgICAgd3JvbmdUeXBlOiB0cnVlLA0KICAgICAgICAgIG1lc3NhZ2U6IGBUaGF0J3MgdGhlIHdyb25nIHR5cGUgb2YgbWVhc3VyZW1lbnQhYA0KICAgICAgICB9DQogICAgICB9KSk7DQogICAgfQ0KICB9Ow0KDQogIC8vIC0tLSBBY3Rpdml0eSAyIEhhbmRsZXJzIC0tLQ0KICBjb25zdCBnZXRSb29tV2lkdGggPSAoKSA9PiB7DQogICAgcmV0dXJuIHJvb21SZWYuY3VycmVudCA/IHJvb21SZWYuY3VycmVudC5vZmZzZXRXaWR0aCA6IDA7DQogIH07DQoNCiAgY29uc3QgaGFuZGxlTWVhc3VyZVN0YXJ0ID0gKGUpID0+IHsNCiAgICBpZiAocm9vbU1lYXN1cmVkKSByZXR1cm47DQogICAgc2V0SXNEcmFnZ2luZyh0cnVlKTsNCiAgICBjb25zdCBjbGllbnRYID0gZS50b3VjaGVzID8gZS50b3VjaGVzWzBdLmNsaWVudFggOiBlLmNsaWVudFg7DQogICAgY29uc3Qgcm9vbVJlY3QgPSByb29tUmVmLmN1cnJlbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgc2V0U3RhcnRYKGNsaWVudFggLSByb29tUmVjdC5sZWZ0KTsNCiAgICBzZXRNZWFzdXJlV2lkdGgoMCk7IC8vIFJlc2V0IG9uIG5ldyBkcmFnDQogIH07DQoNCiAgY29uc3QgaGFuZGxlTWVhc3VyZU1vdmUgPSAoZSkgPT4gew0KICAgIGlmICghaXNEcmFnZ2luZyB8fCByb29tTWVhc3VyZWQpIHJldHVybjsNCiAgICBjb25zdCBjbGllbnRYID0gZS50b3VjaGVzID8gZS50b3VjaGVzWzBdLmNsaWVudFggOiBlLmNsaWVudFg7DQogICAgY29uc3Qgcm9vbVJlY3QgPSByb29tUmVmLmN1cnJlbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgY29uc3Qgcm9vbVdpZHRoID0gcm9vbVJlY3Qud2lkdGg7DQogICAgbGV0IGN1cnJlbnRYID0gY2xpZW50WCAtIHJvb21SZWN0LmxlZnQ7DQogICAgbGV0IHdpZHRoID0gY3VycmVudFggLSBzdGFydFg7DQoNCiAgICBpZiAod2lkdGggPCAwKSB3aWR0aCA9IDA7DQogICAgaWYgKHdpZHRoID4gcm9vbVdpZHRoKSB3aWR0aCA9IHJvb21XaWR0aDsNCg0KICAgIHNldE1lYXN1cmVXaWR0aCh3aWR0aCk7DQogIH07DQoNCiAgY29uc3QgaGFuZGxlTWVhc3VyZUVuZCA9ICgpID0+IHsNCiAgICBpZiAoIWlzRHJhZ2dpbmcpIHJldHVybjsNCiAgICBzZXRJc0RyYWdnaW5nKGZhbHNlKTsNCiAgICBjb25zdCByb29tV2lkdGggPSBnZXRSb29tV2lkdGgoKTsNCiAgICBjb25zdCB0b2xlcmFuY2UgPSAyMDsgLy8gMjBweCB0b2xlcmFuY2UNCg0KICAgIGlmIChtZWFzdXJlV2lkdGggPj0gcm9vbVdpZHRoIC0gdG9sZXJhbmNlKSB7DQogICAgICBzZXRNZWFzdXJlV2lkdGgocm9vbVdpZHRoKTsgLy8gU25hcCB0byBmdWxsIHdpZHRoDQogICAgICBzZXRSb29tTWVhc3VyZWQodHJ1ZSk7DQogICAgICBzZXRNZWFzdXJlRmVlZGJhY2sobnVsbCk7IC8vIENsZWFyIGFueSAia2VlcCBkcmFnZ2luZyIgZmVlZGJhY2sNCiAgICB9IGVsc2Ugew0KICAgICAgc2V0TWVhc3VyZUZlZWRiYWNrKHsgdHlwZTogJ3dhcm4nLCBtZXNzYWdlOiAnTm90IHF1aXRlISBLZWVwIGRyYWdnaW5nIHRvIG1lYXN1cmUgdGhlIHdob2xlIHdpZHRoLicgfSk7DQogICAgfQ0KICB9Ow0KDQogIGNvbnN0IGhhbmRsZVVuaXRDaG9pY2UgPSAoY2hvaWNlKSA9PiB7DQogICAgaWYgKCFyb29tTWVhc3VyZWQpIHJldHVybjsNCiAgICBpZiAoY2hvaWNlLmNvcnJlY3QpIHsNCiAgICAgIHNldE1lYXN1cmVGZWVkYmFjayh7IHR5cGU6ICdnb29kJywgbWVzc2FnZTogYFBlcmZlY3QhICIke2Nob2ljZS52YWx1ZX0iIGlzIHZlcnkgY2xlYXIgYW5kIGVhc3kgdG8gdW5kZXJzdGFuZC5gIH0pOw0KICAgIH0gZWxzZSB7DQogICAgICBzZXRNZWFzdXJlRmVlZGJhY2soeyB0eXBlOiAnYmFkJywgbWVzc2FnZTogY2hvaWNlLmV4cGxhbmF0aW9uIH0pOw0KICAgIH0NCiAgfTsNCg0KICBjb25zdCByZXNldEFjdGl2aXR5MiA9ICgpID0+IHsNCiAgICBzZXRNZWFzdXJlV2lkdGgoMCk7DQogICAgc2V0SXNEcmFnZ2luZyhmYWxzZSk7DQogICAgc2V0Um9vbU1lYXN1cmVkKGZhbHNlKTsNCiAgICBzZXRNZWFzdXJlRmVlZGJhY2sobnVsbCk7DQogIH07DQoNCiAgLy8gLS0tIFJlbmRlciBMb2dpYyAtLS0NCg0KICBpZiAoY3VycmVudEFjdGl2aXR5ID09PSAxKSB7DQogICAgY29uc3QgYWxsQW5zd2VyZWQgPSBPYmplY3Qua2V5cyhzZWxlY3RlZEFuc3dlcnMpLmxlbmd0aCA9PT0gY3VycmVudEl0ZW1zLmxlbmd0aDsNCg0KICAgIHJldHVybiAoDQogICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7X19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDQzOX19CiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdoMicsIHsgY2xhc3NOYW1lOiAidGV4dC0yeGwgZm9udC1ib2xkIG1iLTQgdGV4dC1ibHVlLTQwMCIgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA0NDB9fSwgIkFjdGl2aXR5IDE6IENob29zZSB0aGUgUmlnaHQgVW5pdCIgICAgICkKICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3AnLCB7IGNsYXNzTmFtZTogInRleHQtZ3JheS0zMDAgbWItNiIgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNDQxfX0sICJTZWxlY3QgdGhlIG1vc3QgYXBwcm9wcmlhdGUgdW5pdCBmb3IgbWVhc3VyaW5nIGVhY2ggaXRlbS4gVGhpbmsgYWJvdXQgd2hpY2ggdW5pdCBtYWtlcyB0aGUgbnVtYmVyIGVhc2llc3QgdG8gdW5kZXJzdGFuZCEiICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAvKiBSZXNwb25zaXZlIEdyaWQgKi8KICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAiZ3JpZCBncmlkLWNvbHMtMSBtZDpncmlkLWNvbHMtMiBsZzpncmlkLWNvbHMtMyBnYXAtNiBtYi02IiAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNDQ0fX0KICAgICAgICAgICwgY3VycmVudEl0ZW1zLm1hcChpdGVtID0+ICgNCiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsga2V5OiBpdGVtLmlkLCBjbGFzc05hbWU6ICJiZy1ncmF5LTcwMCByb3VuZGVkLWxnIHAtNCBzbTpwLTYiICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNDQ2fX0sICIgIiAvKiBSZWR1Y2VkIHBhZGRpbmcgb24gc21hbGwgc2NyZWVucyAqLwogICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJ0ZXh0LTV4bCBtYi0zIHRleHQtY2VudGVyIiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNDQ3fX0sIGl0ZW0uaW1hZ2UpCiAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdoMycsIHsgY2xhc3NOYW1lOiAidGV4dC1sZyBmb250LXNlbWlib2xkIG1iLTMgdGV4dC1jZW50ZXIiICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNDQ4fX0sIGl0ZW0ubmFtZSkKICAgICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAiZmxleCBmbGV4LXdyYXAgZ2FwLTIganVzdGlmeS1jZW50ZXIiICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNDQ5fX0KICAgICAgICAgICAgICAgICwgT2JqZWN0LnZhbHVlcyh1bml0T3B0aW9ucykuZmxhdCgpLmZpbHRlcigodiwgaSwgYSkgPT4gYS5pbmRleE9mKHYpID09PSBpKS5tYXAodW5pdCA9PiAoDQogICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdidXR0b24nLCB7DQogICAgICAgICAgICAgICAgICAgIGtleTogdW5pdCwNCiAgICAgICAgICAgICAgICAgICAgb25DbGljazogKCkgPT4gaGFuZGxlQW5zd2VyKGl0ZW0uaWQsIHVuaXQpLA0KICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6IGBweC0zIHB5LTEuNSBzbTpweC00IHNtOnB5LTIgdGV4dC1zbSBzbTp0ZXh0LWJhc2Ugcm91bmRlZC1sZyBmb250LXNlbWlib2xkIHRyYW5zaXRpb24tYWxsICR7IC8vIEFkanVzdGVkIHBhZGRpbmcvdGV4dCBzaXplDQogICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRBbnN3ZXJzW2l0ZW0uaWRdID09PSB1bml0DQogICAgICAgICAgICAgICAgICAgICAgICA/IF9vcHRpb25hbENoYWluKFtmZWVkYmFjaywgJ2FjY2VzcycsIF8yID0+IF8yW2l0ZW0uaWRdLCAnb3B0aW9uYWxBY2Nlc3MnLCBfMyA9PiBfMy5jb3JyZWN0XSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgPyAnYmctZ3JlZW4tNjAwIHRleHQtd2hpdGUnDQogICAgICAgICAgICAgICAgICAgICAgICAgIDogX29wdGlvbmFsQ2hhaW4oW2ZlZWRiYWNrLCAnYWNjZXNzJywgXzQgPT4gXzRbaXRlbS5pZF0sICdvcHRpb25hbEFjY2VzcycsIF81ID0+IF81LmNvcnJlY3RdKSA9PT0gZmFsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgPyBfb3B0aW9uYWxDaGFpbihbZmVlZGJhY2ssICdhY2Nlc3MnLCBfNiA9PiBfNltpdGVtLmlkXSwgJ29wdGlvbmFsQWNjZXNzJywgXzcgPT4gXzcud3JvbmdUeXBlXSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/ICdiZy1yZWQtNjAwIHRleHQtd2hpdGUnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAnYmctb3JhbmdlLTYwMCB0ZXh0LXdoaXRlJw0KICAgICAgICAgICAgICAgICAgICAgICAgICA6ICdiZy1ibHVlLTYwMCB0ZXh0LXdoaXRlJw0KICAgICAgICAgICAgICAgICAgICAgICAgOiAnYmctZ3JheS02MDAgdGV4dC1ncmF5LTIwMCBob3ZlcjpiZy1ncmF5LTUwMCcNCiAgICAgICAgICAgICAgICAgICAgfSBjdXJzb3ItcG9pbnRlcmAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA0NTF9fQ0KCiAgICAgICAgICAgICAgICAgICAgLCB1bml0CiAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICApKQogICAgICAgICAgICAgICkKICAgICAgICAgICAgICAsIGZlZWRiYWNrW2l0ZW0uaWRdICYmICgNCiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogYG10LTMgcC0zIHJvdW5kZWQtbGcgJHsNCiAgICAgICAgICAgICAgICAgIGZlZWRiYWNrW2l0ZW0uaWRdLmNvcnJlY3QgPyAnYmctZ3JlZW4tOTAwLzUwIHRleHQtZ3JlZW4tMjAwJyA6DQogICAgICAgICAgICAgICAgICBmZWVkYmFja1tpdGVtLmlkXS53cm9uZ1R5cGUgPyAnYmctcmVkLTkwMC81MCB0ZXh0LXJlZC0yMDAnIDoNCiAgICAgICAgICAgICAgICAgICdiZy1vcmFuZ2UtOTAwLzUwIHRleHQtb3JhbmdlLTIwMCcNCiAgICAgICAgICAgICAgICB9YCwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDQ3MX19CiAgICAgICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJmbGV4IGl0ZW1zLXN0YXJ0IGdhcC0yIiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNDc2fX0KICAgICAgICAgICAgICAgICAgICAsIGZlZWRiYWNrW2l0ZW0uaWRdLmNvcnJlY3QgPyBSZWFjdC5jcmVhdGVFbGVtZW50KENoZWNrLCB7IHNpemU6IDIwLCBjbGFzc05hbWU6ICJtdC0wLjUgZmxleC1zaHJpbmstMCIgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNDc3fX0gKSA6IFJlYWN0LmNyZWF0ZUVsZW1lbnQoWCwgeyBzaXplOiAyMCwgY2xhc3NOYW1lOiAibXQtMC41IGZsZXgtc2hyaW5rLTAiICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDQ3N319ICkKICAgICAgICAgICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAidGV4dC1zbSIsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA0Nzh9fQogICAgICAgICAgICAgICAgICAgICAgLCBmZWVkYmFja1tpdGVtLmlkXS52YWx1ZSAmJiAhZmVlZGJhY2tbaXRlbS5pZF0ud3JvbmdUeXBlICYmICgNCiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAiZm9udC1ib2xkIG1iLTEiICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDQ4MH19CiAgICAgICAgICAgICAgICAgICAgICAgICAgLCBpdGVtLm5hbWUsICI6ICIgLCBmZWVkYmFja1tpdGVtLmlkXS52YWx1ZQogICAgICAgICAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogZmVlZGJhY2tbaXRlbS5pZF0ud3JvbmdUeXBlID8gJ2ZvbnQtYm9sZCcgOiAnJywgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDQ4NH19CiAgICAgICAgICAgICAgICAgICAgICAgICwgZmVlZGJhY2tbaXRlbS5pZF0ubWVzc2FnZQogICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICApCiAgICAgICAgICAgICkNCiAgICAgICAgICApKQogICAgICAgICkKCiAgICAgICAgLyogUmVzcG9uc2l2ZSBCdXR0b25zICovCiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImZsZXggZmxleC1jb2wgc206ZmxleC1yb3cgZ2FwLTQganVzdGlmeS1jZW50ZXIiICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDQ5Nn19CiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicsIHsNCiAgICAgICAgICAgIG9uQ2xpY2s6IGdlbmVyYXRlTmV3RXhhbXBsZXMsDQogICAgICAgICAgICBjbGFzc05hbWU6ICJweC02IHB5LTMgYmctcHVycGxlLTYwMCBob3ZlcjpiZy1wdXJwbGUtNzAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBmb250LXNlbWlib2xkIHRyYW5zaXRpb24tYWxsIHNoYWRvdy1sZyBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiBqdXN0aWZ5LWNlbnRlciIgICAgICAgICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA0OTd9fQ0KCiAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudChSZWZyZXNoQ3csIHsgc2l6ZTogMjAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA1MDF9fSApLCAiIE5ldyBFeGFtcGxlcyIKICAgICAgICAgICkKICAgICAgICAgICwgYWxsQW5zd2VyZWQgJiYgKA0KICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgnYnV0dG9uJywgew0KICAgICAgICAgICAgICBvbkNsaWNrOiAoKSA9PiBzZXRDdXJyZW50QWN0aXZpdHkoMiksDQogICAgICAgICAgICAgIGNsYXNzTmFtZTogInB4LTYgcHktMyBiZy1ncmVlbi02MDAgaG92ZXI6YmctZ3JlZW4tNzAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBmb250LXNlbWlib2xkIHRyYW5zaXRpb24tYWxsIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIGp1c3RpZnktY2VudGVyIiAgICAgICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNTA0fX0NCiwgIk5leHQgQWN0aXZpdHkgIgogICAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KENoZXZyb25SaWdodCwgeyBzaXplOiAyMCwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDUwOH19ICkKICAgICAgICAgICAgKQ0KICAgICAgICAgICkKICAgICAgICApCiAgICAgICkNCiAgICApOw0KICB9DQoNCiAgLy8gLS0tIEFjdGl2aXR5IDI6IFdoeSBDb252ZXJ0PyAtLS0NCiAgY29uc3Qgcm9vbVdpZHRoUHggPSBnZXRSb29tV2lkdGgoKTsNCiAgLy8gRW5zdXJlIHJvb21XaWR0aFB4IGlzIG5vdCAwIGJlZm9yZSBkaXZpZGluZw0KICBjb25zdCBtZWFzdXJlZE1tID0gcm9vbVdpZHRoUHggPiAwID8gKG1lYXN1cmVXaWR0aCAvIHJvb21XaWR0aFB4ICogMzc1MCkudG9GaXhlZCgwKSA6ICcwJzsNCiAgY29uc3QgbWVhc3VyZWRDbSA9IHJvb21XaWR0aFB4ID4gMCA/IChOdW1iZXIobWVhc3VyZWRNbSkgLyAxMCkudG9GaXhlZCgxKSA6ICcwLjAnOw0KICBjb25zdCBtZWFzdXJlZE0gPSByb29tV2lkdGhQeCA+IDAgPyAoTnVtYmVyKG1lYXN1cmVkTW0pIC8gMTAwMCkudG9GaXhlZCgyKSA6ICcwLjAwJzsNCg0KDQogIGNvbnN0IHVuaXRDaG9pY2VzID0gWw0KICAgIHsgdmFsdWU6ICczNzUwIG1tJywgZXhwbGFuYXRpb246ICdUb28gbWFueSBkaWdpdHMgdG8gcXVpY2tseSBncmFzcCcsIGNvcnJlY3Q6IGZhbHNlIH0sDQogICAgeyB2YWx1ZTogJzM3NSBjbScsIGV4cGxhbmF0aW9uOiAnQmV0dGVyLCBidXQgc3RpbGwgYSBsYXJnZSBudW1iZXInLCBjb3JyZWN0OiBmYWxzZSB9LA0KICAgIHsgdmFsdWU6ICczLjc1IG0nLCBleHBsYW5hdGlvbjogJ1BlcmZlY3QhIEVhc3kgdG8gdmlzdWFsaXplJywgY29ycmVjdDogdHJ1ZSB9LA0KICAgIHsgdmFsdWU6ICcwLjAwMzc1IGttJywgZXhwbGFuYXRpb246ICdUb28gc21hbGwgLSBoYXJkIHRvIHBpY3R1cmUnLCBjb3JyZWN0OiBmYWxzZSB9DQogIF07DQoNCiAgcmV0dXJuICgNCiAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7DQogICAgICBvbk1vdXNlTW92ZTogaGFuZGxlTWVhc3VyZU1vdmUsDQogICAgICBvbk1vdXNlVXA6IGhhbmRsZU1lYXN1cmVFbmQsDQogICAgICBvblRvdWNoTW92ZTogaGFuZGxlTWVhc3VyZU1vdmUsDQogICAgICBvblRvdWNoRW5kOiBoYW5kbGVNZWFzdXJlRW5kLA0KICAgICAgY2xhc3NOYW1lOiAic2VsZWN0LW5vbmUiLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNTMyfX0NCgogICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2gyJywgeyBjbGFzc05hbWU6ICJ0ZXh0LTJ4bCBmb250LWJvbGQgbWItNCB0ZXh0LWJsdWUtNDAwIiAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDUzOX19LCAiQWN0aXZpdHkgMjogV2h5IERvIFdlIENvbnZlcnQgVW5pdHM/IiAgICAgICkKICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdwJywgeyBjbGFzc05hbWU6ICJ0ZXh0LWdyYXktMzAwIG1iLTYiICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDU0MH19LCAiWW91J3JlIG1lYXN1cmluZyBhIHJvb20uIERyYWcgdGhlIG1lYXN1cmluZyB0YXBlIHRvIGZpbmQgaXRzIHdpZHRoLCB0aGVuIHBpY2sgdGhlIGJlc3QgdW5pdCB0byBkZXNjcmliZSBpdC4iICAgICAgICAgICAgICAgICAgICkKCiAgICAgIC8qIFJlZHVjZWQgcGFkZGluZyBvbiBzbWFsbCBzY3JlZW5zICovCiAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJiZy1ncmF5LTcwMCByb3VuZGVkLWxnIHAtNCBzbTpwLTYgbWQ6cC04IG1iLTYiICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA1NDN9fQogICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJ0ZXh0LWNlbnRlciBtYi00IiAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA1NDR9fQogICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogInRleHQtNnhsIG1iLTQiICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDU0NX19LCAi8J+TjyIpCiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2gzJywgeyBjbGFzc05hbWU6ICJ0ZXh0LXhsIHNtOnRleHQtMnhsIGZvbnQtYm9sZCBtYi02IiAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDU0Nn19LCAiTWVhc3VyZSB0aGUgUm9vbToiICApCiAgICAgICAgKQoKICAgICAgICAvKiAtLS0gSW50ZXJhY3RpdmUgTWVhc3VyZW1lbnQgLS0tICovCiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7DQogICAgICAgICAgcmVmOiByb29tUmVmLA0KICAgICAgICAgIGNsYXNzTmFtZTogInJlbGF0aXZlIHctZnVsbCBoLTIwIHNtOmgtMjQgYmctZ3JheS04MDAgcm91bmRlZC1sZyBib3JkZXItMiBib3JkZXItZ3JheS02MDAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIHB4LTIgc206cHgtNCBjdXJzb3ItZ3JhYiIgICAgICAgICAgICAgLCAvLyBBZGp1c3RlZCBoZWlnaHQvcGFkZGluZw0KICAgICAgICAgIG9uTW91c2VEb3duOiBoYW5kbGVNZWFzdXJlU3RhcnQsDQogICAgICAgICAgb25Ub3VjaFN0YXJ0OiBoYW5kbGVNZWFzdXJlU3RhcnQsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA1NTB9fQ0KCiAgICAgICAgICAvKiBXYWxsIG1hcmtlcnMgKi8KICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJhYnNvbHV0ZSBsZWZ0LTAgdG9wLTAgaC1mdWxsIHctMS41IHNtOnctMiBiZy1ncmF5LTUwMCByb3VuZGVkLWwtbWQiICAgICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDU1N319KQogICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImFic29sdXRlIHJpZ2h0LTAgdG9wLTAgaC1mdWxsIHctMS41IHNtOnctMiBiZy1ncmF5LTUwMCByb3VuZGVkLXItbWQiICAgICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDU1OH19KQoKICAgICAgICAgIC8qIE1lYXN1cmluZyBUYXBlICovCiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsNCiAgICAgICAgICAgIGNsYXNzTmFtZTogImFic29sdXRlIGxlZnQtMCB0b3AtMCBoLWZ1bGwgYmcteWVsbG93LTUwMC8zMCBib3JkZXItci0yIHNtOmJvcmRlci1yLTQgYm9yZGVyLXllbGxvdy02MDAgcm91bmRlZC1sLWxnIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktZW5kIHByLTEgc206cHItMiIgICAgICAgICAgICAgLCAvLyBBZGp1c3RlZCBib3JkZXIvcGFkZGluZw0KICAgICAgICAgICAgc3R5bGU6IHsgd2lkdGg6IGAke21lYXN1cmVXaWR0aH1weGAgfSwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDU2MX19DQoKICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICJ0ZXh0LXllbGxvdy0xMDAgZm9udC1ib2xkIHRleHQtc20gc206dGV4dC1sZyIgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA1NjV9fSwgbWVhc3VyZWRNLCAiIG0iICksICIgIiAvKiBBZGp1c3RlZCB0ZXh0IHNpemUgKi8KICAgICAgICAgICkKCiAgICAgICAgICAvKiBEcmFnIEhhbmRsZSAqLwogICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7DQogICAgICAgICAgICBjbGFzc05hbWU6ICJhYnNvbHV0ZSB0b3AtMS8yIC10cmFuc2xhdGUteS0xLzIgdy0zIGgtMTAgc206dy00IHNtOmgtMTIgYmctZ3JheS05MDAgYm9yZGVyLTIgYm9yZGVyLWdyYXktNDAwIHJvdW5kZWQtbWQgY3Vyc29yLWdyYWIgYWN0aXZlOmN1cnNvci1ncmFiYmluZyIgICAgICAgICAgICAsIC8vIEFkanVzdGVkIHNpemUNCiAgICAgICAgICAgIHN0eWxlOiB7IGxlZnQ6IGAke21lYXN1cmVXaWR0aCA+IDAgPyBtZWFzdXJlV2lkdGggLSA2IDogLTZ9cHhgIH0sIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA1Njl9fQ0KKQoKICAgICAgICAgICwgIXJvb21NZWFzdXJlZCAmJiAhaXNEcmFnZ2luZyAmJiAoDQogICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICJ0ZXh0LWdyYXktNDAwIGFuaW1hdGUtcHVsc2UgdGV4dC1jZW50ZXIgdy1mdWxsIHRleHQtc20gc206dGV4dC1iYXNlIiAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNTc1fX0sICJDbGljayBhbmQgZHJhZyB0byBtZWFzdXJlISIgICAgKSAvKiBBZGp1c3RlZCB0ZXh0IHNpemUgKi8NCiAgICAgICAgICApCiAgICAgICAgKQogICAgICAgIC8qIC0tLSBFbmQgSW50ZXJhY3RpdmUgTWVhc3VyZW1lbnQgLS0tICovCgogICAgICAgICwgcm9vbU1lYXN1cmVkICYmICgNCiAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogIm10LTgiLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNTgxfX0KICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdoNCcsIHsgY2xhc3NOYW1lOiAidGV4dC1sZyBmb250LXNlbWlib2xkIHRleHQtY2VudGVyIG1iLTQiICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNTgyfX0sICJHcmVhdCEgVGhlIHJvb20gaXMgMy43NSBtIChvciAzNzUgY20pLiBXaGljaCB3YXkgaXMgYmVzdD8iICAgICAgICAgICAgKQogICAgICAgICAgICAvKiBSZXNwb25zaXZlIEdyaWQgKi8KICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImdyaWQgZ3JpZC1jb2xzLTEgc206Z3JpZC1jb2xzLTIgZ2FwLTQgbWItNiIgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNTg0fX0KICAgICAgICAgICAgICAsIHVuaXRDaG9pY2VzLm1hcCgob3B0aW9uKSA9PiAoDQogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgnYnV0dG9uJywgew0KICAgICAgICAgICAgICAgICAga2V5OiBvcHRpb24udmFsdWUsDQogICAgICAgICAgICAgICAgICBvbkNsaWNrOiAoKSA9PiBoYW5kbGVVbml0Q2hvaWNlKG9wdGlvbiksDQogICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJiZy1ncmF5LTgwMCBwLTQgc206cC02IHJvdW5kZWQtbGcgYm9yZGVyLTIgYm9yZGVyLWdyYXktNjAwIGhvdmVyOmJvcmRlci1ibHVlLTUwMCB0cmFuc2l0aW9uLWFsbCB0ZXh0LWxlZnQiICAgICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA1ODZ9fQ0KCiAgICAgICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJ0ZXh0LTJ4bCBzbTp0ZXh0LTN4bCBmb250LWJvbGQgdGV4dC1ibHVlLTQwMCBtYi0yIiAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA1OTF9fSwgb3B0aW9uLnZhbHVlKSwgIiAiIC8qIEFkanVzdGVkIHRleHQgc2l6ZSAqLwogICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICApKQogICAgICAgICAgICApCiAgICAgICAgICApDQogICAgICAgICkKCiAgICAgICAgLCBtZWFzdXJlRmVlZGJhY2sgJiYgKA0KICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiBgbXQtNCBwLTMgcm91bmRlZC1sZyBib3JkZXItMiAkew0KICAgICAgICAgICAgbWVhc3VyZUZlZWRiYWNrLnR5cGUgPT09ICdnb29kJyA/ICdiZy1ncmVlbi05MDAvNTAgYm9yZGVyLWdyZWVuLTUwMCcgOg0KICAgICAgICAgICAgbWVhc3VyZUZlZWRiYWNrLnR5cGUgPT09ICd3YXJuJyA/ICdiZy1vcmFuZ2UtOTAwLzUwIGJvcmRlci1vcmFuZ2UtNTAwJyA6DQogICAgICAgICAgICAnYmctcmVkLTkwMC81MCBib3JkZXItcmVkLTUwMCcNCiAgICAgICAgICB9YCwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDU5OX19CiAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJmbGV4IGl0ZW1zLXN0YXJ0IGdhcC0yIiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNjA0fX0KICAgICAgICAgICAgICAsIG1lYXN1cmVGZWVkYmFjay50eXBlID09PSAnZ29vZCcgPyBSZWFjdC5jcmVhdGVFbGVtZW50KENoZWNrLCB7IHNpemU6IDIwLCBjbGFzc05hbWU6ICJtdC0wLjUgZmxleC1zaHJpbmstMCB0ZXh0LWdyZWVuLTQwMCIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDYwNX19ICkgOiBSZWFjdC5jcmVhdGVFbGVtZW50KFgsIHsgc2l6ZTogMjAsIGNsYXNzTmFtZTogIm10LTAuNSBmbGV4LXNocmluay0wIHRleHQtcmVkLTQwMCIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDYwNX19ICkKICAgICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3AnLCB7IGNsYXNzTmFtZTogYHRleHQtc20gJHsNCiAgICAgICAgICAgICAgICBtZWFzdXJlRmVlZGJhY2sudHlwZSA9PT0gJ2dvb2QnID8gJ3RleHQtZ3JlZW4tMjAwJyA6DQogICAgICAgICAgICAgICAgbWVhc3VyZUZlZWRiYWNrLnR5cGUgPT09ICd3YXJuJyA/ICd0ZXh0LW9yYW5nZS0yMDAnIDoNCiAgICAgICAgICAgICAgICAndGV4dC1yZWQtMjAwJw0KICAgICAgICAgICAgICB9YCwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDYwNn19CiAgICAgICAgICAgICAgICAsIG1lYXN1cmVGZWVkYmFjay5tZXNzYWdlCiAgICAgICAgICAgICAgKQogICAgICAgICAgICApCiAgICAgICAgICApDQogICAgICAgICkKICAgICAgKQoKICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImJnLXB1cnBsZS05MDAvMzAgYm9yZGVyLTIgYm9yZGVyLXB1cnBsZS01MDAgcm91bmRlZC1sZyBwLTQgc206cC02IG1iLTYiICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNjE4fX0sICIgIiAvKiBBZGp1c3RlZCBwYWRkaW5nICovCiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImZsZXggaXRlbXMtc3RhcnQgZ2FwLTMiICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA2MTl9fQogICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KExpZ2h0YnVsYiwgeyBzaXplOiAyNCwgY2xhc3NOYW1lOiAidGV4dC15ZWxsb3ctNDAwIG10LTEgZmxleC1zaHJpbmstMCIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDYyMH19ICkKICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2Jywge19fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA2MjF9fQogICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2g0JywgeyBjbGFzc05hbWU6ICJmb250LWJvbGQgdGV4dC1sZyBtYi0yIHRleHQtcHVycGxlLTMwMCIgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA2MjJ9fSwgIktleSBJbnNpZ2h0OiIgKQogICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3AnLCB7IGNsYXNzTmFtZTogInRleHQtZ3JheS0yMDAgdGV4dC1zbSBzbTp0ZXh0LWJhc2UiICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA2MjN9fSwgIiAiIC8qIEFkanVzdGVkIHRleHQgc2l6ZSAqLywgIldlIGNvbnZlcnQgdW5pdHMgdG8gbWFrZSBtZWFzdXJlbWVudHMgZWFzaWVyIHRvIHVuZGVyc3RhbmQgYW5kIHdvcmsgd2l0aC4gVGhlIFwiYmVzdFwiIHVuaXQgZGVwZW5kcyBvbiB0aGUgc2l6ZSBvZiB3aGF0IHdlJ3JlIG1lYXN1cmluZy4gVG9vIGxhcmdlIG9yIHRvbyBzbWFsbCBudW1iZXJzIHdpdGggZGVjaW1hbHMgYXJlIGhhcmQgdG8gcGljdHVyZSEiCgogICAgICAgICAgICApCiAgICAgICAgICApCiAgICAgICAgKQogICAgICApCgogICAgICAvKiBSZXNwb25zaXZlIEJ1dHRvbnMgKi8KICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImZsZXggZmxleC1jb2wgc206ZmxleC1yb3cganVzdGlmeS1jZW50ZXIgZ2FwLTQiICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDYzMX19CiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdidXR0b24nLCB7DQogICAgICAgICAgb25DbGljazogKCkgPT4gc2V0Q3VycmVudEFjdGl2aXR5KDEpLA0KICAgICAgICAgIGNsYXNzTmFtZTogInB4LTYgcHktMyBiZy1ibHVlLTYwMCBob3ZlcjpiZy1ibHVlLTcwMCB0ZXh0LXdoaXRlIHJvdW5kZWQtbGcgZm9udC1zZW1pYm9sZCB0cmFuc2l0aW9uLWFsbCIgICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNjMyfX0NCiwgIkJhY2sgdG8gQWN0aXZpdHkgMSIKCiAgICAgICAgKQogICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnYnV0dG9uJywgew0KICAgICAgICAgIG9uQ2xpY2s6IHJlc2V0QWN0aXZpdHkyLA0KICAgICAgICAgIGNsYXNzTmFtZTogInB4LTYgcHktMyBiZy1ncmF5LTYwMCBob3ZlcjpiZy1ncmF5LTUwMCB0ZXh0LXdoaXRlIHJvdW5kZWQtbGcgZm9udC1zZW1pYm9sZCB0cmFuc2l0aW9uLWFsbCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiBqdXN0aWZ5LWNlbnRlciIgICAgICAgICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDYzOH19DQoKICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudChSZWZyZXNoQ3csIHsgc2l6ZTogMTgsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA2NDJ9fSApLCAiIFJlc2V0IgogICAgICAgICkKICAgICAgKQogICAgKQ0KICApOw0KfTsNCg0KLy8gVGFiIDI6IFVuZGVyc3RhbmRpbmcgQ29udmVyc2lvbnMNCmNvbnN0IFVuZGVyc3RhbmRpbmdDb252ZXJzaW9uc1RhYiA9ICgpID0+IHsNCiAgY29uc3QgW3NsaWRlclZhbHVlLCBzZXRTbGlkZXJWYWx1ZV0gPSB1c2VTdGF0ZSgyNTApOyAvLyBCYXNlIHZhbHVlIGluIGNtDQogIGNvbnN0IFtjdXJyZW50VW5pdCwgc2V0Q3VycmVudFVuaXRdID0gdXNlU3RhdGUoJ2NtJyk7DQogIGNvbnN0IFtmZWVkYmFjaywgc2V0RmVlZGJhY2tdID0gdXNlU3RhdGUobnVsbCk7IC8vIFN0YXRlIGZvciBmZWVkYmFjaw0KDQogIC8vIE1lbW9pemUgY29udmVyc2lvbnMgb2JqZWN0DQogIGNvbnN0IGNvbnZlcnNpb25zID0gUmVhY3QudXNlTWVtbygoKSA9PiAoew0KICAgIG1tOiB7IHZhbHVlOiBzbGlkZXJWYWx1ZSAqIDEwLCBsYWJlbDogJ21pbGxpbWV0ZXJzJyB9LA0KICAgIGNtOiB7IHZhbHVlOiBzbGlkZXJWYWx1ZSwgbGFiZWw6ICdjZW50aW1ldGVycycgfSwNCiAgICBtOiB7IHZhbHVlOiBzbGlkZXJWYWx1ZSAvIDEwMCwgbGFiZWw6ICdtZXRlcnMnIH0sDQogICAga206IHsgdmFsdWU6IHNsaWRlclZhbHVlIC8gMTAwMDAwLCBsYWJlbDogJ2tpbG9tZXRlcnMnIH0NCiAgfSksIFtzbGlkZXJWYWx1ZV0pOw0KDQogIC8vIE1lbW9pemUgZmVlZGJhY2sgZnVuY3Rpb24NCiAgY29uc3QgZ2V0RmVlZGJhY2sgPSBSZWFjdC51c2VDYWxsYmFjaygodW5pdCwgdmFsdWUpID0+IHsNCiAgICBzd2l0Y2ggKHVuaXQpIHsNCiAgICAgIGNhc2UgJ21tJzoNCiAgICAgICAgaWYgKHZhbHVlID4gMTAwMCkgcmV0dXJuIHsgbWVzc2FnZTogIlRoaXMgbnVtYmVyIGlzIGdldHRpbmcgYSBiaXQgbGFyZ2UhICdjbScgb3IgJ20nIG1pZ2h0IGJlIGNsZWFyZXIuIiwgdHlwZTogJ3dhcm4nIH07DQogICAgICAgIGlmICh2YWx1ZSA8IDEwICYmIHZhbHVlID4gMCkgcmV0dXJuIHsgbWVzc2FnZTogIkdvb2QgZm9yIHZlcnkgc21hbGwgdGhpbmdzLCBidXQgJ2NtJyBtaWdodCBiZSBlYXNpZXIgdG8gcmVhZCBoZXJlLiIsIHR5cGU6ICdvaycgfTsNCiAgICAgICAgaWYgKHZhbHVlID09PSAwKSByZXR1cm4geyBtZXNzYWdlOiAiVGhpcyB2YWx1ZSBpcyAwISIsIHR5cGU6ICdvaycgfTsNCiAgICAgICAgcmV0dXJuIHsgbWVzc2FnZTogIk1pbGxpbWV0ZXJzIGFyZSBncmVhdCBmb3IgcHJlY2lzZSwgc21hbGwgbWVhc3VyZW1lbnRzLiIsIHR5cGU6ICdvaycgfTsNCiAgICAgIGNhc2UgJ2NtJzoNCiAgICAgICAgaWYgKHZhbHVlID4gMzAwKSByZXR1cm4geyBtZXNzYWdlOiAiQ2VudGltZXRlcnMgd29yaywgYnV0ICdtZXRlcnMnIG1pZ2h0IGJlIHNpbXBsZXIgZm9yIHRoaXMgbGVuZ3RoLiIsIHR5cGU6ICd3YXJuJyB9Ow0KICAgICAgICBpZiAodmFsdWUgPCAxICYmIHZhbHVlID4gMCkgcmV0dXJuIHsgbWVzc2FnZTogIlRoaXMgaXMgbGVzcyB0aGFuIDEgY20hICdtbScgd291bGQgYmUgYmV0dGVyLiIsIHR5cGU6ICd3YXJuJyB9Ow0KICAgICAgICByZXR1cm4geyBtZXNzYWdlOiAiQ2VudGltZXRlcnMgYXJlIGEgZ3JlYXQsIGVhc3ktdG8tcmVhZCB1bml0IGZvciB0aGlzIHNpemUhIiwgdHlwZTogJ2dvb2QnIH07DQogICAgICBjYXNlICdtJzoNCiAgICAgICAgaWYgKHZhbHVlID4gMTAwKSByZXR1cm4geyBtZXNzYWdlOiAiVGhpcyBpcyBhIGxhcmdlIGRpc3RhbmNlISAna20nIHdvdWxkIGJlIG11Y2ggZWFzaWVyLiIsIHR5cGU6ICd3YXJuJyB9Ow0KICAgICAgICBpZiAodmFsdWUgPCAxICYmIHZhbHVlID4gMCkgcmV0dXJuIHsgbWVzc2FnZTogIlVzaW5nIGEgZGVjaW1hbCBmb3IgbWV0ZXJzIGNhbiBiZSBhd2t3YXJkLiAnY20nIG1pZ2h0IGJlIGNsZWFyZXIuIiwgdHlwZTogJ3dhcm4nIH07DQogICAgICAgIGlmICh2YWx1ZSA+PSAxICYmIHZhbHVlIDwgMTApIHJldHVybiB7IG1lc3NhZ2U6ICJNZXRlcnMgYXJlIHBlcmZlY3QgZm9yIHRoaXMgc2l6ZSwgdmVyeSBlYXN5IHRvIHBpY3R1cmUhIiwgdHlwZTogJ2dvb2QnIH07DQogICAgICAgIHJldHVybiB7IG1lc3NhZ2U6ICJNZXRlcnMgd29yayB3ZWxsIGZvciB0aGlzIGxlbmd0aC4iLCB0eXBlOiAnb2snIH07DQogICAgICBjYXNlICdrbSc6DQogICAgICAgIGlmICh2YWx1ZSA+PSAxKSByZXR1cm4geyBtZXNzYWdlOiAiS2lsb21ldGVycyBhcmUgZm9yIGxvbmcgZGlzdGFuY2VzLiBUaGlzIGlzIGEgZ29vZCB1bml0IGlmIHlvdSdyZSBtZWFzdXJpbmcgYSByb2FkISIsIHR5cGU6ICdnb29kJyB9Ow0KICAgICAgICByZXR1cm4geyBtZXNzYWdlOiAiVGhpcyBudW1iZXIgaXMgdGlueSEgS2lsb21ldGVycyBhcmUgd2F5IHRvbyBiaWcgZm9yIHRoaXMgbWVhc3VyZW1lbnQuIiwgdHlwZTogJ2JhZCcgfTsNCiAgICAgIGRlZmF1bHQ6DQogICAgICAgIHJldHVybiB7IG1lc3NhZ2U6ICcnLCB0eXBlOiAnb2snIH07DQogICAgfQ0KICB9LCBbXSk7DQoNCiAgLy8gVXBkYXRlIGZlZWRiYWNrIHdoZW4gc2xpZGVyIG9yIHVuaXQgY2hhbmdlcw0KICB1c2VFZmZlY3QoKCkgPT4gew0KICAgIGNvbnN0IHZhbHVlID0gY29udmVyc2lvbnNbY3VycmVudFVuaXRdLnZhbHVlOw0KICAgIGNvbnN0IGZlZWRiYWNrTWVzc2FnZSA9IGdldEZlZWRiYWNrKGN1cnJlbnRVbml0LCB2YWx1ZSk7DQogICAgc2V0RmVlZGJhY2soZmVlZGJhY2tNZXNzYWdlKTsNCiAgfSwgW3NsaWRlclZhbHVlLCBjdXJyZW50VW5pdCwgY29udmVyc2lvbnMsIGdldEZlZWRiYWNrXSk7DQoNCiAgcmV0dXJuICgNCiAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7X19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDY5Nn19CiAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnaDInLCB7IGNsYXNzTmFtZTogInRleHQtMnhsIGZvbnQtYm9sZCBtYi00IHRleHQtYmx1ZS00MDAiICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNjk3fX0sICJVbmRlcnN0YW5kaW5nIENvbnZlcnNpb25zIiApCiAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncCcsIHsgY2xhc3NOYW1lOiAidGV4dC1ncmF5LTMwMCBtYi02IiAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA2OTh9fSwgIlNlZSBob3cgdGhlIHNhbWUgbWVhc3VyZW1lbnQgY2hhbmdlcyB3aGVuIHdlIGNvbnZlcnQgYmV0d2VlbiB1bml0cy4gTm90aWNlIGhvdyB0aGUgZGVjaW1hbCBwb2ludCBtb3ZlcyEiICAgICAgICAgICAgICAgICkKCiAgICAgIC8qIFJlZHVjZWQgcGFkZGluZyBvbiBzbWFsbCBzY3JlZW5zICovCiAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJiZy1ncmF5LTcwMCByb3VuZGVkLWxnIHAtNCBzbTpwLTggbWItOCIgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzAxfX0KICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2gzJywgeyBjbGFzc05hbWU6ICJ0ZXh0LXhsIGZvbnQtYm9sZCBtYi02IHRleHQtY2VudGVyIiAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDcwMn19LCAiSW50ZXJhY3RpdmUgQ29udmVyc2lvbiBFeHBsb3JlciAoQmFzZTogY20pIiAgICApCgogICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJtYi04IiwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDcwNH19CiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJywgeyBjbGFzc05hbWU6ICJibG9jayB0ZXh0LXNtIGZvbnQtc2VtaWJvbGQgbWItMyB0ZXh0LWdyYXktMzAwIiAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA3MDV9fSwgIkFkanVzdCB0aGUgbWVhc3VyZW1lbnQ6ICIgICAsIHNsaWRlclZhbHVlLCAiIGNtIiApCiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAicmVsYXRpdmUgcHQtNCIgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzA2fX0KICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdpbnB1dCcsIHsNCiAgICAgICAgICAgICAgdHlwZTogInJhbmdlIiwNCiAgICAgICAgICAgICAgbWluOiAiMSIsDQogICAgICAgICAgICAgIG1heDogIjUwMCIsDQogICAgICAgICAgICAgIHZhbHVlOiBzbGlkZXJWYWx1ZSwNCiAgICAgICAgICAgICAgb25DaGFuZ2U6IChlKSA9PiBzZXRTbGlkZXJWYWx1ZShOdW1iZXIoZS50YXJnZXQudmFsdWUpKSwNCiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAidy1mdWxsIGgtMiBiZy10cmFuc3BhcmVudCByb3VuZGVkLWxnIGFwcGVhcmFuY2Utbm9uZSBjdXJzb3ItcG9pbnRlciB6LTEwIHJlbGF0aXZlIiAgICAgICAsDQogICAgICAgICAgICAgIHN0eWxlOiB7DQogICAgICAgICAgICAgICAgJy0tc2xpZGVyLXRodW1iLWJnJzogJyMzYjgyZjYnLA0KICAgICAgICAgICAgICAgICctLXNsaWRlci10aHVtYi1ib3JkZXInOiAnIzFlM2E4YScsDQogICAgICAgICAgICAgIH0sIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA3MDd9fQ0KICAgICAgICAgICAgKQogICAgICAgICAgICAgLyogUnVsZXIgVHJhY2sgKi8KICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImFic29sdXRlIHRvcC0xLzIgbGVmdC0wIHctZnVsbCBoLTIgLXRyYW5zbGF0ZS15LXB4IGJnLWdyYXktNjAwIHJvdW5kZWQtbGcgb3ZlcmZsb3ctaGlkZGVuIiAgICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzIwfX0KICAgICAgICAgICAgICAgIC8qIFRpY2sgbWFya3MgKi8KICAgICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJhYnNvbHV0ZSB0b3AtMCBsZWZ0LTAgaC1mdWxsIHctZnVsbCBmbGV4IGp1c3RpZnktYmV0d2VlbiIgICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA3MjJ9fQogICAgICAgICAgICAgICAgICAsIFsuLi5BcnJheSgxMSldLm1hcCgoXywgaSkgPT4gKA0KICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBrZXk6IGksIGNsYXNzTmFtZTogYHctMC41IGgtZnVsbCAke2kgJSA1ID09PSAwID8gJ2JnLWdyYXktMjAwJyA6ICdiZy1ncmF5LTQwMCd9YCwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDcyNH19KQ0KICAgICAgICAgICAgICAgICAgKSkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgKQogICAgICAgICAgICAvKiBSdWxlciBMYWJlbHMgKi8KICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImFic29sdXRlIC1ib3R0b20tNiBsZWZ0LTAgdy1mdWxsIGZsZXgganVzdGlmeS1iZXR3ZWVuIHRleHQteHMgdGV4dC1ncmF5LTQwMCIgICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzI5fX0KICAgICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3BhbicsIHtfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzMwfX0sICIxIikKICAgICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3BhbicsIHtfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzMxfX0sICIxMDAiKQogICAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywge19fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA3MzJ9fSwgIjIwMCIpCiAgICAgICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7X19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDczM319LCAiMzAwIikKICAgICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3BhbicsIHtfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzM0fX0sICI0MDAiKQogICAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywge19fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA3MzV9fSwgIjUwMCIpCiAgICAgICAgICAgICkKICAgICAgICAgICkKICAgICAgICApCgogICAgICAgIC8qIFJlc3BvbnNpdmUgR3JpZCAqLwogICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJncmlkIGdyaWQtY29scy0xIHNtOmdyaWQtY29scy0yIG1kOmdyaWQtY29scy00IGdhcC00IG1iLTggbXQtMTIiICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzQxfX0KICAgICAgICAgICwgT2JqZWN0LmVudHJpZXMoY29udmVyc2lvbnMpLm1hcCgoW3VuaXQsIGRhdGFdKSA9PiAoDQogICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7DQogICAgICAgICAgICAgIGtleTogdW5pdCwNCiAgICAgICAgICAgICAgb25DbGljazogKCkgPT4gc2V0Q3VycmVudFVuaXQodW5pdCksIC8vIEp1c3Qgc2V0IHRoZSBjdXJyZW50IHVuaXQNCiAgICAgICAgICAgICAgY2xhc3NOYW1lOiBgcC00IHNtOnAtNiByb3VuZGVkLWxnIGJvcmRlci0yIGN1cnNvci1wb2ludGVyIHRyYW5zaXRpb24tYWxsICR7IC8vIEFkanVzdGVkIHBhZGRpbmcNCiAgICAgICAgICAgICAgICBjdXJyZW50VW5pdCA9PT0gdW5pdA0KICAgICAgICAgICAgICAgICAgPyAnYm9yZGVyLWJsdWUtNTAwIGJnLWJsdWUtOTAwLzMwJw0KICAgICAgICAgICAgICAgICAgOiAnYm9yZGVyLWdyYXktNjAwIGJnLWdyYXktODAwIGhvdmVyOmJvcmRlci1ncmF5LTUwMCcNCiAgICAgICAgICAgICAgfWAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA3NDN9fQ0KCiAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogInRleHQtMnhsIHNtOnRleHQtM3hsIGZvbnQtYm9sZCB0ZXh0LWJsdWUtNDAwIG1iLTEiICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDc1Mn19LCAiICIgLyogQWRqdXN0ZWQgdGV4dCBzaXplICovCiAgICAgICAgICAgICAgICAsIGRhdGEudmFsdWUudG9Mb2NhbGVTdHJpbmcodW5kZWZpbmVkLCB7DQogICAgICAgICAgICAgICAgICBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IHVuaXQgPT09ICdrbScgPyA1IDogMiwNCiAgICAgICAgICAgICAgICAgIG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMA0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJ0ZXh0LXhzIHNtOnRleHQtc20gdGV4dC1ncmF5LTQwMCIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDc1OH19LCBkYXRhLmxhYmVsLCAiICgiICwgdW5pdCwgIikiKSwgIiAiIC8qIEFkanVzdGVkIHRleHQgc2l6ZSAqLwogICAgICAgICAgICApDQogICAgICAgICAgKSkKICAgICAgICApCgogICAgICAgIC8qIC0tLSBGZWVkYmFjayBCb3ggLS0tICovCiAgICAgICAgLCBmZWVkYmFjayAmJiAoDQogICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6IGBtYi04IHAtMyBzbTpwLTQgcm91bmRlZC1sZyBib3JkZXItMiAkeyAvLyBBZGp1c3RlZCBwYWRkaW5nDQogICAgICAgICAgICBmZWVkYmFjay50eXBlID09PSAnZ29vZCcgPyAnYmctZ3JlZW4tOTAwLzUwIGJvcmRlci1ncmVlbi01MDAnIDoNCiAgICAgICAgICAgIGZlZWRiYWNrLnR5cGUgPT09ICd3YXJuJyA/ICdiZy1vcmFuZ2UtOTAwLzUwIGJvcmRlci1vcmFuZ2UtNTAwJyA6DQogICAgICAgICAgICBmZWVkYmFjay50eXBlID09PSAnYmFkJyA/ICdiZy1yZWQtOTAwLzUwIGJvcmRlci1yZWQtNTAwJyA6DQogICAgICAgICAgICAnYmctYmx1ZS05MDAvMzAgYm9yZGVyLWJsdWUtNTAwJyAvLyAnb2snIHR5cGUNCiAgICAgICAgICB9YCwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDc2NX19CiAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJmbGV4IGl0ZW1zLXN0YXJ0IGdhcC0yIiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzcxfX0KICAgICAgICAgICAgICAsIGZlZWRiYWNrLnR5cGUgPT09ICdnb29kJyA/IFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ2hlY2ssIHsgc2l6ZTogMjAsIGNsYXNzTmFtZTogIm10LTAuNSBmbGV4LXNocmluay0wIHRleHQtZ3JlZW4tNDAwIiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzcyfX0gKSA6DQogICAgICAgICAgICAgICBmZWVkYmFjay50eXBlID09PSAnYmFkJyA/IFJlYWN0LmNyZWF0ZUVsZW1lbnQoWCwgeyBzaXplOiAyMCwgY2xhc3NOYW1lOiAibXQtMC41IGZsZXgtc2hyaW5rLTAgdGV4dC1yZWQtNDAwIiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzczfX0gKSA6DQogICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KExpZ2h0YnVsYiwgeyBzaXplOiAyMCwgY2xhc3NOYW1lOiAibXQtMC41IGZsZXgtc2hyaW5rLTAgdGV4dC15ZWxsb3ctNDAwIiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzc0fX0gKQogICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncCcsIHsgY2xhc3NOYW1lOiBgdGV4dC1zbSAkew0KICAgICAgICAgICAgICAgIGZlZWRiYWNrLnR5cGUgPT09ICdnb29kJyA/ICd0ZXh0LWdyZWVuLTIwMCcgOg0KICAgICAgICAgICAgICAgIGZlZWRiYWNrLnR5cGUgPT09ICd3YXJuJyA/ICd0ZXh0LW9yYW5nZS0yMDAnIDoNCiAgICAgICAgICAgICAgICBmZWVkYmFjay50eXBlID09PSAnYmFkJyA/ICd0ZXh0LXJlZC0yMDAnIDoNCiAgICAgICAgICAgICAgICAndGV4dC1ibHVlLTIwMCcNCiAgICAgICAgICAgICAgfWAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA3NzV9fQogICAgICAgICAgICAgICAgLCBmZWVkYmFjay5tZXNzYWdlCiAgICAgICAgICAgICAgKQogICAgICAgICAgICApCiAgICAgICAgICApDQogICAgICAgICkKICAgICAgICAvKiAtLS0gRW5kIEZlZWRiYWNrIEJveCAtLS0gKi8KCgogICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJiZy1ncmF5LTgwMCByb3VuZGVkLWxnIHAtNCBzbTpwLTYiICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzg5fX0sICIgIiAvKiBBZGp1c3RlZCBwYWRkaW5nICovCiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2g0JywgeyBjbGFzc05hbWU6ICJmb250LWJvbGQgbWItNCB0ZXh0LWJhc2Ugc206dGV4dC1sZyB0ZXh0LWJsdWUtMzAwIiAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA3OTB9fSwgIkNvbnZlcnNpb24gUmVsYXRpb25zaGlwczoiICksICIgIiAvKiBBZGp1c3RlZCB0ZXh0IHNpemUgKi8KICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJzcGFjZS15LTMgdGV4dC1ncmF5LTIwMCB0ZXh0LXNtIHNtOnRleHQtYmFzZSIgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA3OTF9fSwgIiAiIC8qIEFkanVzdGVkIHRleHQgc2l6ZSAqLwogICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAiZmxleCBmbGV4LXdyYXAgaXRlbXMtY2VudGVyIGdhcC14LTMgZ2FwLXktMSIgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzkyfX0KICAgICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7IGNsYXNzTmFtZTogImZvbnQtbW9ubyBiZy1ncmF5LTcwMCBweC0zIHB5LTEgcm91bmRlZCIgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzkzfX0sICIxIG0gPSAxMDAgY20iICAgICkKICAgICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7IGNsYXNzTmFtZTogInRleHQtZ3JheS00MDAiLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzk0fX0sICLihpIgbXVsdGlwbHkgYnkgMTAwIHRvIGdvIGZyb20gbSB0byBjbSIgICAgICAgICApCiAgICAgICAgICAgICkKICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImZsZXggZmxleC13cmFwIGl0ZW1zLWNlbnRlciBnYXAteC0zIGdhcC15LTEiICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDc5Nn19CiAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICJmb250LW1vbm8gYmctZ3JheS03MDAgcHgtMyBweS0xIHJvdW5kZWQiICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDc5N319LCAiMSBtID0gMTAwMCBtbSIgICAgKQogICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3BhbicsIHsgY2xhc3NOYW1lOiAidGV4dC1ncmF5LTQwMCIsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA3OTh9fSwgIuKGkiBtdWx0aXBseSBieSAxMDAwIHRvIGdvIGZyb20gbSB0byBtbSIgICAgICAgICApCiAgICAgICAgICAgICkKICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImZsZXggZmxleC13cmFwIGl0ZW1zLWNlbnRlciBnYXAteC0zIGdhcC15LTEiICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDgwMH19CiAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICJmb250LW1vbm8gYmctZ3JheS03MDAgcHgtMyBweS0xIHJvdW5kZWQiICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDgwMX19LCAiMSBrbSA9IDEwMDAgbSIgICAgKQogICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3BhbicsIHsgY2xhc3NOYW1lOiAidGV4dC1ncmF5LTQwMCIsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA4MDJ9fSwgIuKGkiBtdWx0aXBseSBieSAxMDAwIHRvIGdvIGZyb20ga20gdG8gbSIgICAgICAgICApCiAgICAgICAgICAgICkKICAgICAgICAgICkKICAgICAgICApCiAgICAgICkKCiAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJiZy1wdXJwbGUtOTAwLzMwIGJvcmRlci0yIGJvcmRlci1wdXJwbGUtNTAwIHJvdW5kZWQtbGcgcC00IHNtOnAtNiIgICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDgwOH19LCAiICIgLyogQWRqdXN0ZWQgcGFkZGluZyAqLwogICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJmbGV4IGl0ZW1zLXN0YXJ0IGdhcC0zIiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogODA5fX0KICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudChMaWdodGJ1bGIsIHsgc2l6ZTogMjQsIGNsYXNzTmFtZTogInRleHQteWVsbG93LTQwMCBtdC0xIGZsZXgtc2hyaW5rLTAiICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA4MTB9fSApCiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogODExfX0KICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdoNCcsIHsgY2xhc3NOYW1lOiAiZm9udC1ib2xkIHRleHQtbGcgbWItMiB0ZXh0LXB1cnBsZS0zMDAiICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogODEyfX0sICJDb252ZXJzaW9uIEZhY3RvcnM6IiApCiAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncCcsIHsgY2xhc3NOYW1lOiAidGV4dC1ncmF5LTIwMCBtYi0zIHRleHQtc20gc206dGV4dC1iYXNlIiAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDgxM319LCAiICIgLyogQWRqdXN0ZWQgdGV4dCBzaXplICovLCAiQSBjb252ZXJzaW9uIGZhY3RvciBpcyBhIHJhdGlvIHRoYXQgZXF1YWxzIDEsIGxpa2UgXCIxMDAgY20gLyAxIG1cIi4gV2hlbiB3ZSBtdWx0aXBseSBieSBpdCwgd2UncmUgbm90IGNoYW5naW5nIHRoZSBhY3R1YWwgbWVhc3VyZW1lbnTigJRqdXN0IGhvdyB3ZSBleHByZXNzIGl0ISIKCiAgICAgICAgICAgICkKICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdwJywgeyBjbGFzc05hbWU6ICJ0ZXh0LWdyYXktMjAwIHRleHQtc20gc206dGV4dC1iYXNlIiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogODE2fX0sICIgIiAvKiBBZGp1c3RlZCB0ZXh0IHNpemUgKi8sICLigKIgR29pbmcgdG8gYSBzbWFsbGVyIHVuaXQ/IE11bHRpcGx5ICh0aGUgbnVtYmVyIGdldHMgYmlnZ2VyKSIKICAgICAgICAgICAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdicicsIHtfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogODE3fX0gKSwgIuKAoiBHb2luZyB0byBhIGxhcmdlciB1bml0PyBEaXZpZGUgKHRoZSBudW1iZXIgZ2V0cyBzbWFsbGVyKSIKCiAgICAgICAgICAgICkKICAgICAgICAgICkKICAgICAgICApCiAgICAgICkKICAgICkNCiAgKTsNCn07DQoNCi8vIC0tLSBGcmFjdGlvbiBDb21wb25lbnQgZm9yIFRhYiAzIC0tLQ0KLy8gQWRqdXN0ZWQgdGV4dCBzaXplIGZvciBzbWFsbGVyIHNjcmVlbnMNCmNvbnN0IEZyYWN0aW9uID0gKHsgbnVtLCBkZW4sIG51bUNhbmNlbGxlZCwgZGVuQ2FuY2VsbGVkIH0pID0+IHsNCiAgY29uc3QgW251bVZhbCwgbnVtVW5pdF0gPSBudW0uc3BsaXQoJyAnKTsNCiAgY29uc3QgW2RlblZhbCwgZGVuVW5pdF0gPSBkZW4uc3BsaXQoJyAnKTsNCg0KICByZXR1cm4gKA0KICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAiaW5saW5lLWZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIHRleHQtYmFzZSBzbTp0ZXh0LWxnIG1kOnRleHQteGwgbXgtMSBmb250LW1vbm8iICAgICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDgzNH19LCAiICIgLyogQWRqdXN0ZWQgdGV4dCBzaXplICovCiAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3BhbicsIHsgY2xhc3NOYW1lOiAicHgtMSBzbTpweC0yIiAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA4MzV9fSwgIiAiIC8qIEFkanVzdGVkIHBhZGRpbmcgKi8KICAgICAgICAsIG51bVZhbCwgJyAnCiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6IGAke251bUNhbmNlbGxlZCA/ICdsaW5lLXRocm91Z2ggdGV4dC1yZWQtNDAwJyA6ICcnfWAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA4Mzd9fQogICAgICAgICAgLCBudW1Vbml0CiAgICAgICAgKQogICAgICApCiAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3BhbicsIHsgY2xhc3NOYW1lOiAiYm9yZGVyLXQgYm9yZGVyLWdyYXktNDAwIHNtOmJvcmRlci10LTIgdy1mdWxsIG15LTAuNSBzbTpteS0xIiAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogODQxfX0pLCAiICIgLyogQWRqdXN0ZWQgYm9yZGVyL21hcmdpbiAqLwogICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7IGNsYXNzTmFtZTogInB4LTEgc206cHgtMiIgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogODQyfX0sICIgIiAvKiBBZGp1c3RlZCBwYWRkaW5nICovCiAgICAgICAgLCBkZW5WYWwsICcgJwogICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3BhbicsIHsgY2xhc3NOYW1lOiBgJHtkZW5DYW5jZWxsZWQgPyAnbGluZS10aHJvdWdoIHRleHQtcmVkLTQwMCcgOiAnJ31gLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogODQ0fX0KICAgICAgICAgICwgZGVuVW5pdAogICAgICAgICkKICAgICAgKQogICAgKQ0KICApOw0KfTsNCg0KDQovLyBUYWIgMzogVW5pdCBDYW5jZWxsYXRpb24NCmNvbnN0IFVuaXRDYW5jZWxsYXRpb25UYWIgPSAoKSA9PiB7DQogIGNvbnN0IFtjdXJyZW50TGV2ZWwsIHNldEN1cnJlbnRMZXZlbF0gPSB1c2VTdGF0ZSgxKTsNCiAgY29uc3QgW3NlbGVjdGVkRmFjdG9ycywgc2V0U2VsZWN0ZWRGYWN0b3JzXSA9IHVzZVN0YXRlKFtdKTsNCiAgY29uc3QgW3Nob3dTb2x1dGlvbiwgc2V0U2hvd1NvbHV0aW9uXSA9IHVzZVN0YXRlKGZhbHNlKTsNCiAgY29uc3QgW2hpbnQsIHNldEhpbnRdID0gdXNlU3RhdGUobnVsbCk7IC8vIFN0YXRlIGZvciBIaW50cw0KDQogIC8vIFVzZSBSZWFjdC51c2VNZW1vIHRvIGF2b2lkIHJlZGVmaW5pbmcgdGhpcyBvYmplY3Qgb24gZXZlcnkgcmVuZGVyDQogIGNvbnN0IGxldmVscyA9IFJlYWN0LnVzZU1lbW8oKCkgPT4gKHsNCiAgICAxOiB7DQogICAgICB0aXRsZTogJ0xldmVsIDE6IFdoYXQgaXMgQ2FuY2VsbGluZz8nLA0KICAgICAgcHJvYmxlbTogJzE1MCBjbSB0byBtZXRlcnMnLA0KICAgICAgc3RhcnQ6IHsgdmFsdWU6IDE1MCwgdW5pdDogJ2NtJyB9LA0KICAgICAgdGFyZ2V0OiAnbScsDQogICAgICBmYWN0b3JzOiBbDQogICAgICAgIHsgbnVtOiAnMSBtJywgZGVuOiAnMTAwIGNtJywgY29ycmVjdDogdHJ1ZSwgaWQ6ICcxLTEnIH0sDQogICAgICAgIHsgbnVtOiAnMTAwIGNtJywgZGVuOiAnMSBtJywgY29ycmVjdDogZmFsc2UsIGlkOiAnMS0yJyB9LA0KICAgICAgICB7IG51bTogJzEga20nLCBkZW46ICcxMDAwIG0nLCBjb3JyZWN0OiBmYWxzZSwgaWQ6ICcxLTMnIH0NCiAgICAgIF0sDQogICAgICBzb2x1dGlvbjogWyAnMS0xJyBdLA0KICAgICAgZXhwbGFuYXRpb246ICdXZSB1c2UgdGhlIGNvbnZlcnNpb24gZmFjdG9yIHdpdGggImNtIiBpbiB0aGUgZGVub21pbmF0b3Igc28gaXQgY2FuY2VscyB3aXRoIHRoZSAiY20iIGluIG91ciBzdGFydGluZyB2YWx1ZS4nLA0KICAgICAgY2FsY3VsYXRpb246ICcoIDE1MCDDlyAxICkgLyAxMDAgPSAxLjUgbScNCiAgICB9LA0KICAgIDI6IHsNCiAgICAgIHRpdGxlOiAnTGV2ZWwgMjogTXVsdGktU3RlcCAoY20g4oaSIG0g4oaSIGttKScsDQogICAgICBwcm9ibGVtOiAnMjUwLDAwMCBjbSB0byBraWxvbWV0ZXJzJywNCiAgICAgIHN0YXJ0OiB7IHZhbHVlOiAyNTAwMDAsIHVuaXQ6ICdjbScgfSwNCiAgICAgIHRhcmdldDogJ2ttJywNCiAgICAgIGZhY3RvcnM6IFsNCiAgICAgICAgeyBudW06ICcxIG0nLCBkZW46ICcxMDAgY20nLCBjb3JyZWN0OiB0cnVlLCBvcmRlcjogMSwgaWQ6ICcyLTEnIH0sDQogICAgICAgIHsgbnVtOiAnMSBrbScsIGRlbjogJzEwMDAgbScsIGNvcnJlY3Q6IHRydWUsIG9yZGVyOiAyLCBpZDogJzItMicgfSwNCiAgICAgICAgeyBudW06ICcxMDAgY20nLCBkZW46ICcxIG0nLCBjb3JyZWN0OiBmYWxzZSwgaWQ6ICcyLTMnIH0sDQogICAgICAgIHsgbnVtOiAnMTAwMCBtJywgZGVuOiAnMSBrbScsIGNvcnJlY3Q6IGZhbHNlLCBpZDogJzItNCcgfQ0KICAgICAgXSwNCiAgICAgIHNvbHV0aW9uOiBbJzItMScsICcyLTInXSwNCiAgICAgIGV4cGxhbmF0aW9uOiAnRmlyc3QgY2FuY2VsICJjbSIgdG8gZ2V0ICJtIiwgdGhlbiBjYW5jZWwgIm0iIHRvIGdldCAia20iLiBUaGUgb3JkZXIgbWF0dGVycyEnLA0KICAgICAgY2FsY3VsYXRpb246ICcoIDI1MDAwMCDDlyAxIMOXIDEgKSAvICggMTAwIMOXIDEwMDAgKSA9IDIuNSBrbScNCiAgICB9LA0KICAgIDM6IHsNCiAgICAgIHRpdGxlOiAnTGV2ZWwgMzogVGltZSBDb252ZXJzaW9uIChzZWMg4oaSIG1pbiDihpIgaHIpJywNCiAgICAgIHByb2JsZW06ICc3MjAwIHNlY29uZHMgdG8gaG91cnMnLA0KICAgICAgc3RhcnQ6IHsgdmFsdWU6IDcyMDAsIHVuaXQ6ICdzJyB9LA0KICAgICAgdGFyZ2V0OiAnaHInLA0KICAgICAgZmFjdG9yczogWw0KICAgICAgICB7IG51bTogJzEgbWluJywgZGVuOiAnNjAgcycsIGNvcnJlY3Q6IHRydWUsIG9yZGVyOiAxLCBpZDogJzMtMScgfSwNCiAgICAgICAgeyBudW06ICcxIGhyJywgZGVuOiAnNjAgbWluJywgY29ycmVjdDogdHJ1ZSwgb3JkZXI6IDIsIGlkOiAnMy0yJyB9LA0KICAgICAgICB7IG51bTogJzYwIHMnLCBkZW46ICcxIG1pbicsIGNvcnJlY3Q6IGZhbHNlLCBpZDogJzMtMycgfSwNCiAgICAgICAgeyBudW06ICc2MCBtaW4nLCBkZW46ICcxIGhyJywgY29ycmVjdDogZmFsc2UsIGlkOiAnMy00JyB9DQogICAgICBdLA0KICAgICAgc29sdXRpb246IFsnMy0xJywgJzMtMiddLA0KICAgICAgZXhwbGFuYXRpb246ICdDYW5jZWwgInNlY29uZHMiIHdpdGggdGhlIGZpcnN0IGZhY3RvciwgdGhlbiBjYW5jZWwgIm1pbnV0ZXMiIHdpdGggdGhlIHNlY29uZCB0byBiZSBsZWZ0IHdpdGggImhvdXJzIi4nLA0KICAgICAgY2FsY3VsYXRpb246ICcoIDcyMDAgw5cgMSDDlyAxICkgLyAoIDYwIMOXIDYwICkgPSAyIGhyJw0KICAgIH0NCiAgfSksIFtdKTsgLy8gRW1wdHkgZGVwZW5kZW5jeSBhcnJheSBtZWFucyB0aGlzIG9iamVjdCBpcyBjcmVhdGVkIG9ubHkgb25jZQ0KDQogIGNvbnN0IGN1cnJlbnRQcm9ibGVtID0gbGV2ZWxzW2N1cnJlbnRMZXZlbF07DQoNCiAgLy8gVGhpcyBzdGF0ZSB3aWxsIHRyYWNrIHRoZSAibGl2ZSIgY2FuY2VsbGF0aW9uIGFzIHVzZXIgY2xpY2tzDQogIGNvbnN0IFtsaXZlQ2FuY2VsbGF0aW9uLCBzZXRMaXZlQ2FuY2VsbGF0aW9uXSA9IHVzZVN0YXRlKHt9KTsNCg0KICAvLyBUaGlzIGZ1bmN0aW9uIHVwZGF0ZXMgdGhlIGxpdmUgY2FuY2VsbGF0aW9uIHN0YXRlIGFuZCByZXR1cm5zIHRoZSBjdXJyZW50IGFjdGl2ZSB1bml0DQogIGNvbnN0IHVwZGF0ZUxpdmVDYW5jZWxsYXRpb24gPSAoZmFjdG9ycykgPT4gew0KICAgIGxldCBhY3RpdmVVbml0ID0gY3VycmVudFByb2JsZW0uc3RhcnQudW5pdDsNCiAgICBjb25zdCBjYW5jZWxsYXRpb25zID0ge307IC8vIHsgJzEtMSc6IHsgbnVtOiBmYWxzZSwgZGVuOiB0cnVlIH0sICdzdGFydCc6IHsgdW5pdDogdHJ1ZSB9IH0NCg0KICAgIGxldCBzdGFydFVuaXRDYW5jZWxsZWQgPSBmYWxzZTsNCg0KICAgIC8vIFNvcnQgZmFjdG9ycyBieSBzZWxlY3Rpb24gb3JkZXIgZm9yIHRoaXMgbG9naWMNCiAgICBjb25zdCBvcmRlcmVkRmFjdG9ycyA9IGZhY3RvcnM7DQoNCiAgICBmb3IgKGNvbnN0IGZhY3RvciBvZiBvcmRlcmVkRmFjdG9ycykgew0KICAgICAgY29uc3QgW251bVZhbCwgbnVtVW5pdF0gPSBmYWN0b3IubnVtLnNwbGl0KCcgJyk7DQogICAgICBjb25zdCBbZGVuVmFsLCBkZW5Vbml0XSA9IGZhY3Rvci5kZW4uc3BsaXQoJyAnKTsNCg0KICAgICAgbGV0IGRlbkNhbmNlbGxlZCA9IGZhbHNlOw0KDQogICAgICAvLyBDaGVjayBpZiB0aGUgZGVub21pbmF0b3IgY2FuY2VscyB0aGUgYWN0aXZlIHVuaXQNCiAgICAgIGlmIChkZW5Vbml0ID09PSBhY3RpdmVVbml0KSB7DQogICAgICAgIGRlbkNhbmNlbGxlZCA9IHRydWU7DQoNCiAgICAgICAgLy8gTWFyayB0aGUgYWN0aXZlIHVuaXQgYXMgY2FuY2VsbGVkDQogICAgICAgIGlmICghc3RhcnRVbml0Q2FuY2VsbGVkKSB7DQogICAgICAgICAgY2FuY2VsbGF0aW9uc1snc3RhcnQnXSA9IHsgdW5pdDogdHJ1ZSB9Ow0KICAgICAgICAgIHN0YXJ0VW5pdENhbmNlbGxlZCA9IHRydWU7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgLy8gRmluZCB0aGUgcHJldmlvdXMgZmFjdG9yIHRoYXQgcHJvdmlkZWQgdGhpcyB1bml0DQogICAgICAgICAgY29uc3QgcHJldkZhY3RvckluZGV4ID0gb3JkZXJlZEZhY3RvcnMuZmluZEluZGV4KGYgPT4gZi5pZCA9PT0gZmFjdG9yLmlkKSAtMTsNCiAgICAgICAgICAvLyBGaW5kIHRoZSBsYXN0IGZhY3RvciB3aG9zZSBudW1lcmF0b3IgbWF0Y2hlcyB0aGUgYWN0aXZlIHVuaXQgYmVpbmcgY2FuY2VsbGVkDQogICAgICAgICAgbGV0IHByZXZGYWN0b3IgPSBudWxsOw0KICAgICAgICAgIGZvcihsZXQgaSA9IG9yZGVyZWRGYWN0b3JzLmxlbmd0aCAtIDI7IGkgPj0gMDsgaS0tKXsNCiAgICAgICAgICAgICBpZihvcmRlcmVkRmFjdG9yc1tpXS5udW0uc3BsaXQoJyAnKVsxXSA9PT0gYWN0aXZlVW5pdCl7DQogICAgICAgICAgICAgICAgIHByZXZGYWN0b3IgPSBvcmRlcmVkRmFjdG9yc1tpXTsNCiAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGlmIChwcmV2RmFjdG9yKSB7DQogICAgICAgICAgICBjYW5jZWxsYXRpb25zW3ByZXZGYWN0b3IuaWRdID0geyAuLi5jYW5jZWxsYXRpb25zW3ByZXZGYWN0b3IuaWRdLCBudW06IHRydWUgfTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBUaGUgbmV3IGFjdGl2ZSB1bml0IGlzIHRoaXMgZmFjdG9yJ3MgbnVtZXJhdG9yDQogICAgICAgIGFjdGl2ZVVuaXQgPSBudW1Vbml0Ow0KICAgICAgfQ0KDQogICAgICBjYW5jZWxsYXRpb25zW2ZhY3Rvci5pZF0gPSB7IC4uLmNhbmNlbGxhdGlvbnNbZmFjdG9yLmlkXSwgZGVuOiBkZW5DYW5jZWxsZWQgfTsNCiAgICB9DQoNCiAgICBzZXRMaXZlQ2FuY2VsbGF0aW9uKGNhbmNlbGxhdGlvbnMpOw0KICAgIHJldHVybiBhY3RpdmVVbml0OyAvLyBSZXR1cm4gdGhlIG5ldyBhY3RpdmUgdW5pdCBmb3IgaGludCBsb2dpYw0KICB9Ow0KDQogIGNvbnN0IGhhbmRsZUZhY3RvckNsaWNrID0gKGZhY3RvcikgPT4gew0KICAgIGlmIChzaG93U29sdXRpb24pIHJldHVybjsNCg0KICAgIGNvbnN0IGlzU2VsZWN0ZWQgPSBzZWxlY3RlZEZhY3RvcnMuc29tZShmID0+IGYuaWQgPT09IGZhY3Rvci5pZCk7DQogICAgbGV0IG5ld1NlbGVjdGVkRmFjdG9yczsNCiAgICBpZiAoaXNTZWxlY3RlZCkgew0KICAgICAgbmV3U2VsZWN0ZWRGYWN0b3JzID0gc2VsZWN0ZWRGYWN0b3JzLmZpbHRlcihmID0+IGYuaWQgIT09IGZhY3Rvci5pZCk7DQogICAgfSBlbHNlIHsNCiAgICAgIG5ld1NlbGVjdGVkRmFjdG9ycyA9IFsuLi5zZWxlY3RlZEZhY3RvcnMsIGZhY3Rvcl07DQogICAgfQ0KDQogICAgc2V0U2VsZWN0ZWRGYWN0b3JzKG5ld1NlbGVjdGVkRmFjdG9ycyk7DQogICAgY29uc3QgbmV3QWN0aXZlVW5pdCA9IHVwZGF0ZUxpdmVDYW5jZWxsYXRpb24obmV3U2VsZWN0ZWRGYWN0b3JzKTsgLy8gVXBkYXRlIGxpdmUgY2FuY2VsbGF0aW9uDQoNCiAgICAvLyAtLS0gSGludCBMb2dpYyAoTm93IGZvciBhbGwgbGV2ZWxzKSAtLS0NCiAgICBjb25zdCBzdGFydFVuaXQgPSBjdXJyZW50UHJvYmxlbS5zdGFydC51bml0Ow0KICAgIGNvbnN0IHRhcmdldFVuaXQgPSBjdXJyZW50UHJvYmxlbS50YXJnZXQ7DQoNCiAgICBpZiAobmV3U2VsZWN0ZWRGYWN0b3JzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgc2V0SGludChudWxsKTsNCiAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICAvLyBHZXQgdGhlIGxhc3Qgc2VsZWN0ZWQgZmFjdG9yIGFuZCBpdHMgdW5pdHMNCiAgICBjb25zdCBsYXN0RmFjdG9yID0gbmV3U2VsZWN0ZWRGYWN0b3JzW25ld1NlbGVjdGVkRmFjdG9ycy5sZW5ndGggLSAxXTsNCiAgICBjb25zdCBbbGFzdE51bVZhbCwgbGFzdE51bVVuaXRdID0gbGFzdEZhY3Rvci5udW0uc3BsaXQoJyAnKTsNCiAgICBjb25zdCBbbGFzdERlblZhbCwgbGFzdERlblVuaXRdID0gbGFzdEZhY3Rvci5kZW4uc3BsaXQoJyAnKTsNCg0KICAgIC8vIEdldCB0aGUgYWN0aXZlIHVuaXQgKmJlZm9yZSogdGhpcyBsYXN0IGNsaWNrIChieSBzaW11bGF0aW5nIGNhbmNlbGxhdGlvbiB1cCB0byB0aGUgc2Vjb25kLXRvLWxhc3QgZmFjdG9yKQ0KICAgIGxldCBhY3RpdmVVbml0QmVmb3JlQ2xpY2sgPSBzdGFydFVuaXQ7DQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuZXdTZWxlY3RlZEZhY3RvcnMubGVuZ3RoIC0gMTsgaSsrKSB7DQogICAgICAgIGNvbnN0IGYgPSBuZXdTZWxlY3RlZEZhY3RvcnNbaV07DQogICAgICAgIGNvbnN0IFtudW1VLCBkZW5VXSA9IFtmLm51bS5zcGxpdCgnICcpWzFdLCBmLmRlbi5zcGxpdCgnICcpWzFdXTsNCiAgICAgICAgaWYgKGRlblUgPT09IGFjdGl2ZVVuaXRCZWZvcmVDbGljaykgew0KICAgICAgICAgICAgYWN0aXZlVW5pdEJlZm9yZUNsaWNrID0gbnVtVTsNCiAgICAgICAgfQ0KICAgIH0NCg0KDQogICAgLy8gTm93IGNoZWNrIHRoZSBsYXN0IGZhY3Rvcg0KICAgIGlmIChsYXN0RGVuVW5pdCA9PT0gYWN0aXZlVW5pdEJlZm9yZUNsaWNrKSB7DQogICAgICAvLyBDb3JyZWN0IGNhbmNlbGxhdGlvbg0KICAgICAgaWYgKG5ld0FjdGl2ZVVuaXQgPT09IHRhcmdldFVuaXQpIHsNCiAgICAgICAgc2V0SGludCh7IHR5cGU6ICdnb29kJywgbWVzc2FnZTogYFBlcmZlY3QhIFlvdSd2ZSBjYW5jZWxsZWQgIiR7YWN0aXZlVW5pdEJlZm9yZUNsaWNrfSIgYW5kIGFyZSBsZWZ0IHdpdGggIiR7bmV3QWN0aXZlVW5pdH0iLCB3aGljaCBpcyB5b3VyIHRhcmdldCB1bml0IWAgfSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBzZXRIaW50KHsgdHlwZTogJ2dvb2QnLCBtZXNzYWdlOiBgR29vZCEgWW91J3ZlIGNhbmNlbGxlZCAiJHthY3RpdmVVbml0QmVmb3JlQ2xpY2t9Ii4gTm93IHlvdSBuZWVkIHRvIGNhbmNlbCAiJHtuZXdBY3RpdmVVbml0fSIuYCB9KTsNCiAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgLy8gSW5jb3JyZWN0IGNhbmNlbGxhdGlvbg0KICAgICAgaWYgKGFjdGl2ZVVuaXRCZWZvcmVDbGljayA9PT0gdGFyZ2V0VW5pdCkgew0KICAgICAgICAgc2V0SGludCh7IHR5cGU6ICd3YXJuJywgbWVzc2FnZTogYFdob29wcyEgWW91IGFscmVhZHkgcmVhY2hlZCB5b3VyIHRhcmdldCB1bml0ICIke3RhcmdldFVuaXR9Ii4gWW91IGRvbid0IG5lZWQgYW55IG1vcmUgZmFjdG9ycy5gIH0pOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgIHNldEhpbnQoeyB0eXBlOiAnd2FybicsIG1lc3NhZ2U6IGBOb3QgdGhpcyBvbmUuIFRvIGNhbmNlbCAiJHthY3RpdmVVbml0QmVmb3JlQ2xpY2t9IiwgeW91IG5lZWQgYSBmYWN0b3Igd2l0aCAiJHthY3RpdmVVbml0QmVmb3JlQ2xpY2t9IiBvbiB0aGUgYm90dG9tIChkZW5vbWluYXRvcikuYCB9KTsNCiAgICAgIH0NCiAgICB9DQogIH07DQoNCg0KICBjb25zdCBjaGVja0Fuc3dlciA9ICgpID0+IHsNCiAgICBzZXRTaG93U29sdXRpb24odHJ1ZSk7DQogICAgc2V0SGludChudWxsKTsgLy8gQ2xlYXIgaGludHMgd2hlbiBjaGVja2luZw0KICB9Ow0KDQogIGNvbnN0IHJlc2V0ID0gKCkgPT4gew0KICAgIHNldFNlbGVjdGVkRmFjdG9ycyhbXSk7DQogICAgc2V0U2hvd1NvbHV0aW9uKGZhbHNlKTsNCiAgICBzZXRIaW50KG51bGwpOyAvLyBDbGVhciBoaW50cyBvbiByZXNldA0KICAgIHNldExpdmVDYW5jZWxsYXRpb24oe30pOyAvLyBDbGVhciBsaXZlIGNhbmNlbGxhdGlvbg0KICB9Ow0KDQogIGNvbnN0IG5leHRMZXZlbCA9ICgpID0+IHsNCiAgICBpZiAoY3VycmVudExldmVsIDwgT2JqZWN0LmtleXMobGV2ZWxzKS5sZW5ndGgpIHsNCiAgICAgIHNldEN1cnJlbnRMZXZlbChjdXJyZW50TGV2ZWwgKyAxKTsNCiAgICAgIHJlc2V0KCk7DQogICAgfQ0KICB9Ow0KDQogIGNvbnN0IHByZXZMZXZlbCA9ICgpID0+IHsNCiAgICBpZiAoY3VycmVudExldmVsID4gMSkgew0KICAgICAgc2V0Q3VycmVudExldmVsKGN1cnJlbnRMZXZlbCAtIDEpOw0KICAgICAgcmVzZXQoKTsNCiAgICB9DQogIH07DQoNCiAgLy8gQ2hlY2sgaWYgdGhlIHNlbGVjdGVkIGZhY3RvcnMgYXJlIGNvcnJlY3QNCiAgbGV0IGlzQ29ycmVjdCA9IGZhbHNlOw0KICBpZiAoc2hvd1NvbHV0aW9uKSB7DQogICAgY29uc3Qgc2VsZWN0ZWRJZHMgPSBzZWxlY3RlZEZhY3RvcnMubWFwKGYgPT4gZi5pZCkuc29ydCgpOw0KICAgIGNvbnN0IHNvbHV0aW9uSWRzID0gY3VycmVudFByb2JsZW0uc29sdXRpb24uc29ydCgpOw0KICAgIGlzQ29ycmVjdCA9IEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkSWRzKSA9PT0gSlNPTi5zdHJpbmdpZnkoc29sdXRpb25JZHMpOw0KICB9DQoNCiAgLy8gRGV0ZXJtaW5lIGZpbmFsIHNvbHV0aW9uIGNhbmNlbGxhdGlvbiAod2hlbiBzaG93U29sdXRpb24gaXMgdHJ1ZSBhbmQgaXNDb3JyZWN0KQ0KICBjb25zdCBmaW5hbENhbmNlbGxhdGlvbnMgPSB1c2VNZW1vKCgpID0+IHsNCiAgICAvLyBVc2UgbGl2ZUNhbmNlbGxhdGlvbiBpZiB3ZSdyZSBub3Qgc2hvd2luZyB0aGUgc29sdXRpb24geWV0DQogICAgaWYgKCFzaG93U29sdXRpb24pIHJldHVybiBsaXZlQ2FuY2VsbGF0aW9uOw0KICAgIC8vIElmIHNob3dpbmcgc29sdXRpb24gYnV0IGl0J3Mgd3JvbmcsICpzdGlsbCogdXNlIGxpdmVDYW5jZWxsYXRpb24NCiAgICBpZiAoc2hvd1NvbHV0aW9uICYmICFpc0NvcnJlY3QpIHJldHVybiBsaXZlQ2FuY2VsbGF0aW9uOw0KDQogICAgLy8gSWYgc29sdXRpb24gaXMgc2hvd24gQU5EIGNvcnJlY3QsIGNhbGN1bGF0ZSB0aGUgZGVmaW5pdGl2ZSBjYW5jZWxsYXRpb24NCiAgICBsZXQgYWN0aXZlVW5pdCA9IGN1cnJlbnRQcm9ibGVtLnN0YXJ0LnVuaXQ7DQogICAgY29uc3QgY2FuY2VsbGF0aW9ucyA9IHt9Ow0KICAgIGxldCBzdGFydFVuaXRDYW5jZWxsZWQgPSBmYWxzZTsNCg0KICAgIC8vIFNvcnQgc2VsZWN0ZWQgZmFjdG9ycyBieSB0aGUgaW50ZW5kZWQgb3JkZXIgZm9yIG11bHRpLXN0ZXAgcHJvYmxlbXMNCiAgICBjb25zdCBvcmRlcmVkRmFjdG9ycyA9IFsuLi5zZWxlY3RlZEZhY3RvcnNdLnNvcnQoKGEsIGIpID0+IChhLm9yZGVyIHx8IDApIC0gKGIub3JkZXIgfHwgMCkpOw0KDQogICAgZm9yIChjb25zdCBmYWN0b3Igb2Ygb3JkZXJlZEZhY3RvcnMpIHsNCiAgICAgIGNvbnN0IFtudW1WYWwsIG51bVVuaXRdID0gZmFjdG9yLm51bS5zcGxpdCgnICcpOw0KICAgICAgY29uc3QgW2RlblZhbCwgZGVuVW5pdF0gPSBmYWN0b3IuZGVuLnNwbGl0KCcgJyk7DQoNCiAgICAgIGxldCBkZW5DYW5jZWxsZWQgPSBmYWxzZTsNCg0KICAgICAgaWYgKGRlblVuaXQgPT09IGFjdGl2ZVVuaXQpIHsNCiAgICAgICAgZGVuQ2FuY2VsbGVkID0gdHJ1ZTsNCiAgICAgICAgaWYgKCFzdGFydFVuaXRDYW5jZWxsZWQpIHsNCiAgICAgICAgICBjYW5jZWxsYXRpb25zWydzdGFydCddID0geyB1bml0OiB0cnVlIH07DQogICAgICAgICAgc3RhcnRVbml0Q2FuY2VsbGVkID0gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAvLyBGaW5kIHRoZSBQUkVWSU9VUyBmYWN0b3Igd2hvc2UgbnVtZXJhdG9yIG1hdGNoZXMgdGhlIHVuaXQgYmVpbmcgY2FuY2VsbGVkDQogICAgICAgICAgbGV0IHByZXZGYWN0b3IgPSBudWxsOw0KICAgICAgICAgIGZvciAobGV0IGkgPSBvcmRlcmVkRmFjdG9ycy5pbmRleE9mKGZhY3RvcikgLSAxOyBpID49IDA7IGktLSkgew0KICAgICAgICAgICAgaWYgKG9yZGVyZWRGYWN0b3JzW2ldLm51bS5zcGxpdCgnICcpWzFdID09PSBhY3RpdmVVbml0KSB7DQogICAgICAgICAgICAgIHByZXZGYWN0b3IgPSBvcmRlcmVkRmFjdG9yc1tpXTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICAgIGlmIChwcmV2RmFjdG9yKSB7DQogICAgICAgICAgICBjYW5jZWxsYXRpb25zW3ByZXZGYWN0b3IuaWRdID0geyAuLi5jYW5jZWxsYXRpb25zW3ByZXZGYWN0b3IuaWRdLCBudW06IHRydWUgfTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgYWN0aXZlVW5pdCA9IG51bVVuaXQ7DQogICAgICB9DQogICAgICBjYW5jZWxsYXRpb25zW2ZhY3Rvci5pZF0gPSB7IC4uLmNhbmNlbGxhdGlvbnNbZmFjdG9yLmlkXSwgZGVuOiBkZW5DYW5jZWxsZWQgfTsNCiAgICB9DQogICAgcmV0dXJuIGNhbmNlbGxhdGlvbnM7DQogIH0sIFtzaG93U29sdXRpb24sIGlzQ29ycmVjdCwgc2VsZWN0ZWRGYWN0b3JzLCBjdXJyZW50UHJvYmxlbSwgbGl2ZUNhbmNlbGxhdGlvbl0pOw0KDQoNCiAgcmV0dXJuICgNCiAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7X19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDExMDV9fQogICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2gyJywgeyBjbGFzc05hbWU6ICJ0ZXh0LTJ4bCBmb250LWJvbGQgbWItNCB0ZXh0LWJsdWUtNDAwIiAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDExMDZ9fSwgIlVuaXQgQ2FuY2VsbGF0aW9uIiApCiAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncCcsIHsgY2xhc3NOYW1lOiAidGV4dC1ncmF5LTMwMCBtYi02IiAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMTA3fX0sICJMZWFybiBob3cgdG8gdXNlIGZyYWN0aW9ucyB0byBjYW5jZWwgdW5pdHMgYW5kIGNvbnZlcnQgbWVhc3VyZW1lbnRzIHN0ZXAgYnkgc3RlcC4iICAgICAgICAgICAgICkKCiAgICAgIC8qIFJlZHVjZWQgcGFkZGluZyBvbiBzbWFsbCBzY3JlZW5zICovCiAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJiZy1ncmF5LTcwMCByb3VuZGVkLWxnIHAtNCBzbTpwLTYgbWItNiIgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTExMH19CiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBtYi00IiAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDExMTF9fQogICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdoMycsIHsgY2xhc3NOYW1lOiAidGV4dC1sZyBzbTp0ZXh0LXhsIGZvbnQtYm9sZCB0ZXh0LXB1cnBsZS0zMDAiICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTExMn19LCBjdXJyZW50UHJvYmxlbS50aXRsZSksICIgIiAvKiBBZGp1c3RlZCB0ZXh0IHNpemUgKi8KICAgICAgICAgIC8qIEJyaWdodGVyIEFycm93cyAqLwogICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImZsZXggZ2FwLTIiICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDExMTR9fQogICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicsIHsNCiAgICAgICAgICAgICAgb25DbGljazogcHJldkxldmVsLA0KICAgICAgICAgICAgICBkaXNhYmxlZDogY3VycmVudExldmVsID09PSAxLA0KICAgICAgICAgICAgICBjbGFzc05hbWU6ICJwLTIgYmctYmx1ZS02MDAgcm91bmRlZC1mdWxsIGRpc2FibGVkOm9wYWNpdHktMzAgaG92ZXI6YmctYmx1ZS01MDAgdHJhbnNpdGlvbi1hbGwiICAgICAsDQogICAgICAgICAgICAgICdhcmlhLWxhYmVsJzogIlByZXZpb3VzIExldmVsIiAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMTE1fX0NCgogICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudChDaGV2cm9uTGVmdCwgeyBzaXplOiAyMCwgY2xhc3NOYW1lOiAidGV4dC13aGl0ZSIsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMTIxfX0gKQogICAgICAgICAgICApCiAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnYnV0dG9uJywgew0KICAgICAgICAgICAgICBvbkNsaWNrOiBuZXh0TGV2ZWwsDQogICAgICAgICAgICAgIGRpc2FibGVkOiBjdXJyZW50TGV2ZWwgPT09IE9iamVjdC5rZXlzKGxldmVscykubGVuZ3RoLA0KICAgICAgICAgICAgICBjbGFzc05hbWU6ICJwLTIgYmctYmx1ZS02MDAgcm91bmRlZC1mdWxsIGRpc2FibGVkOm9wYWNpdHktMzAgaG92ZXI6YmctYmx1ZS01MDAgdHJhbnNpdGlvbi1hbGwiICAgICAsDQogICAgICAgICAgICAgICAnYXJpYS1sYWJlbCc6ICJOZXh0IExldmVsIiAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMTIzfX0NCgogICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudChDaGV2cm9uUmlnaHQsIHsgc2l6ZTogMjAsIGNsYXNzTmFtZTogInRleHQtd2hpdGUiLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTEyOX19ICkKICAgICAgICAgICAgKQogICAgICAgICAgKQogICAgICAgICkKICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3AnLCB7IGNsYXNzTmFtZTogInRleHQtYmFzZSBzbTp0ZXh0LWxnIHRleHQtZ3JheS0yMDAgbWItNiIgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMTMzfX0sICIgIiAvKiBBZGp1c3RlZCB0ZXh0IHNpemUgKi8KICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3BhbicsIHsgY2xhc3NOYW1lOiAiZm9udC1zZW1pYm9sZCIsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMTM0fX0sICJQcm9ibGVtOiIpLCAiIENvbnZlcnQgIiAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICJmb250LWJvbGQgdGV4dC1ibHVlLTQwMCIgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTEzNH19LCBjdXJyZW50UHJvYmxlbS5wcm9ibGVtKQogICAgICAgICkKCiAgICAgICAgLyogRXF1YXRpb24gQnVpbGRlciAqLwogICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJmbGV4IGZsZXgtd3JhcCBpdGVtcy1jZW50ZXIgYmctZ3JheS04MDAgcC0yIHNtOnAtNCByb3VuZGVkLWxnIG1pbi1oLVs4MHB4XSBzbTptaW4taC1bMTAwcHhdIG92ZXJmbG93LXgtYXV0byIgICAgICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMTM4fX0sICIgIiAvKiBBZGp1c3RlZCBwYWRkaW5nL21pbi1oZWlnaHQgKi8KICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJpbmxpbmUtZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIgdGV4dC1iYXNlIHNtOnRleHQtbGcgbWQ6dGV4dC14bCBteC0xIGZvbnQtbW9ubyIgICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTEzOX19LCAiICIgLyogQWRqdXN0ZWQgdGV4dCBzaXplICovCiAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3BhbicsIHsgY2xhc3NOYW1lOiAicHgtMSBzbTpweC0yIiAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMTQwfX0sICIgIiAvKiBBZGp1c3RlZCBwYWRkaW5nICovCiAgICAgICAgICAgICAgLCBjdXJyZW50UHJvYmxlbS5zdGFydC52YWx1ZSwgJyAnCiAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6IGAke19vcHRpb25hbENoYWluKFtmaW5hbENhbmNlbGxhdGlvbnMsICdhY2Nlc3MnLCBfOCA9PiBfOFsnc3RhcnQnXSwgJ29wdGlvbmFsQWNjZXNzJywgXzkgPT4gXzkudW5pdF0pID8gJ2xpbmUtdGhyb3VnaCB0ZXh0LXJlZC00MDAnIDogJyd9YCwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDExNDJ9fQogICAgICAgICAgICAgICAgLCBjdXJyZW50UHJvYmxlbS5zdGFydC51bml0CiAgICAgICAgICAgICAgKQogICAgICAgICAgICApCiAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3BhbicsIHsgY2xhc3NOYW1lOiAiYm9yZGVyLXQgYm9yZGVyLWdyYXktNDAwIHNtOmJvcmRlci10LTIgdy1mdWxsIG15LTAuNSBzbTpteS0xIiAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTE0Nn19KSwgIiAiIC8qIEFkanVzdGVkIGJvcmRlci9tYXJnaW4gKi8KICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICJweC0xIHNtOnB4LTIiICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDExNDd9fSwgIjEiKSwgIiAiIC8qIEFkanVzdGVkIHBhZGRpbmcgKi8KICAgICAgICAgICkKCiAgICAgICAgICAsIHNlbGVjdGVkRmFjdG9ycy5sZW5ndGggPiAwICYmIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7IGNsYXNzTmFtZTogInRleHQteGwgc206dGV4dC0yeGwgbXgtMSBzbTpteC0yIGZvbnQtbW9ubyIgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTE1MH19LCAiw5ciKSwgIiAiIC8qIEFkanVzdGVkIHNpemUvbWFyZ2luICovCgogICAgICAgICAgLCBzZWxlY3RlZEZhY3RvcnMubWFwKChmYWN0b3IsIGluZGV4KSA9PiAoDQogICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChSZWFjdC5GcmFnbWVudCwgeyBrZXk6IGZhY3Rvci5pZCwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDExNTN9fQogICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudChGcmFjdGlvbiwgew0KICAgICAgICAgICAgICAgIG51bTogZmFjdG9yLm51bSwNCiAgICAgICAgICAgICAgICBkZW46IGZhY3Rvci5kZW4sDQogICAgICAgICAgICAgICAgbnVtQ2FuY2VsbGVkOiBfb3B0aW9uYWxDaGFpbihbZmluYWxDYW5jZWxsYXRpb25zLCAnYWNjZXNzJywgXzEwID0+IF8xMFtmYWN0b3IuaWRdLCAnb3B0aW9uYWxBY2Nlc3MnLCBfMTEgPT4gXzExLm51bV0pLA0KICAgICAgICAgICAgICAgIGRlbkNhbmNlbGxlZDogX29wdGlvbmFsQ2hhaW4oW2ZpbmFsQ2FuY2VsbGF0aW9ucywgJ2FjY2VzcycsIF8xMiA9PiBfMTJbZmFjdG9yLmlkXSwgJ29wdGlvbmFsQWNjZXNzJywgXzEzID0+IF8xMy5kZW5dKSwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDExNTR9fQ0KICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgLCBpbmRleCA8IHNlbGVjdGVkRmFjdG9ycy5sZW5ndGggLSAxICYmIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7IGNsYXNzTmFtZTogInRleHQteGwgc206dGV4dC0yeGwgbXgtMSBzbTpteC0yIGZvbnQtbW9ubyIgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTE2MH19LCAiw5ciKSwgIiAiIC8qIEFkanVzdGVkIHNpemUvbWFyZ2luICovCiAgICAgICAgICAgICApDQogICAgICAgICAgICkpCgogICAgICAgICAgLCBzaG93U29sdXRpb24gJiYgaXNDb3JyZWN0ICYmICgNCiAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICJ0ZXh0LXhsIHNtOnRleHQtMnhsIG14LTEgc206bXgtMiBmb250LW1vbm8iICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDExNjV9fSwgIj0iKSAvLyBBZGp1c3RlZCBzaXplL21hcmdpbg0KICAgICAgICAgICkKICAgICAgICAgICwgc2hvd1NvbHV0aW9uICYmIGlzQ29ycmVjdCAmJiAoDQogICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogInRleHQteGwgc206dGV4dC0yeGwgZm9udC1ib2xkIHRleHQtZ3JlZW4tNDAwIG1sLTEgc206bWwtMiIgICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDExNjh9fSwgIiAiIC8qIEFkanVzdGVkIHNpemUvbWFyZ2luICovCiAgICAgICAgICAgICAgLCBjdXJyZW50UHJvYmxlbS5jYWxjdWxhdGlvbi5zcGxpdCgnPScpWzFdCiAgICAgICAgICAgICkNCiAgICAgICAgICApCiAgICAgICAgKQoKICAgICAgICAvKiBGYWN0b3IgQmFuayAqLwogICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJteS02IiwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDExNzV9fQogICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdoNCcsIHsgY2xhc3NOYW1lOiAiZm9udC1zZW1pYm9sZCBtYi0zIHRleHQtZ3JheS0zMDAgdGV4dC1zbSBzbTp0ZXh0LWJhc2UiICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDExNzZ9fSwgIkNob29zZSB5b3VyIGNvbnZlcnNpb24gZmFjdG9yKHMpOiIgICApLCAiICIgLyogQWRqdXN0ZWQgdGV4dCBzaXplICovCiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAiZmxleCBmbGV4LXdyYXAgZ2FwLTIgc206Z2FwLTMiICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTE3N319LCAiICIgLyogQWRqdXN0ZWQgZ2FwICovCiAgICAgICAgICAgICwgY3VycmVudFByb2JsZW0uZmFjdG9ycy5tYXAoZmFjdG9yID0+IHsNCiAgICAgICAgICAgICAgY29uc3QgaXNTZWxlY3RlZCA9IHNlbGVjdGVkRmFjdG9ycy5zb21lKGYgPT4gZi5pZCA9PT0gZmFjdG9yLmlkKTsNCiAgICAgICAgICAgICAgcmV0dXJuICgNCiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdidXR0b24nLCB7DQogICAgICAgICAgICAgICAgICBrZXk6IGZhY3Rvci5pZCwNCiAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6ICgpID0+IGhhbmRsZUZhY3RvckNsaWNrKGZhY3RvciksDQogICAgICAgICAgICAgICAgICBkaXNhYmxlZDogc2hvd1NvbHV0aW9uLA0KICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBgdHJhbnNpdGlvbi1hbGwgcC0xIHNtOnAtMiByb3VuZGVkLWxnICR7IC8vIEFkanVzdGVkIHBhZGRpbmcNCiAgICAgICAgICAgICAgICAgICAgaXNTZWxlY3RlZA0KICAgICAgICAgICAgICAgICAgICAgID8gJ2JnLWJsdWUtNjAwIHRleHQtd2hpdGUgc2hhZG93LWxnJw0KICAgICAgICAgICAgICAgICAgICAgIDogJ2JnLWdyYXktNjAwIHRleHQtZ3JheS0yMDAgaG92ZXI6YmctZ3JheS01MDAnDQogICAgICAgICAgICAgICAgICB9ICR7c2hvd1NvbHV0aW9uID8gJ29wYWNpdHktNTAgY3Vyc29yLW5vdC1hbGxvd2VkJyA6ICdjdXJzb3ItcG9pbnRlcid9YCwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDExODF9fQ0KCiAgICAgICAgICAgICAgICAgIC8qIEZyYWN0aW9uIGNvbXBvbmVudCBhbHJlYWR5IGhhbmRsZXMgcmVzcG9uc2l2ZSB0ZXh0IHNpemUgKi8KICAgICAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KEZyYWN0aW9uLCB7IG51bTogZmFjdG9yLm51bSwgZGVuOiBmYWN0b3IuZGVuLCBudW1DYW5jZWxsZWQ6IGZhbHNlLCBkZW5DYW5jZWxsZWQ6IGZhbHNlLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTE5Mn19ICkKICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgIH0pCiAgICAgICAgICApCiAgICAgICAgKQoKICAgICAgICAvKiBIaW50IEJveCAqLwogICAgICAgICwgaGludCAmJiAhc2hvd1NvbHV0aW9uICYmICgNCiAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogYG15LTQgcC0zIHJvdW5kZWQtbGcgYm9yZGVyLTIgJHsNCiAgICAgICAgICAgIGhpbnQudHlwZSA9PT0gJ2dvb2QnID8gJ2JnLWdyZWVuLTkwMC81MCBib3JkZXItZ3JlZW4tNTAwJyA6DQogICAgICAgICAgICBoaW50LnR5cGUgPT09ICd3YXJuJyA/ICdiZy1vcmFuZ2UtOTAwLzUwIGJvcmRlci1vcmFuZ2UtNTAwJyA6DQogICAgICAgICAgICAnYmctcmVkLTkwMC81MCBib3JkZXItcmVkLTUwMCcNCiAgICAgICAgICB9YCwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEyMDF9fQogICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAiZmxleCBpdGVtcy1zdGFydCBnYXAtMiIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEyMDZ9fQogICAgICAgICAgICAgICwgaGludC50eXBlID09PSAnZ29vZCcgPyBSZWFjdC5jcmVhdGVFbGVtZW50KENoZWNrLCB7IHNpemU6IDIwLCBjbGFzc05hbWU6ICJtdC0wLjUgZmxleC1zaHJpbmstMCB0ZXh0LWdyZWVuLTQwMCIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEyMDd9fSApIDogUmVhY3QuY3JlYXRlRWxlbWVudChMaWdodGJ1bGIsIHsgc2l6ZTogMjAsIGNsYXNzTmFtZTogIm10LTAuNSBmbGV4LXNocmluay0wIHRleHQteWVsbG93LTQwMCIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEyMDd9fSApCiAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdwJywgeyBjbGFzc05hbWU6ICJ0ZXh0LXNtIiwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEyMDh9fSwgIiAiIC8qIEtlZXAgaGludCB0ZXh0IHNtYWxsICovCiAgICAgICAgICAgICAgICAsIGhpbnQubWVzc2FnZQogICAgICAgICAgICAgICkKICAgICAgICAgICAgKQogICAgICAgICAgKQ0KICAgICAgICApCgogICAgICAgIC8qIENvbnRyb2xzICovCiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImZsZXggZmxleC1jb2wgc206ZmxleC1yb3cgZmxleC13cmFwIGdhcC00IG10LTYiICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMjE2fX0KICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnYnV0dG9uJywgew0KICAgICAgICAgICAgb25DbGljazogY2hlY2tBbnN3ZXIsDQogICAgICAgICAgICBkaXNhYmxlZDogc2hvd1NvbHV0aW9uLA0KICAgICAgICAgICAgY2xhc3NOYW1lOiAicHgtNSBweS0yLjUgc206cHgtNiBzbTpweS0zIGJnLWJsdWUtNjAwIGhvdmVyOmJnLWJsdWUtNzAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBmb250LXNlbWlib2xkIHRyYW5zaXRpb24tYWxsIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIGp1c3RpZnktY2VudGVyIGRpc2FibGVkOm9wYWNpdHktNTAiICAgICAgICAgICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMjE3fX0NCgogICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ2hlY2ssIHsgc2l6ZTogMjAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMjIyfX0gKSwgIiBDaGVjayBBbnN3ZXIiCiAgICAgICAgICApCiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicsIHsNCiAgICAgICAgICAgIG9uQ2xpY2s6IHJlc2V0LA0KICAgICAgICAgICAgY2xhc3NOYW1lOiAicHgtNSBweS0yLjUgc206cHgtNiBzbTpweS0zIGJnLWdyYXktNjAwIGhvdmVyOmJnLWdyYXktNTAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBmb250LXNlbWlib2xkIHRyYW5zaXRpb24tYWxsIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIGp1c3RpZnktY2VudGVyIiAgICAgICAgICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMjI0fX0NCgogICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoUmVmcmVzaEN3LCB7IHNpemU6IDE4LCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTIyOH19ICksICIgUmVzZXQiCiAgICAgICAgICApCiAgICAgICAgKQoKICAgICAgICAvKiBTb2x1dGlvbiBGZWVkYmFjayAqLwogICAgICAgICwgc2hvd1NvbHV0aW9uICYmICgNCiAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogYG10LTYgcC00IHJvdW5kZWQtbGcgYm9yZGVyLTIgJHsNCiAgICAgICAgICAgIGlzQ29ycmVjdCA/ICdiZy1ncmVlbi05MDAvNTAgYm9yZGVyLWdyZWVuLTUwMCcgOiAnYmctcmVkLTkwMC81MCBib3JkZXItcmVkLTUwMCcNCiAgICAgICAgICB9YCwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEyMzR9fQogICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAiZmxleCBpdGVtcy1zdGFydCBnYXAtMyIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEyMzd9fQogICAgICAgICAgICAgICwgaXNDb3JyZWN0ID8gUmVhY3QuY3JlYXRlRWxlbWVudChUcm9waHksIHsgc2l6ZTogMjQsIGNsYXNzTmFtZTogInRleHQteWVsbG93LTQwMCIsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMjM4fX0gKSA6IFJlYWN0LmNyZWF0ZUVsZW1lbnQoWCwgeyBzaXplOiAyNCwgY2xhc3NOYW1lOiAidGV4dC1yZWQtNDAwIiwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEyMzh9fSApCiAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7X19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEyMzl9fQogICAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdoNCcsIHsgY2xhc3NOYW1lOiAiZm9udC1ib2xkIHRleHQtbGcgbWItMiIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEyNDB9fQogICAgICAgICAgICAgICAgICAsIGlzQ29ycmVjdCA/ICdDb3JyZWN0IScgOiAnTm90IFF1aXRlIScKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncCcsIHsgY2xhc3NOYW1lOiAibWItMiB0ZXh0LXNtIHNtOnRleHQtYmFzZSIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEyNDN9fSwgIiAiIC8qIEFkanVzdGVkIHRleHQgc2l6ZSAqLwogICAgICAgICAgICAgICAgICAsIGlzQ29ycmVjdCA/IGN1cnJlbnRQcm9ibGVtLmV4cGxhbmF0aW9uIDogJ1lvdXIgc2VsZWN0ZWQgZmFjdG9ycyBkb25cJ3QgbWF0Y2ggdGhlIHNvbHV0aW9uLiBUcnkgYWdhaW4hJwogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgLCBpc0NvcnJlY3QgJiYgKA0KICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJmb250LW1vbm8gYmctZ3JheS04MDAgcC0yIHNtOnAtMyByb3VuZGVkIG10LTIgdGV4dC1zbSBzbTp0ZXh0LWJhc2UiICAgICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEyNDd9fSwgIiAiIC8qIEFkanVzdGVkIHBhZGRpbmcvdGV4dCBzaXplICovLCAiQ2FsY3VsYXRpb246ICIKICAgICAgICAgICAgICAgICAgICAgLCBjdXJyZW50UHJvYmxlbS5jYWxjdWxhdGlvbgogICAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICkKICAgICAgICAgICAgKQogICAgICAgICAgKQ0KICAgICAgICApCiAgICAgICkKICAgICkNCiAgKTsNCn07DQoNCg0KLy8gVGFiIDQ6IFByYWN0aWNlDQpjb25zdCBQcmFjdGljZVRhYiA9ICgpID0+IHsNCiAgY29uc3QgW3F1ZXN0aW9ucywgc2V0UXVlc3Rpb25zXSA9IHVzZVN0YXRlKFtdKTsNCiAgY29uc3QgW2N1cnJlbnRRdWVzdGlvbkluZGV4LCBzZXRDdXJyZW50UXVlc3Rpb25JbmRleF0gPSB1c2VTdGF0ZSgwKTsNCiAgY29uc3QgW3VzZXJBbnN3ZXJzLCBzZXRVc2VyQW5zd2Vyc10gPSB1c2VTdGF0ZSh7fSk7DQogIGNvbnN0IFtzaG93RmVlZGJhY2ssIHNldFNob3dGZWVkYmFja10gPSB1c2VTdGF0ZShmYWxzZSk7DQogIGNvbnN0IFt1c2VkUXVlc3Rpb25JZHMsIHNldFVzZWRRdWVzdGlvbklkc10gPSB1c2VTdGF0ZShbXSk7DQogIGNvbnN0IFtzY29yZSwgc2V0U2NvcmVdID0gdXNlU3RhdGUoMCk7DQoNCiAgY29uc3QgYWxsUXVlc3Rpb25zID0gdXNlTWVtbygoKSA9PiBbDQogICAgeyBpZDogMSwgcTogJ0NvbnZlcnQgNS41IG1ldGVycyB0byBjZW50aW1ldGVycy4nLCBhOiA1NTAsIHVuaXQ6ICdjbScsIHR5cGU6ICdzaW1wbGUnIH0sDQogICAgeyBpZDogMiwgcTogJ0NvbnZlcnQgMi41IGtpbG9tZXRlcnMgdG8gbWV0ZXJzLicsIGE6IDI1MDAsIHVuaXQ6ICdtJywgdHlwZTogJ3NpbXBsZScgfSwNCiAgICB7IGlkOiAzLCBxOiAnQ29udmVydCAxNTAwIGdyYW1zIHRvIGtpbG9ncmFtcy4nLCBhOiAxLjUsIHVuaXQ6ICdrZycsIHR5cGU6ICdzaW1wbGUnIH0sDQogICAgeyBpZDogNCwgcTogJ0NvbnZlcnQgNzUwIG1pbGxpZ3JhbXMgdG8gZ3JhbXMuJywgYTogMC43NSwgdW5pdDogJ2cnLCB0eXBlOiAnc2ltcGxlJyB9LA0KICAgIHsgaWQ6IDUsIHE6ICdDb252ZXJ0IDMuMiBsaXRlcnMgdG8gbWlsbGlsaXRlcnMuJywgYTogMzIwMCwgdW5pdDogJ21MJywgdHlwZTogJ3NpbXBsZScgfSwNCiAgICB7IGlkOiA2LCBxOiAnQ29udmVydCA0NSBzZWNvbmRzIHRvIG1pbnV0ZXMuJywgYTogMC43NSwgdW5pdDogJ21pbicsIHR5cGU6ICdzaW1wbGUnIH0sDQogICAgeyBpZDogNywgcTogJ0NvbnZlcnQgMi41IGhvdXJzIHRvIG1pbnV0ZXMuJywgYTogMTUwLCB1bml0OiAnbWluJywgdHlwZTogJ3NpbXBsZScgfSwNCiAgICB7IGlkOiA4LCBxOiAnSG93IG1hbnkgaW5jaGVzIGFyZSBpbiA1MC44IGNtPyAoMSBpbmNoID0gMi41NCBjbSknLCBhOiAyMCwgdW5pdDogJ2luJywgdHlwZTogJ21peGVkJyB9LA0KICAgIHsgaWQ6IDksIHE6ICdIb3cgbWFueSBraWxvZ3JhbXMgaXMgMTY1IGxicz8gKDEga2cg4omIIDIuMiBsYnMpJywgYTogNzUsIHVuaXQ6ICdrZycsIHR5cGU6ICdtaXhlZCcgfSwNCiAgICB7IGlkOiAxMCwgcTogJ0hvdyBtYW55IG1ldGVycyBhcmUgaW4gMS4yIG1pbGVzPyAoMSBtaWxlIOKJiCAxLjYwOSBrbSknLCBhOiAxOTMwLjgsIHVuaXQ6ICdtJywgdHlwZTogJ2NoYWxsZW5nZScgfSwNCiAgICB7IGlkOiAxMSwgcTogJ0NvbnZlcnQgMiBkYXlzIGludG8gc2Vjb25kcy4nLCBhOiAxNzI4MDAsIHVuaXQ6ICdzJywgdHlwZTogJ2NoYWxsZW5nZScgfSwNCiAgICB7IGlkOiAxMiwgcTogJ0NvbnZlcnQgMC41IGtnIHRvIG1pbGxpZ3JhbXMuJywgYTogNTAwMDAwLCB1bml0OiAnbWcnLCB0eXBlOiAnY2hhbGxlbmdlJyB9LA0KICAgIHsgaWQ6IDEzLCBxOiAnSG93IG1hbnkgVVMgZ2FsbG9ucyBpcyAyMCBsaXRlcnM/ICgxIGdhbCDiiYggMy43ODUgTCknLCBhOiA1LjI4LCB1bml0OiAnZ2FsJywgdHlwZTogJ21peGVkJyB9LA0KICBdLCBbXSk7DQoNCiAgY29uc3QgZ2VuZXJhdGVRdWVzdGlvbnMgPSB1c2VDYWxsYmFjaygoKSA9PiB7DQogICAgbGV0IGF2YWlsYWJsZSA9IGFsbFF1ZXN0aW9ucy5maWx0ZXIocSA9PiAhdXNlZFF1ZXN0aW9uSWRzLmluY2x1ZGVzKHEuaWQpKTsNCiAgICBpZiAoYXZhaWxhYmxlLmxlbmd0aCA8IDUpIHsNCiAgICAgIHNldFVzZWRRdWVzdGlvbklkcyhbXSk7DQogICAgICBhdmFpbGFibGUgPSBhbGxRdWVzdGlvbnM7DQogICAgfQ0KDQogICAgY29uc3Qgc2h1ZmZsZWQgPSBbLi4uYXZhaWxhYmxlXS5zb3J0KCgpID0+IDAuNSAtIE1hdGgucmFuZG9tKCkpOw0KICAgIGNvbnN0IHNlbGVjdGVkID0gc2h1ZmZsZWQuc2xpY2UoMCwgNSk7DQoNCiAgICBzZXRRdWVzdGlvbnMoc2VsZWN0ZWQpOw0KICAgIHNldFVzZWRRdWVzdGlvbklkcyhwcmV2ID0+IFsuLi5wcmV2LCAuLi5zZWxlY3RlZC5tYXAocSA9PiBxLmlkKV0pOw0KICAgIHNldEN1cnJlbnRRdWVzdGlvbkluZGV4KDApOw0KICAgIHNldFVzZXJBbnN3ZXJzKHt9KTsNCiAgICBzZXRTaG93RmVlZGJhY2soZmFsc2UpOw0KICAgIHNldFNjb3JlKDApOw0KICB9LCBbYWxsUXVlc3Rpb25zLCB1c2VkUXVlc3Rpb25JZHNdKTsNCg0KICB1c2VFZmZlY3QoKCkgPT4gew0KICAgIGlmIChxdWVzdGlvbnMubGVuZ3RoID09PSAwKSB7DQogICAgICBnZW5lcmF0ZVF1ZXN0aW9ucygpOw0KICAgIH0NCiAgfSwgW3F1ZXN0aW9ucywgZ2VuZXJhdGVRdWVzdGlvbnNdKTsNCg0KICBjb25zdCBoYW5kbGVBbnN3ZXJDaGFuZ2UgPSAoZSkgPT4gew0KICAgIHNldFVzZXJBbnN3ZXJzKHsNCiAgICAgIC4uLnVzZXJBbnN3ZXJzLA0KICAgICAgW2N1cnJlbnRRdWVzdGlvbkluZGV4XTogZS50YXJnZXQudmFsdWUNCiAgICB9KTsNCiAgfTsNCg0KICBjb25zdCBjaGVja0Fuc3dlciA9ICgpID0+IHsNCiAgICBjb25zdCB1c2VyQW5zd2VyID0gcGFyc2VGbG9hdCh1c2VyQW5zd2Vyc1tjdXJyZW50UXVlc3Rpb25JbmRleF0pOw0KICAgIGNvbnN0IGNvcnJlY3RBbnN3ZXIgPSBxdWVzdGlvbnNbY3VycmVudFF1ZXN0aW9uSW5kZXhdLmE7DQoNCiAgICAvLyBDaGVjayBmb3IgZmxvYXRpbmcgcG9pbnQgaXNzdWVzLCBhbGxvd2luZyBmb3Igc2xpZ2h0IHJvdW5kaW5nIGRpZmZlcmVuY2VzDQogICAgY29uc3QgdG9sZXJhbmNlID0gMC4wMTsgLy8gQWxsb3cgZm9yIDAuMDEgZGlmZmVyZW5jZQ0KICAgIGNvbnN0IGlzQ29ycmVjdCA9IE1hdGguYWJzKHVzZXJBbnN3ZXIgLSBjb3JyZWN0QW5zd2VyKSA8IHRvbGVyYW5jZSB8fA0KICAgICAgICAgICAgICAgICAgICAgIC8vIEFsbG93IGFuc3dlciByb3VuZGVkIHRvIDIgZGVjaW1hbCBwbGFjZXMgaWYgY29ycmVjdCBhbnN3ZXIgaGFzIGRlY2ltYWxzDQogICAgICAgICAgICAgICAgICAgICAgKGNvcnJlY3RBbnN3ZXIgJSAxICE9PSAwICYmIE1hdGguYWJzKHVzZXJBbnN3ZXIgLSBwYXJzZUZsb2F0KGNvcnJlY3RBbnN3ZXIudG9GaXhlZCgyKSkpIDwgdG9sZXJhbmNlKTsNCg0KICAgIGlmIChpc0NvcnJlY3QpIHsNCiAgICAgIHNldFNjb3JlKHMgPT4gcyArIDEpOw0KICAgIH0NCiAgICBzZXRTaG93RmVlZGJhY2sodHJ1ZSk7DQogIH07DQoNCiAgY29uc3QgbmV4dFF1ZXN0aW9uID0gKCkgPT4gew0KICAgIHNldFNob3dGZWVkYmFjayhmYWxzZSk7DQogICAgc2V0Q3VycmVudFF1ZXN0aW9uSW5kZXgoaSA9PiBpICsgMSk7DQogIH07DQoNCiAgaWYgKHF1ZXN0aW9ucy5sZW5ndGggPT09IDApIHsNCiAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2Jywge19fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMzM5fX0sICJMb2FkaW5nIHF1ZXN0aW9ucy4uLiIgKTsNCiAgfQ0KDQogIGNvbnN0IGlzUXVpek92ZXIgPSBjdXJyZW50UXVlc3Rpb25JbmRleCA+PSBxdWVzdGlvbnMubGVuZ3RoOw0KDQogIGlmIChpc1F1aXpPdmVyKSB7DQogICAgcmV0dXJuICgNCiAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTM0Nn19CiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdoMicsIHsgY2xhc3NOYW1lOiAidGV4dC0yeGwgZm9udC1ib2xkIG1iLTQgdGV4dC1ibHVlLTQwMCIgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMzQ3fX0sICJQcmFjdGljZSBDb21wbGV0ZSEiICkKICAgICAgICAvKiBBZGp1c3RlZCBwYWRkaW5nICovCiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImJnLWdyYXktNzAwIHJvdW5kZWQtbGcgcC02IHNtOnAtOCB0ZXh0LWNlbnRlciIgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTM0OX19CiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoVHJvcGh5LCB7IHNpemU6IDY0LCBjbGFzc05hbWU6ICJ0ZXh0LXllbGxvdy00MDAgbXgtYXV0byBtYi02IiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTM1MH19ICkKICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnaDMnLCB7IGNsYXNzTmFtZTogInRleHQtMnhsIHNtOnRleHQtM3hsIGZvbnQtYm9sZCBtYi00IiAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEzNTF9fSwgIllvdXIgU2NvcmU6ICIgICwgc2NvcmUsICIgLyAiICAsIHF1ZXN0aW9ucy5sZW5ndGgpLCAiICIgLyogQWRqdXN0ZWQgdGV4dCBzaXplICovCiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3AnLCB7IGNsYXNzTmFtZTogInRleHQtZ3JheS0zMDAgbWItOCB0ZXh0LXNtIHNtOnRleHQtYmFzZSIgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMzUyfX0sICIgIiAvKiBBZGp1c3RlZCB0ZXh0IHNpemUgKi8KICAgICAgICAgICAgLCBzY29yZSA9PT0gcXVlc3Rpb25zLmxlbmd0aCA/ICJBbWF6aW5nIHdvcmshIFlvdSdyZSBhIHVuaXQgY29udmVyc2lvbiBtYXN0ZXIhIiA6ICJHcmVhdCBlZmZvcnQhIEtlZXAgcHJhY3RpY2luZyB0byBpbXByb3ZlLiIKICAgICAgICAgICkKICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnYnV0dG9uJywgew0KICAgICAgICAgICAgb25DbGljazogZ2VuZXJhdGVRdWVzdGlvbnMsDQogICAgICAgICAgICBjbGFzc05hbWU6ICJweC02IHB5LTMgYmctYmx1ZS02MDAgaG92ZXI6YmctYmx1ZS03MDAgdGV4dC13aGl0ZSByb3VuZGVkLWxnIGZvbnQtc2VtaWJvbGQgdHJhbnNpdGlvbi1hbGwgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgbXgtYXV0byIgICAgICAgICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEzNTV9fQ0KCiAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudChSZWZyZXNoQ3csIHsgc2l6ZTogMjAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMzU5fX0gKSwgIiBUcnkgTmV3IFF1ZXN0aW9ucyIKICAgICAgICAgICkKICAgICAgICApCiAgICAgICkNCiAgICApOw0KICB9DQoNCiAgY29uc3QgY3VycmVudFF1ZXN0aW9uID0gcXVlc3Rpb25zW2N1cnJlbnRRdWVzdGlvbkluZGV4XTsNCiAgY29uc3QgdXNlckFuc3dlciA9IHVzZXJBbnN3ZXJzW2N1cnJlbnRRdWVzdGlvbkluZGV4XTsNCg0KICBsZXQgaXNDb3JyZWN0ID0gZmFsc2U7DQogIGlmIChzaG93RmVlZGJhY2spIHsNCiAgICBjb25zdCB1c2VyQW5zd2VyTnVtID0gcGFyc2VGbG9hdCh1c2VyQW5zd2VyKTsNCiAgICBjb25zdCBjb3JyZWN0QW5zd2VyID0gY3VycmVudFF1ZXN0aW9uLmE7DQogICAgY29uc3QgdG9sZXJhbmNlID0gMC4wMTsNCiAgICAgaXNDb3JyZWN0ID0gTWF0aC5hYnModXNlckFuc3dlck51bSAtIGNvcnJlY3RBbnN3ZXIpIDwgdG9sZXJhbmNlIHx8DQogICAgICAgICAgICAgICAgICAgICAgKGNvcnJlY3RBbnN3ZXIgJSAxICE9PSAwICYmIE1hdGguYWJzKHVzZXJBbnN3ZXJOdW0gLSBwYXJzZUZsb2F0KGNvcnJlY3RBbnN3ZXIudG9GaXhlZCgyKSkpIDwgdG9sZXJhbmNlKTsNCiAgfQ0KDQogIHJldHVybiAoDQogICAgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2Jywge19fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMzc5fX0KICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdoMicsIHsgY2xhc3NOYW1lOiAidGV4dC0yeGwgZm9udC1ib2xkIG1iLTQgdGV4dC1ibHVlLTQwMCIgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMzgwfX0sICJQcmFjdGljZSBab25lIiApCiAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncCcsIHsgY2xhc3NOYW1lOiAidGV4dC1ncmF5LTMwMCBtYi02IiAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMzgxfX0sICJUZXN0IHlvdXIga25vd2xlZGdlISBFbnRlciB0aGUgY29ycmVjdCBudW1iZXIgZm9yIHRoZSBjb252ZXJzaW9uLiIgICAgICAgICApCgogICAgICAvKiBBZGp1c3RlZCBwYWRkaW5nICovCiAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJiZy1ncmF5LTcwMCByb3VuZGVkLWxnIHAtNiBzbTpwLTgiICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTM4NH19CiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBtYi00IiAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEzODV9fQogICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICJ0ZXh0LXNtIGZvbnQtc2VtaWJvbGQgdGV4dC1ncmF5LTQwMCIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEzODZ9fSwgIlF1ZXN0aW9uICIgLCBjdXJyZW50UXVlc3Rpb25JbmRleCArIDEsICIgb2YgIiAgLCBxdWVzdGlvbnMubGVuZ3RoKQogICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6IGBweC0zIHB5LTEgcm91bmRlZC1mdWxsIHRleHQteHMgZm9udC1ib2xkICR7DQogICAgICAgICAgICBjdXJyZW50UXVlc3Rpb24udHlwZSA9PT0gJ3NpbXBsZScgPyAnYmctZ3JlZW4tODAwIHRleHQtZ3JlZW4tMjAwJyA6DQogICAgICAgICAgICBjdXJyZW50UXVlc3Rpb24udHlwZSA9PT0gJ21peGVkJyA/ICdiZy15ZWxsb3ctODAwIHRleHQteWVsbG93LTIwMCcgOg0KICAgICAgICAgICAgJ2JnLXJlZC04MDAgdGV4dC1yZWQtMjAwJw0KICAgICAgICAgIH1gLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTM4N319CiAgICAgICAgICAgICwgY3VycmVudFF1ZXN0aW9uLnR5cGUKICAgICAgICAgICkKICAgICAgICApCgogICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnaDMnLCB7IGNsYXNzTmFtZTogInRleHQtbGcgc206dGV4dC14bCBmb250LXNlbWlib2xkIG1iLTYgdGV4dC1ncmF5LTIwMCIgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTM5Nn19LCBjdXJyZW50UXVlc3Rpb24ucSksICIgIiAvKiBBZGp1c3RlZCB0ZXh0IHNpemUgKi8KCiAgICAgICAgLyogUmVzcG9uc2l2ZSBpbnB1dCBncm91cCAqLwogICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJmbGV4IGZsZXgtY29sIHNtOmZsZXgtcm93IGdhcC0yIGl0ZW1zLXN0cmV0Y2ggc206aXRlbXMtY2VudGVyIiAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTM5OX19CiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jywgew0KICAgICAgICAgICAgdHlwZTogIm51bWJlciIsDQogICAgICAgICAgICBzdGVwOiAiYW55IiwNCiAgICAgICAgICAgIHZhbHVlOiB1c2VyQW5zd2VyIHx8ICcnLA0KICAgICAgICAgICAgb25DaGFuZ2U6IGhhbmRsZUFuc3dlckNoYW5nZSwNCiAgICAgICAgICAgIGRpc2FibGVkOiBzaG93RmVlZGJhY2ssDQogICAgICAgICAgICBjbGFzc05hbWU6ICJwcmFjdGljZS1pbnB1dCBmbGV4LWdyb3cgdy1mdWxsIHNtOnctYXV0byBweC00IHB5LTMgYmctZ3JheS04MDAgYm9yZGVyLTIgYm9yZGVyLWdyYXktNjAwIHJvdW5kZWQtbGcgdGV4dC13aGl0ZSB0ZXh0LWxnIGZvY3VzOm91dGxpbmUtbm9uZSBmb2N1czpib3JkZXItYmx1ZS01MDAgZGlzYWJsZWQ6b3BhY2l0eS01MCIgICAgICAgICAgICAgICwNCiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAiVHlwZSB5b3VyIGFuc3dlciIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDE0MDB9fQ0KICAgICAgICAgICkKICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3BhbicsIHsgY2xhc3NOYW1lOiAidGV4dC1sZyBmb250LXNlbWlib2xkIHRleHQtZ3JheS0zMDAgc2VsZi1jZW50ZXIgc206c2VsZi1hdXRvIiAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxNDA5fX0sIGN1cnJlbnRRdWVzdGlvbi51bml0KSwgIiAiIC8qIENlbnRlcmVkIHRleHQgb24gc21hbGwgc2NyZWVucyAqLwogICAgICAgICkKCiAgICAgICAgLCBzaG93RmVlZGJhY2sgJiYgKA0KICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiBgbXQtNiBwLTQgcm91bmRlZC1sZyBib3JkZXItMiAkew0KICAgICAgICAgICAgaXNDb3JyZWN0ID8gJ2JnLWdyZWVuLTkwMC81MCBib3JkZXItZ3JlZW4tNTAwJyA6ICdiZy1yZWQtOTAwLzUwIGJvcmRlci1yZWQtNTAwJw0KICAgICAgICAgIH1gLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTQxM319CiAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJmbGV4IGl0ZW1zLXN0YXJ0IGdhcC0zIiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTQxNn19CiAgICAgICAgICAgICAgLCBpc0NvcnJlY3QgPyBSZWFjdC5jcmVhdGVFbGVtZW50KENoZWNrLCB7IHNpemU6IDI0LCBjbGFzc05hbWU6ICJ0ZXh0LWdyZWVuLTQwMCIsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxNDE3fX0gKSA6IFJlYWN0LmNyZWF0ZUVsZW1lbnQoWCwgeyBzaXplOiAyNCwgY2xhc3NOYW1lOiAidGV4dC1yZWQtNDAwIiwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDE0MTd9fSApCiAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7X19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDE0MTh9fQogICAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdoNCcsIHsgY2xhc3NOYW1lOiAiZm9udC1ib2xkIHRleHQtbGcgbWItMSIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDE0MTl9fQogICAgICAgICAgICAgICAgICAsIGlzQ29ycmVjdCA/ICdDb3JyZWN0IScgOiAnSW5jb3JyZWN0JwogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdwJywgeyBjbGFzc05hbWU6ICJ0ZXh0LWJhc2UiLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTQyMn19LCAiVGhlIGNvcnJlY3QgYW5zd2VyIGlzICIKICAgICAgICAgICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3BhbicsIHsgY2xhc3NOYW1lOiAiZm9udC1ib2xkIiwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDE0MjN9fSwgY3VycmVudFF1ZXN0aW9uLmEsICIgIiAsIGN1cnJlbnRRdWVzdGlvbi51bml0KSwgIi4iCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgKQogICAgICAgICAgICApCiAgICAgICAgICApDQogICAgICAgICkKCiAgICAgICAgLyogQnV0dG9ucyBmdWxsIHdpZHRoIG9uIHNtYWxsIHNjcmVlbnMgKi8KICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAibXQtOCBmbGV4IGZsZXgtY29sIHNtOmZsZXgtcm93IGdhcC00IiAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxNDMxfX0KICAgICAgICAgICwgIXNob3dGZWVkYmFjayA/ICgNCiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicsIHsNCiAgICAgICAgICAgICAgb25DbGljazogY2hlY2tBbnN3ZXIsDQogICAgICAgICAgICAgIGRpc2FibGVkOiAhdXNlckFuc3dlciwNCiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAicHgtNiBweS0zIGJnLWJsdWUtNjAwIGhvdmVyOmJnLWJsdWUtNzAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBmb250LXNlbWlib2xkIHRyYW5zaXRpb24tYWxsIHctZnVsbCBzbTp3LWF1dG8gZGlzYWJsZWQ6b3BhY2l0eS01MCIgICAgICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTQzM319DQosICJDaGVjayBBbnN3ZXIiCgogICAgICAgICAgICApDQogICAgICAgICAgKSA6ICgNCiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicsIHsNCiAgICAgICAgICAgICAgb25DbGljazogbmV4dFF1ZXN0aW9uLA0KICAgICAgICAgICAgICBjbGFzc05hbWU6ICJweC02IHB5LTMgYmctcHVycGxlLTYwMCBob3ZlcjpiZy1wdXJwbGUtNzAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBmb250LXNlbWlib2xkIHRyYW5zaXRpb24tYWxsIHctZnVsbCBzbTp3LWF1dG8gZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgZ2FwLTIiICAgICAgICAgICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDE0NDF9fQ0KLCAiTmV4dCBRdWVzdGlvbiAiCiAgICAgICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ2hldnJvblJpZ2h0LCB7IHNpemU6IDIwLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTQ0NX19ICkKICAgICAgICAgICAgKQ0KICAgICAgICAgICkKICAgICAgICApCiAgICAgICkKICAgICkNCiAgKTsNCn07DQoNCg0KLy8gTWFpbiBBcHAgQ29tcG9uZW50DQpjb25zdCBVbml0Q29udmVyc2lvbkFwcCA9ICgpID0+IHsNCiAgY29uc3QgW2FjdGl2ZVRhYiwgc2V0QWN0aXZlVGFiXSA9IHVzZVN0YXRlKDApOw0KDQogIC8vIEZvcmNlIGRhcmsgbW9kZSBvbiBpbml0aWFsIGxvYWQNCiAgdXNlRWZmZWN0KCgpID0+IHsNCiAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnZGFyaycpOw0KICAgIHJldHVybiAoKSA9PiB7DQogICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2RhcmsnKTsNCiAgICB9DQogIH0sIFtdKTsNCg0KDQogIGNvbnN0IHRhYnMgPSBbJ1NjYWxlJywgJ0NvbnZlcnNpb25zJywgJ0NhbmNlbGxhdGlvbicsICdQcmFjdGljZSddOw0KDQogIHJldHVybiAoDQogICAgLy8gRW5zdXJlIGRhcmsgbW9kZSBzdHlsZXMsIGFkanVzdGVkIHBhZGRpbmcgZm9yIG1vYmlsZQ0KICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAibWluLWgtc2NyZWVuIGJnLWdyYXktOTAwIHRleHQtZ3JheS0xMDAgcC00IG1kOnAtNiIgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTQ3Mn19CiAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJtYXgtdy02eGwgbXgtYXV0byIgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTQ3M319CiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdoZWFkZXInLCB7IGNsYXNzTmFtZTogIm1iLTYgbWQ6bWItOCBmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIiICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDE0NzR9fQogICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7X19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDE0NzV9fQogICAgICAgICAgICAvKiBBZGp1c3RlZCBmb250IHNpemUgZm9yIG1vYmlsZSAqLwogICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2gxJywgeyBjbGFzc05hbWU6ICJ0ZXh0LTJ4bCBzbTp0ZXh0LTN4bCBtZDp0ZXh0LTR4bCBmb250LWJvbGQgbWItMSBiZy1ncmFkaWVudC10by1yIGZyb20tYmx1ZS01MDAgdG8tcHVycGxlLTUwMCBiZy1jbGlwLXRleHQgdGV4dC10cmFuc3BhcmVudCIgICAgICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxNDc3fX0sICJVbml0IENvbnZlcnNpb24iCgogICAgICAgICAgICApCiAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncCcsIHsgY2xhc3NOYW1lOiAidGV4dC1zbSBtZDp0ZXh0LWJhc2UgdGV4dC1ncmF5LTQwMCIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDE0ODB9fSwgIkxlYXJuIG1lYXN1cmVtZW50IGFuZCB1bml0IGNvbnZlcnNpb25zIHN0ZXAgYnkgc3RlcCIgICAgICAgKQogICAgICAgICAgKQogICAgICAgICkKCiAgICAgICAgLyogVGFicyAqLwogICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnbmF2JywgeyBjbGFzc05hbWU6ICJtYi02IG1kOm1iLTgiICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDE0ODV9fQogICAgICAgICAgIC8qIEFsbG93IGhvcml6b250YWwgc2Nyb2xsaW5nIG9uIHNtYWxsIHNjcmVlbnMgaWYgdGFicyBvdmVyZmxvdyAqLwogICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImZsZXggZmxleC1ub3dyYXAgc206ZmxleC13cmFwIGdhcC0yIHBiLTIgb3ZlcmZsb3cteC1hdXRvIiAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTQ4N319CiAgICAgICAgICAgICwgdGFicy5tYXAoKHRhYiwgaW5kZXgpID0+ICgNCiAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgnYnV0dG9uJywgew0KICAgICAgICAgICAgICAgIGtleTogaW5kZXgsDQogICAgICAgICAgICAgICAgb25DbGljazogKCkgPT4gc2V0QWN0aXZlVGFiKGluZGV4KSwNCiAgICAgICAgICAgICAgICAvLyBBZGp1c3RlZCBwYWRkaW5nL3RleHQgc2l6ZSBmb3IgbW9iaWxlDQogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBgcHgtNCBweS0yIHRleHQtc20gc206cHgtNiBzbTpweS0zIHNtOnRleHQtYmFzZSByb3VuZGVkLWxnIGZvbnQtc2VtaWJvbGQgd2hpdGVzcGFjZS1ub3dyYXAgdHJhbnNpdGlvbi1hbGwgdHJhbnNmb3JtIGFjdGl2ZTpzY2FsZS05NSAkew0KICAgICAgICAgICAgICAgICAgYWN0aXZlVGFiID09PSBpbmRleA0KICAgICAgICAgICAgICAgICAgICA/ICdiZy1ibHVlLTYwMCB0ZXh0LXdoaXRlIHNoYWRvdy1sZyBzaGFkb3ctYmx1ZS01MDAvNTAnDQogICAgICAgICAgICAgICAgICAgIDogJ2JnLWdyYXktODAwIHRleHQtZ3JheS00MDAgaG92ZXI6YmctZ3JheS03MDAgYWN0aXZlOmJnLWdyYXktNjAwJw0KICAgICAgICAgICAgICAgIH1gLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTQ4OX19DQoKICAgICAgICAgICAgICAgICwgaW5kZXggKyAxLCAiLiAiICwgdGFiCiAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgKSkKICAgICAgICAgICkKICAgICAgICApCgogICAgICAgIC8qIFRhYiBDb250ZW50IC0gQWRqdXN0ZWQgcGFkZGluZyBmb3IgbW9iaWxlICovCiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdtYWluJywgeyBjbGFzc05hbWU6ICJiZy1ncmF5LTgwMCByb3VuZGVkLXhsIHAtNCBzbTpwLTYgbWQ6cC04IHNoYWRvdy0yeGwiICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxNTA2fX0KICAgICAgICAgICwgYWN0aXZlVGFiID09PSAwICYmIFJlYWN0LmNyZWF0ZUVsZW1lbnQoU2Vuc2VPZlNjYWxlVGFiLCB7X19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDE1MDd9fSApCiAgICAgICAgICAsIGFjdGl2ZVRhYiA9PT0gMSAmJiBSZWFjdC5jcmVhdGVFbGVtZW50KFVuZGVyc3RhbmRpbmdDb252ZXJzaW9uc1RhYiwge19fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxNTA4fX0gKQogICAgICAgICAgLCBhY3RpdmVUYWIgPT09IDIgJiYgUmVhY3QuY3JlYXRlRWxlbWVudChVbml0Q2FuY2VsbGF0aW9uVGFiLCB7X19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDE1MDl9fSApCiAgICAgICAgICAsIGFjdGl2ZVRhYiA9PT0gMyAmJiBSZWFjdC5jcmVhdGVFbGVtZW50KFByYWN0aWNlVGFiLCB7X19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDE1MTB9fSApCiAgICAgICAgKQoKICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2Zvb3RlcicsIHsgY2xhc3NOYW1lOiAidGV4dC1jZW50ZXIgbXQtOCB0ZXh0LWdyYXktNjAwIHRleHQtc20iICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTUxM319LCAiVW5pdCBDb252ZXJzaW9uIFR1dG9yIEFwcCIKCiAgICAgICAgKQogICAgICApCiAgICApDQogICk7DQp9Ow0KDQovLyBFcnJvciBCb3VuZGFyeQ0KY2xhc3MgRXJyb3JCb3VuZGFyeSBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7DQogIGNvbnN0cnVjdG9yKHByb3BzKSB7DQogICAgc3VwZXIocHJvcHMpOw0KICAgIHRoaXMuc3RhdGUgPSB7IGhhc0Vycm9yOiBmYWxzZSwgZXJyb3I6IG51bGwgfTsNCiAgfQ0KDQogIHN0YXRpYyBnZXREZXJpdmVkU3RhdGVGcm9tRXJyb3IoZXJyb3IpIHsNCiAgICByZXR1cm4geyBoYXNFcnJvcjogdHJ1ZSwgZXJyb3I6IGVycm9yIH07DQogIH0NCg0KICBjb21wb25lbnREaWRDYXRjaChlcnJvciwgZXJyb3JJbmZvKSB7DQogICAgY29uc29sZS5lcnJvcigiVW5jYXVnaHQgZXJyb3I6IiwgZXJyb3IsIGVycm9ySW5mbyk7DQogIH0NCg0KICByZW5kZXIoKSB7DQogICAgaWYgKHRoaXMuc3RhdGUuaGFzRXJyb3IpIHsNCiAgICAgIHJldHVybiAoDQogICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAibWluLWgtc2NyZWVuIGJnLWdyYXktOTAwIHRleHQtZ3JheS0xMDAgcC02IGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIiAgICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDE1Mzl9fQogICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImJnLXJlZC05MDAvNTAgYm9yZGVyLTIgYm9yZGVyLXJlZC01MDAgcC04IHJvdW5kZWQtbGcgbWF4LXctMnhsIiAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTU0MH19CiAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnaDEnLCB7IGNsYXNzTmFtZTogInRleHQtM3hsIGZvbnQtYm9sZCBtYi00IHRleHQtcmVkLTMwMCIgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxNTQxfX0sICJTb21ldGhpbmcgd2VudCB3cm9uZy4iICApCiAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncCcsIHsgY2xhc3NOYW1lOiAidGV4dC1sZyB0ZXh0LWdyYXktMjAwIG1iLTYiICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxNTQyfX0sICJBbiBlcnJvciBvY2N1cnJlZCBpbiB0aGUgYXBwbGljYXRpb24uIFBsZWFzZSB0cnkgcmVmcmVzaGluZyB0aGUgcGFnZS4iICAgICAgICAgICkKICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdwcmUnLCB7IGNsYXNzTmFtZTogImJnLWdyYXktODAwIHAtNCByb3VuZGVkLWxnIHRleHQtcmVkLTIwMCBvdmVyZmxvdy14LWF1dG8iICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDE1NDN9fQogICAgICAgICAgICAgICwgdGhpcy5zdGF0ZS5lcnJvciAmJiB0aGlzLnN0YXRlLmVycm9yLnRvU3RyaW5nKCkKICAgICAgICAgICAgKQogICAgICAgICAgKQogICAgICAgICkNCiAgICAgICk7DQogICAgfQ0KICAgIHJldHVybiB0aGlzLnByb3BzLmNoaWxkcmVuOw0KICB9DQp9DQoNCi8vIEZpbmFsIEFwcCBleHBvcnQNCmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIEFwcCgpIHsNCiAgcmV0dXJuICgNCiAgICBSZWFjdC5jcmVhdGVFbGVtZW50KEVycm9yQm91bmRhcnksIHtfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTU1N319CiAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudChVbml0Q29udmVyc2lvbkFwcCwge19fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxNTU4fX0gKQogICAgKQ0KICApOw0KfQ0KDQovLyBDdXN0b20gQ1NTIGZvciBzbGlkZXIgdGh1bWIgYW5kIHRvIGhpZGUgbnVtYmVyIGlucHV0IHNwaW5uZXJzDQpjb25zdCBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7DQpzdHlsZS50ZXh0Q29udGVudCA9IGANCiAgLyogLS0tIFNsaWRlciBUaHVtYiBTdHlsZXMgLS0tICovDQogIGlucHV0W3R5cGU9cmFuZ2VdOjotd2Via2l0LXNsaWRlci10aHVtYiB7DQogICAgLXdlYmtpdC1hcHBlYXJhbmNlOiBub25lOw0KICAgIGFwcGVhcmFuY2U6IG5vbmU7DQogICAgd2lkdGg6IDIwcHg7IC8qIEtlZXAgdGh1bWIgc2l6ZSBjb25zaXN0ZW50ICovDQogICAgaGVpZ2h0OiAyMHB4Ow0KICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXNsaWRlci10aHVtYi1iZywgIzNiODJmNik7DQogICAgYm9yZGVyOiAycHggc29saWQgdmFyKC0tc2xpZGVyLXRodW1iLWJvcmRlciwgIzFlM2E4YSk7DQogICAgYm9yZGVyLXJhZGl1czogNTAlOw0KICAgIGN1cnNvcjogZ3JhYjsNCiAgICBtYXJnaW4tdG9wOiAtOHB4OyAvKiBBZGp1c3RlZCBmb3IgY2VudGVyaW5nIG9uIDRweCB0cmFjayAqLw0KICAgIHRyYW5zaXRpb246IGJhY2tncm91bmQtY29sb3IgMC4yczsNCiAgICB6LWluZGV4OiAyMDsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogIH0NCiAgaW5wdXRbdHlwZT1yYW5nZV06Oi1tb3otcmFuZ2UtdGh1bWIgew0KICAgIHdpZHRoOiAyMHB4Ow0KICAgIGhlaWdodDogMjBweDsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1zbGlkZXItdGh1bWItYmcsICMzYjgyZjYpOw0KICAgIGJvcmRlcjogMnB4IHNvbGlkIHZhcigtLXNsaWRlci10aHVtYi1ib3JkZXIsICMxZTNhOGEpOw0KICAgIGJvcmRlci1yYWRpdXM6IDUwJTsNCiAgICBjdXJzb3I6IGdyYWI7DQogICAgei1pbmRleDogMjA7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICB9DQogICAvKiBBZGp1c3RlZCBmb3IgNHB4IHRyYWNrIGhlaWdodCAqLw0KICBpbnB1dFt0eXBlPXJhbmdlXSB7DQogICAgaGVpZ2h0OiA0cHg7IC8qIE1ha2UgdHJhY2sgc2xpZ2h0bHkgdGhpY2tlciBmb3IgdG91Y2ggKi8NCiAgfQ0KDQogIGlucHV0W3R5cGU9cmFuZ2VdOmFjdGl2ZTo6LXdlYmtpdC1zbGlkZXItdGh1bWIgew0KICAgIGJhY2tncm91bmQtY29sb3I6ICM2MGE1ZmE7DQogICAgY3Vyc29yOiBncmFiYmluZzsNCiAgfQ0KICBpbnB1dFt0eXBlPXJhbmdlXTphY3RpdmU6Oi1tb3otcmFuZ2UtdGh1bWIgew0KICAgIGJhY2tncm91bmQtY29sb3I6ICM2MGE1ZmE7DQogICAgY3Vyc29yOiBncmFiYmluZzsNCiAgfQ0KDQogIC8qIC0tLSBIaWRlIE51bWJlciBJbnB1dCBTcGlubmVycyAtLS0gKi8NCiAgLnByYWN0aWNlLWlucHV0Ojotd2Via2l0LW91dGVyLXNwaW4tYnV0dG9uLA0KICAucHJhY3RpY2UtaW5wdXQ6Oi13ZWJraXQtaW5uZXItc3Bpbi1idXR0b24gew0KICAgIC13ZWJraXQtYXBwZWFyYW5jZTogbm9uZTsNCiAgICBtYXJnaW46IDA7DQogIH0NCiAgLnByYWN0aWNlLWlucHV0W3R5cGU9bnVtYmVyXSB7DQogICAgLW1vei1hcHBlYXJhbmNlOiB0ZXh0ZmllbGQ7DQogIH0NCg0KICAvKiAtLS0gSW1wcm92ZSBzY3JvbGxiYXIgYXBwZWFyYW5jZSBmb3IgdGFicyBvbiBtb2JpbGUgLS0tICovDQogIG5hdiBkaXY6Oi13ZWJraXQtc2Nyb2xsYmFyIHsNCiAgICAgIGhlaWdodDogNHB4Ow0KICB9DQogIG5hdiBkaXY6Oi13ZWJraXQtc2Nyb2xsYmFyLXRyYWNrIHsNCiAgICAgIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50Ow0KICB9DQogIG5hdiBkaXY6Oi13ZWJraXQtc2Nyb2xsYmFyLXRodW1iIHsNCiAgICAgIGJhY2tncm91bmQtY29sb3I6IHJnYmEoOTYsIDE2NSwgMjUwLCAwLjUpOyAvKiBibHVlLTQwMCB3aXRoIG9wYWNpdHkgKi8NCiAgICAgIGJvcmRlci1yYWRpdXM6IDIwcHg7DQogIH0NCmA7DQpkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHN0eWxlKTsNCg0KCmltcG9ydCB7IGNyZWF0ZVJvb3QgfSBmcm9tICJyZWFjdC1kb20vY2xpZW50IjsKCiAgICBleHBvcnQgY29uc3QgX1JlYWN0ID0gUmVhY3Q7CiAgICBleHBvcnQgY29uc3QgX2NyZWF0ZVJvb3QgPSBjcmVhdGVSb290OwogIA==";

      const binaryString = atob(encodedReactCode);
      const bytes = new Uint8Array(binaryString.length);
      for (let i = 0; i < binaryString.length; i++) {
        bytes[i] = binaryString.charCodeAt(i);
      }
      const decodedReactCode = new TextDecoder("utf-8").decode(bytes);

      const blob = new Blob([decodedReactCode], {
        type: "application/javascript",
      });
      const moduleUrl = URL.createObjectURL(blob);

      import(moduleUrl)
        .then((module) => {
          const rootElement = document.getElementById("root");
          if (
            rootElement &&
            module.default &&
            typeof module.default === "function"
          ) {
            const React = module._React;
            const createRoot = module._createRoot;
            const root = createRoot(rootElement);
            root.render(React.createElement(module.default));
          } else {
            console.error(
              "Failed to mount React app: root element or module default export is not valid"
            );
          }

          URL.revokeObjectURL(moduleUrl);
        })
        .catch((error) => {
          console.error("Error importing module:", error);
          URL.revokeObjectURL(moduleUrl);
        });
    </script>
  </body>
</html>
