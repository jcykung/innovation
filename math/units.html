<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Unit Conversion Tutor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@18",
          "react-dom": "https://esm.sh/react-dom@18",
          "react-dom/client": "https://esm.sh/react-dom@18/client",
          "lucide-react": "https://esm.sh/lucide-react@0.263.1?external=react",
          "recharts": "https://esm.sh/recharts?external=react,react-dom",
          "mathjs": "https://esm.sh/mathjs",
          "lodash": "https://esm.sh/lodash",
          "d3": "https://esm.sh/d3",
          "plotly": "https://esm.sh/plotly.js",
          "three": "https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.module.min.js",
          "papaparse": "https://esm.sh/papaparse",
          "xlsx": "https://esm.sh/xlsx",
          "@/components/ui/alert": "https://esm.sh/@radix-ui/react-alert-dialog",
          "chart.js": "https://esm.sh/chart.js",
          "tone": "https://esm.sh/tone",
          "mammoth": "https://esm.sh/mammoth",
          "tensorflow": "https://esm.sh/@tensorflow/tfjs"
        }
      }
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module">
      const encodedReactCode =
        "CiAgICBjb25zdCBfanN4RmlsZU5hbWUgPSAiIjsgZnVuY3Rpb24gX29wdGlvbmFsQ2hhaW4ob3BzKSB7IGxldCBsYXN0QWNjZXNzTEhTID0gdW5kZWZpbmVkOyBsZXQgdmFsdWUgPSBvcHNbMF07IGxldCBpID0gMTsgd2hpbGUgKGkgPCBvcHMubGVuZ3RoKSB7IGNvbnN0IG9wID0gb3BzW2ldOyBjb25zdCBmbiA9IG9wc1tpICsgMV07IGkgKz0gMjsgaWYgKChvcCA9PT0gJ29wdGlvbmFsQWNjZXNzJyB8fCBvcCA9PT0gJ29wdGlvbmFsQ2FsbCcpICYmIHZhbHVlID09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBpZiAob3AgPT09ICdhY2Nlc3MnIHx8IG9wID09PSAnb3B0aW9uYWxBY2Nlc3MnKSB7IGxhc3RBY2Nlc3NMSFMgPSB2YWx1ZTsgdmFsdWUgPSBmbih2YWx1ZSk7IH0gZWxzZSBpZiAob3AgPT09ICdjYWxsJyB8fCBvcCA9PT0gJ29wdGlvbmFsQ2FsbCcpIHsgdmFsdWUgPSBmbigoLi4uYXJncykgPT4gdmFsdWUuY2FsbChsYXN0QWNjZXNzTEhTLCAuLi5hcmdzKSk7IGxhc3RBY2Nlc3NMSFMgPSB1bmRlZmluZWQ7IH0gfSByZXR1cm4gdmFsdWU7IH1pbXBvcnQgUmVhY3QsIHsgdXNlU3RhdGUsIHVzZUVmZmVjdCwgdXNlUmVmLCB1c2VNZW1vLCB1c2VDYWxsYmFjayB9IGZyb20gJ3JlYWN0JzsNCg0KLy8gLS0tIEljb24gQ29tcG9uZW50cyAoTHVjaWRlLVJlYWN0KSAtLS0NCi8vIFVzaW5nIGlubGluZSBTVkdzIHRvIGF2b2lkIGV4dGVybmFsIGRlcGVuZGVuY2llcw0KY29uc3QgQ2hlY2sgPSAocHJvcHMpID0+ICgNCiAgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3ZnJywgeyB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiwgd2lkdGg6ICIyNCIsIGhlaWdodDogIjI0Iiwgdmlld0JveDogIjAgMCAyNCAyNCIgICAsIGZpbGw6ICJub25lIiwgc3Ryb2tlOiAiY3VycmVudENvbG9yIiwgc3Ryb2tlV2lkdGg6ICIyIiwgc3Ryb2tlTGluZWNhcDogInJvdW5kIiwgc3Ryb2tlTGluZWpvaW46ICJyb3VuZCIsIC4uLnByb3BzLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNn19CiAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3BvbHlsaW5lJywgeyBwb2ludHM6ICIyMCA2IDkgMTcgNCAxMiIgICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDd9fSkKICApDQopOw0KY29uc3QgWCA9IChwcm9wcykgPT4gKA0KICBSZWFjdC5jcmVhdGVFbGVtZW50KCdzdmcnLCB7IHhtbG5zOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLCB3aWR0aDogIjI0IiwgaGVpZ2h0OiAiMjQiLCB2aWV3Qm94OiAiMCAwIDI0IDI0IiAgICwgZmlsbDogIm5vbmUiLCBzdHJva2U6ICJjdXJyZW50Q29sb3IiLCBzdHJva2VXaWR0aDogIjIiLCBzdHJva2VMaW5lY2FwOiAicm91bmQiLCBzdHJva2VMaW5lam9pbjogInJvdW5kIiwgLi4ucHJvcHMsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMX19CiAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2xpbmUnLCB7IHgxOiAiMTgiLCB5MTogIjYiLCB4MjogIjYiLCB5MjogIjE4IiwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEyfX0pCiAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2xpbmUnLCB7IHgxOiAiNiIsIHkxOiAiNiIsIHgyOiAiMTgiLCB5MjogIjE4IiwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEzfX0pCiAgKQ0KKTsNCmNvbnN0IFJlZnJlc2hDdyA9IChwcm9wcykgPT4gKA0KICBSZWFjdC5jcmVhdGVFbGVtZW50KCdzdmcnLCB7IHhtbG5zOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLCB3aWR0aDogIjI0IiwgaGVpZ2h0OiAiMjQiLCB2aWV3Qm94OiAiMCAwIDI0IDI0IiAgICwgZmlsbDogIm5vbmUiLCBzdHJva2U6ICJjdXJyZW50Q29sb3IiLCBzdHJva2VXaWR0aDogIjIiLCBzdHJva2VMaW5lY2FwOiAicm91bmQiLCBzdHJva2VMaW5lam9pbjogInJvdW5kIiwgLi4ucHJvcHMsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxN319CiAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3BhdGgnLCB7IGQ6ICJNMyAydjZoNiIgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTh9fSkKICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncGF0aCcsIHsgZDogIk0yMSAxMkE5IDkgMCAwIDAgNiA1LjNMMyA4IiAgICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTl9fSkKICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncGF0aCcsIHsgZDogIk0yMSAyMnYtNmgtNiIgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMjB9fSkKICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncGF0aCcsIHsgZDogIk0zIDEyYTkgOSAwIDAgMCAxNSA2LjdsMy0yLjciICAgICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDIxfX0pCiAgKQ0KKTsNCmNvbnN0IExpZ2h0YnVsYiA9IChwcm9wcykgPT4gKA0KICBSZWFjdC5jcmVhdGVFbGVtZW50KCdzdmcnLCB7IHhtbG5zOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLCB3aWR0aDogIjI0IiwgaGVpZ2h0OiAiMjQiLCB2aWV3Qm94OiAiMCAwIDI0IDI0IiAgICwgZmlsbDogIm5vbmUiLCBzdHJva2U6ICJjdXJyZW50Q29sb3IiLCBzdHJva2VXaWR0aDogIjIiLCBzdHJva2VMaW5lY2FwOiAicm91bmQiLCBzdHJva2VMaW5lam9pbjogInJvdW5kIiwgLi4ucHJvcHMsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAyNX19CiAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3BhdGgnLCB7IGQ6ICJNOSAxOGg2IiAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAyNn19KQogICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdwYXRoJywgeyBkOiAiTTEwIDIyaDQiICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDI3fX0pCiAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3BhdGgnLCB7IGQ6ICJNMTIgMmE3IDcgMCAwIDAtNyA3YzAgMyAyIDUgMiA3aDEwYzAtMiAyLTQgMi03YTcgNyAwIDAgMC03LTd6IiAgICAgICAgICAgICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMjh9fSkKICApDQopOw0KY29uc3QgVHJvcGh5ID0gKHByb3BzKSA9PiAoDQogIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3N2ZycsIHsgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsIHdpZHRoOiAiMjQiLCBoZWlnaHQ6ICIyNCIsIHZpZXdCb3g6ICIwIDAgMjQgMjQiICAgLCBmaWxsOiAibm9uZSIsIHN0cm9rZTogImN1cnJlbnRDb2xvciIsIHN0cm9rZVdpZHRoOiAiMiIsIHN0cm9rZUxpbmVjYXA6ICJyb3VuZCIsIHN0cm9rZUxpbmVqb2luOiAicm91bmQiLCAuLi5wcm9wcywgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDMyfX0KICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncGF0aCcsIHsgZDogIk02IDlINC41YTIuNSAyLjUgMCAwIDEgMC01SDYiICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMzN9fSkKICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncGF0aCcsIHsgZDogIk0xOCA5aDEuNWEyLjUgMi41IDAgMCAwIDAtNUgxOCIgICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAzNH19KQogICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdwYXRoJywgeyBkOiAiTTQgMjJoMTYiICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDM1fX0pCiAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3BhdGgnLCB7IGQ6ICJNMTAgMTQuNjZWMTdjMCAuNTUtLjQ3Ljk4LTEuMDcgMS4yOFM3LjQgMTguNzggNyAxOUg2Yy0xLjEgMC0yLS45LTItMnYtMy4zNCIgICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMzZ9fSkKICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncGF0aCcsIHsgZDogIk0xNCAxNC42NlYxN2MwIC41NS40Ny45OCAxLjA3IDEuMjhTMTYuNiAxOC43OCAxNyAxOWgxYzEuMSAwIDItLjkgMi0ydi0zLjM0IiAgICAgICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAzN319KQogICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdwYXRoJywgeyBkOiAiTTE4IDRINnY1YTYgNiAwIDAgMCAxMiAwVjR6IiAgICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAzOH19KQogICkNCik7DQpjb25zdCBDaGV2cm9uUmlnaHQgPSAocHJvcHMpID0+ICgNCiAgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3ZnJywgeyB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiwgd2lkdGg6ICIyNCIsIGhlaWdodDogIjI0Iiwgdmlld0JveDogIjAgMCAyNCAyNCIgICAsIGZpbGw6ICJub25lIiwgc3Ryb2tlOiAiY3VycmVudENvbG9yIiwgc3Ryb2tlV2lkdGg6ICIyIiwgc3Ryb2tlTGluZWNhcDogInJvdW5kIiwgc3Ryb2tlTGluZWpvaW46ICJyb3VuZCIsIC4uLnByb3BzLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNDJ9fQogICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdwYXRoJywgeyBkOiAibTkgMTggNi02LTYtNiIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDQzfX0pCiAgKQ0KKTsNCmNvbnN0IENoZXZyb25MZWZ0ID0gKHByb3BzKSA9PiAoDQogIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3N2ZycsIHsgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsIHdpZHRoOiAiMjQiLCBoZWlnaHQ6ICIyNCIsIHZpZXdCb3g6ICIwIDAgMjQgMjQiICAgLCBmaWxsOiAibm9uZSIsIHN0cm9rZTogImN1cnJlbnRDb2xvciIsIHN0cm9rZVdpZHRoOiAiMiIsIHN0cm9rZUxpbmVjYXA6ICJyb3VuZCIsIHN0cm9rZUxpbmVqb2luOiAicm91bmQiLCAuLi5wcm9wcywgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDQ3fX0KICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncGF0aCcsIHsgZDogIm0xNSAxOC02LTYgNi02IiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNDh9fSkKICApDQopOw0KY29uc3QgU3VuID0gKHByb3BzKSA9PiAoDQogIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3N2ZycsIHsgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsIHdpZHRoOiAiMjQiLCBoZWlnaHQ6ICIyNCIsIHZpZXdCb3g6ICIwIDAgMjQgMjQiICAgLCBmaWxsOiAibm9uZSIsIHN0cm9rZTogImN1cnJlbnRDb2xvciIsIHN0cm9rZVdpZHRoOiAiMiIsIHN0cm9rZUxpbmVjYXA6ICJyb3VuZCIsIHN0cm9rZUxpbmVqb2luOiAicm91bmQiLCAuLi5wcm9wcywgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDUyfX0KICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnY2lyY2xlJywgeyBjeDogIjEyIiwgY3k6ICIxMiIsIHI6ICI1IiwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDUzfX0pCiAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2xpbmUnLCB7IHgxOiAiMTIiLCB5MTogIjEiLCB4MjogIjEyIiwgeTI6ICIzIiwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDU0fX0pCiAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2xpbmUnLCB7IHgxOiAiMTIiLCB5MTogIjIxIiwgeDI6ICIxMiIsIHkyOiAiMjMiLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNTV9fSkKICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnbGluZScsIHsgeDE6ICI0LjIyIiwgeTE6ICI0LjIyIiwgeDI6ICI1LjY0IiwgeTI6ICI1LjY0IiwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDU2fX0pCiAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2xpbmUnLCB7IHgxOiAiMTguMzYiLCB5MTogIjE4LjM2IiwgeDI6ICIxOS43OCIsIHkyOiAiMTkuNzgiLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNTd9fSkKICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnbGluZScsIHsgeDE6ICIxIiwgeTE6ICIxMiIsIHgyOiAiMyIsIHkyOiAiMTIiLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNTh9fSkKICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnbGluZScsIHsgeDE6ICIyMSIsIHkxOiAiMTIiLCB4MjogIjIzIiwgeTI6ICIxMiIsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA1OX19KQogICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdsaW5lJywgeyB4MTogIjQuMjIiLCB5MTogIjE5Ljc4IiwgeDI6ICI1LjY0IiwgeTI6ICIxOC4zNiIsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA2MH19KQogICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdsaW5lJywgeyB4MTogIjE4LjM2IiwgeTE6ICI1LjY0IiwgeDI6ICIxOS43OCIsIHkyOiAiNC4yMiIsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA2MX19KQogICkNCik7DQpjb25zdCBNb29uID0gKHByb3BzKSA9PiAoDQogIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3N2ZycsIHsgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsIHdpZHRoOiAiMjQiLCBoZWlnaHQ6ICIyNCIsIHZpZXdCb3g6ICIwIDAgMjQgMjQiICAgLCBmaWxsOiAibm9uZSIsIHN0cm9rZTogImN1cnJlbnRDb2xvciIsIHN0cm9rZVdpZHRoOiAiMiIsIHN0cm9rZUxpbmVjYXA6ICJyb3VuZCIsIHN0cm9rZUxpbmVqb2luOiAicm91bmQiLCAuLi5wcm9wcywgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDY1fX0KICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncGF0aCcsIHsgZDogIk0yMSAxMi43OUE5IDkgMCAxIDEgMTEuMjEgMyA3IDcgMCAwIDAgMjEgMTIuNzl6IiAgICAgICAgICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNjZ9fSkKICApDQopOw0KDQovLyAtLS0gUmVhY3QgQ29tcG9uZW50cyAtLS0NCg0KLy8gVGFiIDE6IFNlbnNlIG9mIFNjYWxlDQpjb25zdCBTZW5zZU9mU2NhbGVUYWIgPSAoKSA9PiB7DQogIGNvbnN0IFtjdXJyZW50QWN0aXZpdHksIHNldEN1cnJlbnRBY3Rpdml0eV0gPSB1c2VTdGF0ZSgxKTsNCiAgY29uc3QgW3NlbGVjdGVkQW5zd2Vycywgc2V0U2VsZWN0ZWRBbnN3ZXJzXSA9IHVzZVN0YXRlKHt9KTsNCiAgY29uc3QgW2ZlZWRiYWNrLCBzZXRGZWVkYmFja10gPSB1c2VTdGF0ZSh7fSk7DQogIGNvbnN0IFtzaG93UmVzdWx0cywgc2V0U2hvd1Jlc3VsdHNdID0gdXNlU3RhdGUoZmFsc2UpOw0KICBjb25zdCBbY3VycmVudEl0ZW1zLCBzZXRDdXJyZW50SXRlbXNdID0gdXNlU3RhdGUoW10pOw0KICBjb25zdCBbdXNlZEl0ZW1JZHMsIHNldFVzZWRJdGVtSWRzXSA9IHVzZVN0YXRlKFtdKTsNCg0KICAvLyBTdGF0ZSBmb3IgQWN0aXZpdHkgMg0KICBjb25zdCBbbWVhc3VyZVdpZHRoLCBzZXRNZWFzdXJlV2lkdGhdID0gdXNlU3RhdGUoMCk7DQogIGNvbnN0IFtpc0RyYWdnaW5nLCBzZXRJc0RyYWdnaW5nXSA9IHVzZVN0YXRlKGZhbHNlKTsNCiAgY29uc3QgW3N0YXJ0WCwgc2V0U3RhcnRYXSA9IHVzZVN0YXRlKDApOw0KICBjb25zdCBbcm9vbU1lYXN1cmVkLCBzZXRSb29tTWVhc3VyZWRdID0gdXNlU3RhdGUoZmFsc2UpOw0KICBjb25zdCBbbWVhc3VyZUZlZWRiYWNrLCBzZXRNZWFzdXJlRmVlZGJhY2tdID0gdXNlU3RhdGUobnVsbCk7DQogIGNvbnN0IHJvb21SZWYgPSB1c2VSZWYobnVsbCk7DQoNCiAgLy8gVXNlIHVzZU1lbW8gZm9yIGFsbEl0ZW1zIHRvIHByZXZlbnQgcmUtY3JlYXRpb24NCiAgY29uc3QgYWxsSXRlbXMgPSB1c2VNZW1vKCgpID0+IFsNCiAgICB7IA0KICAgICAgaWQ6IDEsIA0KICAgICAgbmFtZTogJ1RoaWNrbmVzcyBvZiBhIHBob25lJywgDQogICAgICBjb3JyZWN0OiAnbW0nLCANCiAgICAgIGltYWdlOiAn8J+TsScsIA0KICAgICAgY29ycmVjdFZhbHVlOiAnOCBtbScsDQogICAgICB0eXBlOiAnZGlzdGFuY2UnLA0KICAgICAgd3JvbmdGZWVkYmFjazogeyANCiAgICAgICAgY206IHsgdmFsdWU6ICcwLjggY20nLCByZWFzb246ICdBd2t3YXJkIGRlY2ltYWwgLSBub3QgYXMgY2xlYXIgYXMgOCBtbScgfSwgDQogICAgICAgIG06IHsgdmFsdWU6ICcwLjAwOCBtJywgcmVhc29uOiAnV2F5IHRvbyBtYW55IHplcm9zIC0gaGFyZCB0byBwaWN0dXJlIScgfSwgDQogICAgICAgIGttOiB7IHZhbHVlOiAnMC4wMDAwMDgga20nLCByZWFzb246ICdSaWRpY3Vsb3VzbHkgdGlueSBudW1iZXIgLSBpbXBvc3NpYmxlIHRvIHZpc3VhbGl6ZSEnIH0gDQogICAgICB9IA0KICAgIH0sDQogICAgeyANCiAgICAgIGlkOiAyLCANCiAgICAgIG5hbWU6ICdIZWlnaHQgb2YgYSBwZXJzb24nLCANCiAgICAgIGNvcnJlY3Q6ICdjbScsIA0KICAgICAgaW1hZ2U6ICfwn6eNJywgDQogICAgICBjb3JyZWN0VmFsdWU6ICcxNzAgY20nLA0KICAgICAgdHlwZTogJ2Rpc3RhbmNlJywNCiAgICAgIHdyb25nRmVlZGJhY2s6IHsgDQogICAgICAgIG1tOiB7IHZhbHVlOiAnMTcwMCBtbScsIHJlYXNvbjogJ1RvbyBtYW55IGRpZ2l0cyAtIGhhcmRlciB0byByZWFkIHRoYW4gMTcwIGNtJyB9LCANCiAgICAgICAgbTogeyB2YWx1ZTogJzEuNyBtJywgcmVhc29uOiAnV29ya3MsIGJ1dCAxNzAgY20gaXMgbW9yZSBjb21tb25seSB1c2VkIGZvciBoZWlnaHQnIH0sIA0KICAgICAgICBrbTogeyB2YWx1ZTogJzAuMDAxNyBrbScsIHJlYXNvbjogJ1dheSB0b28gc21hbGwgLSBub2JvZHkgbWVhc3VyZXMgaGVpZ2h0IGluIGttIScgfSANCiAgICAgIH0gDQogICAgfSwNCiAgICB7IA0KICAgICAgaWQ6IDMsIA0KICAgICAgbmFtZTogJ0Rpc3RhbmNlIHRvIHNjaG9vbCcsIA0KICAgICAgY29ycmVjdDogJ2ttJywgDQogICAgICBpbWFnZTogJ/Cfj6snLCANCiAgICAgIGNvcnJlY3RWYWx1ZTogJzIga20nLA0KICAgICAgdHlwZTogJ2Rpc3RhbmNlJywNCiAgICAgIHdyb25nRmVlZGJhY2s6IHsgDQogICAgICAgIG1tOiB7IHZhbHVlOiAnMiwwMDAsMDAwIG1tJywgcmVhc29uOiAnSHVnZSBudW1iZXIgLSBpbXBvc3NpYmxlIHRvIGltYWdpbmUhJyB9LCANCiAgICAgICAgY206IHsgdmFsdWU6ICcyMDAsMDAwIGNtJywgcmVhc29uOiAnU3RpbGwgdG9vIGxhcmdlIGEgbnVtYmVyIHRvIGJlIHByYWN0aWNhbCEnIH0sIA0KICAgICAgICBtOiB7IHZhbHVlOiAnMjAwMCBtJywgcmVhc29uOiAnQmlnIG51bWJlciAtIG11Y2ggbmljZXIgYXMgMiBrbSEnIH0gDQogICAgICB9IA0KICAgIH0sDQogICAgeyANCiAgICAgIGlkOiA0LCANCiAgICAgIG5hbWU6ICdMZW5ndGggb2YgYSBwZW4nLCANCiAgICAgIGNvcnJlY3Q6ICdjbScsIA0KICAgICAgaW1hZ2U6ICfinI/vuI8nLCANCiAgICAgIGNvcnJlY3RWYWx1ZTogJzE1IGNtJywNCiAgICAgIHR5cGU6ICdkaXN0YW5jZScsDQogICAgICB3cm9uZ0ZlZWRiYWNrOiB7IA0KICAgICAgICBtbTogeyB2YWx1ZTogJzE1MCBtbScsIHJlYXNvbjogJ1dvcmtzIGJ1dCBjbSBpcyBtb3JlIHN0YW5kYXJkIGZvciBwZW4gbGVuZ3RoJyB9LCANCiAgICAgICAgbTogeyB2YWx1ZTogJzAuMTUgbScsIHJlYXNvbjogJ0F3a3dhcmQgZGVjaW1hbCAtIG5vdCBhcyBjbGVhciBhcyAxNSBjbScgfSwgDQogICAgICAgIGttOiB7IHZhbHVlOiAnMC4wMDAxNSBrbScsIHJlYXNvbjogJ0Fic3VyZGx5IHNtYWxsIG51bWJlciEnIH0gDQogICAgICB9IA0KICAgIH0sDQogICAgeyANCiAgICAgIGlkOiA1LCANCiAgICAgIG5hbWU6ICdNZWRpY2luZSBkb3NlJywgDQogICAgICBjb3JyZWN0OiAnbWcnLCANCiAgICAgIGltYWdlOiAn8J+SiicsIA0KICAgICAgY29ycmVjdFZhbHVlOiAnNTAwIG1nJywNCiAgICAgIHR5cGU6ICdtYXNzJywNCiAgICAgIHdyb25nRmVlZGJhY2s6IHsgDQogICAgICAgIGc6IHsgdmFsdWU6ICcwLjUgZycsIHJlYXNvbjogJ0RlY2ltYWwgbWFrZXMgaXQgbGVzcyBjbGVhciB0aGFuIDUwMCBtZycgfSwgDQogICAgICAgIGtnOiB7IHZhbHVlOiAnMC4wMDA1IGtnJywgcmVhc29uOiAnV2F5IHRvbyBzbWFsbCAtIGltcG9zc2libGUgdG8gd29yayB3aXRoIScgfSwgDQogICAgICAgIG1MOiB7IHZhbHVlOiAnTi9BJywgcmVhc29uOiAnVGhhdCBtZWFzdXJlcyB2b2x1bWUsIG5vdCBtYXNzIScgfSANCiAgICAgIH0gDQogICAgfSwNCiAgICB7IA0KICAgICAgaWQ6IDYsIA0KICAgICAgbmFtZTogJ0Nvb2tpbmcgb2lsIGluIHJlY2lwZScsIA0KICAgICAgY29ycmVjdDogJ21MJywgDQogICAgICBpbWFnZTogJ/Cfp4gnLCANCiAgICAgIGNvcnJlY3RWYWx1ZTogJzI1MCBtTCcsDQogICAgICB0eXBlOiAndm9sdW1lJywNCiAgICAgIHdyb25nRmVlZGJhY2s6IHsgDQogICAgICAgIEw6IHsgdmFsdWU6ICcwLjI1IEwnLCByZWFzb246ICdBd2t3YXJkIGRlY2ltYWwgLSBlYXNpZXIgdG8gc2F5IDI1MCBtTCcgfSwgDQogICAgICAgIG1nOiB7IHZhbHVlOiAnTi9BJywgcmVhc29uOiAnVGhhdCBtZWFzdXJlcyBtYXNzLCBub3Qgdm9sdW1lIScgfSwgDQogICAgICAgIGc6IHsgdmFsdWU6ICdOL0EnLCByZWFzb246ICdMaXF1aWRzIGFyZSBtZWFzdXJlZCBieSB2b2x1bWUgaW4gY29va2luZyEnIH0gDQogICAgICB9IA0KICAgIH0sDQogICAgeyANCiAgICAgIGlkOiA3LCANCiAgICAgIG5hbWU6ICdNYXJhdGhvbiB0aW1lJywgDQogICAgICBjb3JyZWN0OiAnaG91cnMnLCANCiAgICAgIGltYWdlOiAn8J+PgycsIA0KICAgICAgY29ycmVjdFZhbHVlOiAnMyBob3VycycsDQogICAgICB0eXBlOiAndGltZScsDQogICAgICB3cm9uZ0ZlZWRiYWNrOiB7IA0KICAgICAgICBzZWNvbmRzOiB7IHZhbHVlOiAnMTAsODAwIHNlY29uZHMnLCByZWFzb246ICdIdWdlIG51bWJlciAtIHRvbyBoYXJkIHRvIHBpY3R1cmUhJyB9LCANCiAgICAgICAgbWludXRlczogeyB2YWx1ZTogJzE4MCBtaW51dGVzJywgcmVhc29uOiAnTGFyZ2UgbnVtYmVyIC0gbXVjaCBjbGVhcmVyIGFzIDMgaG91cnMnIH0sIA0KICAgICAgICBkYXlzOiB7IHZhbHVlOiAnMC4xMjUgZGF5cycsIHJlYXNvbjogJ1dlaXJkIGRlY2ltYWwgLSBub3QgcHJhY3RpY2FsIScgfSwNCiAgICAgICAgbXM6IHsgdmFsdWU6ICcxMCw4MDAsMDAwIG1zJywgcmVhc29uOiAnQWJzdXJkbHkgaHVnZSBudW1iZXIhJyB9DQogICAgICB9IA0KICAgIH0sDQogICAgeyANCiAgICAgIGlkOiA4LCANCiAgICAgIG5hbWU6ICdCbGluayBvZiBhbiBleWUnLCANCiAgICAgIGNvcnJlY3Q6ICdtcycsIA0KICAgICAgaW1hZ2U6ICfwn5GB77iPJywgDQogICAgICBjb3JyZWN0VmFsdWU6ICczMDAgbXMnLA0KICAgICAgdHlwZTogJ3RpbWUnLA0KICAgICAgd3JvbmdGZWVkYmFjazogeyANCiAgICAgICAgc2Vjb25kczogeyB2YWx1ZTogJzAuMyBzZWNvbmRzJywgcmVhc29uOiAnRGVjaW1hbCAtIG1pbGxpc2Vjb25kcyBhcmUgbW9yZSBwcmVjaXNlJyB9LCANCiAgICAgICAgbWludXRlczogeyB2YWx1ZTogJzAuMDA1IG1pbnV0ZXMnLCByZWFzb246ICdBYnN1cmRseSBzbWFsbCBkZWNpbWFsIScgfSwgDQogICAgICAgIGhvdXJzOiB7IHZhbHVlOiAnMC4wMDAwODMgaG91cnMnLCByZWFzb246ICdJbXBvc3NpYmxlIHRvIHZpc3VhbGl6ZSEnIH0sDQogICAgICAgIGRheXM6IHsgdmFsdWU6ICcwLjAwMDAwMzUgZGF5cycsIHJlYXNvbjogJ1JpZGljdWxvdXNseSB0aW55IG51bWJlciEnIH0NCiAgICAgIH0gDQogICAgfSwNCiAgICB7IA0KICAgICAgaWQ6IDksIA0KICAgICAgbmFtZTogJ1dpZHRoIG9mIGEgZmluZ2VybmFpbCcsIA0KICAgICAgY29ycmVjdDogJ21tJywgDQogICAgICBpbWFnZTogJ/CfkoUnLCANCiAgICAgIGNvcnJlY3RWYWx1ZTogJzEwIG1tJywNCiAgICAgIHR5cGU6ICdkaXN0YW5jZScsDQogICAgICB3cm9uZ0ZlZWRiYWNrOiB7IA0KICAgICAgICBjbTogeyB2YWx1ZTogJzEgY20nLCByZWFzb246ICdXb3JrcywgYnV0IG1tIGlzIG1vcmUgcHJlY2lzZSBmb3Igc21hbGwgaXRlbXMnIH0sIA0KICAgICAgICBtOiB7IHZhbHVlOiAnMC4wMSBtJywgcmVhc29uOiAnVGlueSBkZWNpbWFsIC0gaGFyZCB0byB2aXN1YWxpemUhJyB9LCANCiAgICAgICAga206IHsgdmFsdWU6ICcwLjAwMDAxIGttJywgcmVhc29uOiAnQWJzdXJkbHkgc21hbGwgbnVtYmVyIScgfSANCiAgICAgIH0gDQogICAgfSwNCiAgICB7IA0KICAgICAgaWQ6IDEwLCANCiAgICAgIG5hbWU6ICdXZWlnaHQgb2YgYSBjYXInLCANCiAgICAgIGNvcnJlY3Q6ICdrZycsIA0KICAgICAgaW1hZ2U6ICfwn5qXJywgDQogICAgICBjb3JyZWN0VmFsdWU6ICcxNTAwIGtnJywNCiAgICAgIHR5cGU6ICdtYXNzJywNCiAgICAgIHdyb25nRmVlZGJhY2s6IHsgDQogICAgICAgIG1nOiB7IHZhbHVlOiAnMSw1MDAsMDAwLDAwMCBtZycsIHJlYXNvbjogJ0ltcG9zc2libHkgaHVnZSBudW1iZXIhJyB9LCANCiAgICAgICAgZzogeyB2YWx1ZTogJzEsNTAwLDAwMCBnJywgcmVhc29uOiAnU3RpbGwgd2F5IHRvbyBtYW55IGRpZ2l0cyEnIH0gDQogICAgICB9IA0KICAgIH0sDQogICAgeyANCiAgICAgIGlkOiAxMSwgDQogICAgICBuYW1lOiAnTW92aWUgcnVudGltZScsIA0KICAgICAgY29ycmVjdDogJ21pbnV0ZXMnLCANCiAgICAgIGltYWdlOiAn8J+OrCcsIA0KICAgICAgY29ycmVjdFZhbHVlOiAnMTIwIG1pbnV0ZXMnLA0KICAgICAgdHlwZTogJ3RpbWUnLA0KICAgICAgd3JvbmdGZWVkYmFjazogeyANCiAgICAgICAgc2Vjb25kczogeyB2YWx1ZTogJzcyMDAgc2Vjb25kcycsIHJlYXNvbjogJ0xhcmdlIG51bWJlciAtIGVhc2llciBhcyAxMjAgbWludXRlcycgfSwgDQogICAgICAgIGhvdXJzOiB7IHZhbHVlOiAnMiBob3VycycsIHJlYXNvbjogJ1dvcmtzIHdlbGwgdG9vISBNaW51dGVzIGFyZSBhbHNvIGNvbW1vbicgfSwgDQogICAgICAgIG1zOiB7IHZhbHVlOiAnNywyMDAsMDAwIG1zJywgcmVhc29uOiAnQWJzdXJkbHkgaHVnZSBudW1iZXIhJyB9LA0KICAgICAgICBkYXlzOiB7IHZhbHVlOiAnMC4wODMgZGF5cycsIHJlYXNvbjogJ1N0cmFuZ2UgZGVjaW1hbCEnIH0NCiAgICAgIH0gDQogICAgfSwNCiAgICB7IA0KICAgICAgaWQ6IDEyLCANCiAgICAgIG5hbWU6ICdTd2ltbWluZyBwb29sIHZvbHVtZScsIA0KICAgICAgY29ycmVjdDogJ0wnLCANCiAgICAgIGltYWdlOiAn8J+PiicsIA0KICAgICAgY29ycmVjdFZhbHVlOiAnNTAwMDAgTCcsDQogICAgICB0eXBlOiAndm9sdW1lJywNCiAgICAgIHdyb25nRmVlZGJhY2s6IHsgDQogICAgICAgIG1MOiB7IHZhbHVlOiAnNTAsMDAwLDAwMCBtTCcsIHJlYXNvbjogJ1dheSB0b28gbWFueSB6ZXJvcyEnIH0gDQogICAgICB9IA0KICAgIH0sDQogICAgeyANCiAgICAgIGlkOiAxMywgDQogICAgICBuYW1lOiAnRXJhc2VyIHRoaWNrbmVzcycsIA0KICAgICAgY29ycmVjdDogJ21tJywgDQogICAgICBpbWFnZTogJ/Cfp70nLCANCiAgICAgIGNvcnJlY3RWYWx1ZTogJzEyIG1tJywNCiAgICAgIHR5cGU6ICdkaXN0YW5jZScsDQogICAgICB3cm9uZ0ZlZWRiYWNrOiB7IA0KICAgICAgICBjbTogeyB2YWx1ZTogJzEuMiBjbScsIHJlYXNvbjogJ0RlY2ltYWwgbWFrZXMgaXQgbGVzcyBjbGVhciB0aGFuIDEyIG1tJyB9LCANCiAgICAgICAgbTogeyB2YWx1ZTogJzAuMDEyIG0nLCByZWFzb246ICdUb28gbWFueSB6ZXJvcyEnIH0sIA0KICAgICAgICBrbTogeyB2YWx1ZTogJzAuMDAwMDEyIGttJywgcmVhc29uOiAnUmlkaWN1bG91c2x5IHRpbnkhJyB9IA0KICAgICAgfSANCiAgICB9LA0KICAgIHsgDQogICAgICBpZDogMTQsIA0KICAgICAgbmFtZTogJ1NsZWVwaW5nIHRpbWUnLCANCiAgICAgIGNvcnJlY3Q6ICdob3VycycsIA0KICAgICAgaW1hZ2U6ICfwn5i0JywgDQogICAgICBjb3JyZWN0VmFsdWU6ICc4IGhvdXJzJywNCiAgICAgIHR5cGU6ICd0aW1lJywNCiAgICAgIHdyb25nRmVlZGJhY2s6IHsgDQogICAgICAgIHNlY29uZHM6IHsgdmFsdWU6ICcyOCw4MDAgc2Vjb25kcycsIHJlYXNvbjogJ0h1Z2UgbnVtYmVyIC0gaW1wb3NzaWJsZSB0byBwaWN0dXJlIScgfSwgDQogICAgICAgIG1pbnV0ZXM6IHsgdmFsdWU6ICc0ODAgbWludXRlcycsIHJlYXNvbjogJ0xhcmdlIG51bWJlciAtIGJldHRlciBhcyA4IGhvdXJzIScgfSwgDQogICAgICAgIG1zOiB7IHZhbHVlOiAnMjgsODAwLDAwMCBtcycsIHJlYXNvbjogJ0Fic3VyZGx5IGh1Z2UhJyB9LA0KICAgICAgICBkYXlzOiB7IHZhbHVlOiAnMC4zMyBkYXlzJywgcmVhc29uOiAnV2VpcmQgZnJhY3Rpb24hJyB9DQogICAgICB9IA0KICAgIH0sDQogICAgeyANCiAgICAgIGlkOiAxNSwgDQogICAgICBuYW1lOiAnV2VpZ2h0IG9mIGFuIGFwcGxlJywgDQogICAgICBjb3JyZWN0OiAnZycsIA0KICAgICAgaW1hZ2U6ICfwn42OJywgDQogICAgICBjb3JyZWN0VmFsdWU6ICcxODAgZycsDQogICAgICB0eXBlOiAnbWFzcycsDQogICAgICB3cm9uZ0ZlZWRiYWNrOiB7IA0KICAgICAgICBtZzogeyB2YWx1ZTogJzE4MCwwMDAgbWcnLCByZWFzb246ICdUb28gbWFueSBkaWdpdHMhJyB9LCANCiAgICAgICAga2c6IHsgdmFsdWU6ICcwLjE4IGtnJywgcmVhc29uOiAnQXdrd2FyZCBkZWNpbWFsIC0gZWFzaWVyIGFzIDE4MCBnJyB9IA0KICAgICAgfSANCiAgICB9LA0KICBdLCBbXSk7DQoNCiAgLy8gVXNlIHVzZUNhbGxiYWNrIGZvciBmdW5jdGlvbnMNCiAgY29uc3QgZ2VuZXJhdGVOZXdFeGFtcGxlcyA9IHVzZUNhbGxiYWNrKCgpID0+IHsNCiAgICAvLyBHZXQgaXRlbXMgdGhhdCBoYXZlbid0IGJlZW4gdXNlZCB5ZXQNCiAgICBjb25zdCBhdmFpbGFibGVJdGVtcyA9IGFsbEl0ZW1zLmZpbHRlcihpdGVtID0+ICF1c2VkSXRlbUlkcy5pbmNsdWRlcyhpdGVtLmlkKSk7DQogICAgDQogICAgLy8gSWYgd2UndmUgdXNlZCBhbGwgaXRlbXMsIHJlc2V0IHRoZSB1c2VkIGxpc3QNCiAgICBpZiAoYXZhaWxhYmxlSXRlbXMubGVuZ3RoIDwgMykgew0KICAgICAgc2V0VXNlZEl0ZW1JZHMoW10pOw0KICAgICAgY29uc3Qgc2h1ZmZsZWQgPSBbLi4uYWxsSXRlbXNdLnNvcnQoKCkgPT4gTWF0aC5yYW5kb20oKSAtIDAuNSk7DQogICAgICBjb25zdCBzZWxlY3RlZCA9IHNodWZmbGVkLnNsaWNlKDAsIDMpOw0KICAgICAgc2V0Q3VycmVudEl0ZW1zKHNlbGVjdGVkKTsNCiAgICAgIHNldFVzZWRJdGVtSWRzKHNlbGVjdGVkLm1hcChpdGVtID0+IGl0ZW0uaWQpKTsNCiAgICB9IGVsc2Ugew0KICAgICAgLy8gU2h1ZmZsZSBhdmFpbGFibGUgaXRlbXMgYW5kIHRha2UgMw0KICAgICAgY29uc3Qgc2h1ZmZsZWQgPSBbLi4uYXZhaWxhYmxlSXRlbXNdLnNvcnQoKCkgPT4gTWF0aC5yYW5kb20oKSAtIDAuNSk7DQogICAgICBjb25zdCBzZWxlY3RlZCA9IHNodWZmbGVkLnNsaWNlKDAsIDMpOw0KICAgICAgc2V0Q3VycmVudEl0ZW1zKHNlbGVjdGVkKTsNCiAgICAgIHNldFVzZWRJdGVtSWRzKHByZXYgPT4gWy4uLnByZXYsIC4uLnNlbGVjdGVkLm1hcChpdGVtID0+IGl0ZW0uaWQpXSk7DQogICAgfQ0KICAgIA0KICAgIHNldFNlbGVjdGVkQW5zd2Vycyh7fSk7DQogICAgc2V0RmVlZGJhY2soe30pOw0KICAgIHNldFNob3dSZXN1bHRzKGZhbHNlKTsNCiAgfSwgW2FsbEl0ZW1zLCB1c2VkSXRlbUlkc10pOw0KDQogIC8vIEluaXRpYWxpemUgd2l0aCByYW5kb20gMyBpdGVtcyBvbiBmaXJzdCBsb2FkDQogIHVzZUVmZmVjdCgoKSA9PiB7DQogICAgaWYgKGN1cnJlbnRJdGVtcy5sZW5ndGggPT09IDApIHsNCiAgICAgIGdlbmVyYXRlTmV3RXhhbXBsZXMoKTsNCiAgICB9DQogIH0sIFtjdXJyZW50SXRlbXMsIGdlbmVyYXRlTmV3RXhhbXBsZXNdKTsNCg0KICBjb25zdCB1bml0T3B0aW9ucyA9IHVzZU1lbW8oKCkgPT4gKHsNCiAgICBkaXN0YW5jZTogWydtbScsICdjbScsICdtJywgJ2ttJ10sDQogICAgbWFzczogWydtZycsICdnJywgJ2tnJ10sDQogICAgdm9sdW1lOiBbJ21MJywgJ0wnXSwNCiAgICB0aW1lOiBbJ21zJywgJ3NlY29uZHMnLCAnbWludXRlcycsICdob3VycycsICdkYXlzJ10NCiAgfSksIFtdKTsNCg0KICBjb25zdCBnZXRVbml0VHlwZSA9IHVzZUNhbGxiYWNrKCh1bml0KSA9PiB7DQogICAgZm9yIChjb25zdCBbdHlwZSwgdW5pdHNdIG9mIE9iamVjdC5lbnRyaWVzKHVuaXRPcHRpb25zKSkgew0KICAgICAgaWYgKHVuaXRzLmluY2x1ZGVzKHVuaXQpKSByZXR1cm4gdHlwZTsNCiAgICB9DQogICAgcmV0dXJuIG51bGw7DQogIH0sIFt1bml0T3B0aW9uc10pOw0KDQogIGNvbnN0IGhhbmRsZUFuc3dlciA9IChpdGVtSWQsIHVuaXQpID0+IHsNCiAgICAvLyBBY3Rpdml0eSAxOiBJbW1lZGlhdGUgZmVlZGJhY2sNCiAgICBjb25zdCBpdGVtID0gY3VycmVudEl0ZW1zLmZpbmQoaSA9PiBpLmlkID09PSBpdGVtSWQpOw0KICAgIHNldFNlbGVjdGVkQW5zd2VycyhwcmV2ID0+ICh7IC4uLnByZXYsIFtpdGVtSWRdOiB1bml0IH0pKTsNCiAgICANCiAgICBjb25zdCB1bml0VHlwZSA9IGdldFVuaXRUeXBlKHVuaXQpOw0KICAgIA0KICAgIC8vIENoZWNrIGlmIHdyb25nIHR5cGUgb2YgdW5pdCBlbnRpcmVseQ0KICAgIGlmICh1bml0VHlwZSAhPT0gaXRlbS50eXBlKSB7DQogICAgICBjb25zdCB0eXBlTmFtZXMgPSB7DQogICAgICAgIGRpc3RhbmNlOiAnZGlzdGFuY2UvbGVuZ3RoJywNCiAgICAgICAgbWFzczogJ21hc3Mvd2VpZ2h0JywNCiAgICAgICAgdm9sdW1lOiAndm9sdW1lJywNCiAgICAgICAgdGltZTogJ3RpbWUnDQogICAgICB9Ow0KICAgICAgc2V0RmVlZGJhY2socHJldiA9PiAoeyANCiAgICAgICAgLi4ucHJldiwgDQogICAgICAgIFtpdGVtSWRdOiB7IA0KICAgICAgICAgIGNvcnJlY3Q6IGZhbHNlLCANCiAgICAgICAgICB3cm9uZ1R5cGU6IHRydWUsDQogICAgICAgICAgbWVzc2FnZTogYFdhaXQhICR7dW5pdH0gbWVhc3VyZXMgJHt0eXBlTmFtZXNbdW5pdFR5cGVdfSwgYnV0IHlvdSBuZWVkIHRvIG1lYXN1cmUgJHt0eXBlTmFtZXNbaXRlbS50eXBlXX0gaGVyZS4gVHJ5IGEgZGlmZmVyZW50IHR5cGUgb2YgdW5pdCFgIA0KICAgICAgICB9IA0KICAgICAgfSkpOw0KICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICANCiAgICAvLyBHaXZlIGltbWVkaWF0ZSBmZWVkYmFjayBmb3IgY29ycmVjdCB0eXBlIGJ1dCB3cm9uZyBzaXplDQogICAgaWYgKHVuaXQgPT09IGl0ZW0uY29ycmVjdCkgew0KICAgICAgc2V0RmVlZGJhY2socHJldiA9PiAoeyANCiAgICAgICAgLi4ucHJldiwgDQogICAgICAgIFtpdGVtSWRdOiB7IA0KICAgICAgICAgIGNvcnJlY3Q6IHRydWUsIA0KICAgICAgICAgIG1lc3NhZ2U6IGBQZXJmZWN0ISAke2l0ZW0uY29ycmVjdFZhbHVlfSBpcyBjbGVhciBhbmQgZWFzeSB0byB1bmRlcnN0YW5kLmAgDQogICAgICAgIH0gDQogICAgICB9KSk7DQogICAgfSBlbHNlIGlmIChpdGVtLndyb25nRmVlZGJhY2tbdW5pdF0pIHsNCiAgICAgIHNldEZlZWRiYWNrKHByZXYgPT4gKHsgDQogICAgICAgIC4uLnByZXYsIA0KICAgICAgICBbaXRlbUlkXTogeyANCiAgICAgICAgICBjb3JyZWN0OiBmYWxzZSwgDQogICAgICAgICAgdmFsdWU6IGl0ZW0ud3JvbmdGZWVkYmFja1t1bml0XS52YWx1ZSwNCiAgICAgICAgICBtZXNzYWdlOiBpdGVtLndyb25nRmVlZGJhY2tbdW5pdF0ucmVhc29uDQogICAgICAgIH0gDQogICAgICB9KSk7DQogICAgfSBlbHNlIHsNCiAgICAgIC8vIFRoaXMgY2FzZSBzaG91bGQgYmUgcmFyZSBkdWUgdG8gdGhlIGZsYXQgbGlzdCBvZiBhbGwgdW5pdHMNCiAgICAgIHNldEZlZWRiYWNrKHByZXYgPT4gKHsgDQogICAgICAgIC4uLnByZXYsIA0KICAgICAgICBbaXRlbUlkXTogeyANCiAgICAgICAgICBjb3JyZWN0OiBmYWxzZSwgDQogICAgICAgICAgd3JvbmdUeXBlOiB0cnVlLA0KICAgICAgICAgIG1lc3NhZ2U6IGBUaGF0J3MgdGhlIHdyb25nIHR5cGUgb2YgbWVhc3VyZW1lbnQhYA0KICAgICAgICB9IA0KICAgICAgfSkpOw0KICAgIH0NCiAgfTsNCiAgDQogIC8vIC0tLSBBY3Rpdml0eSAyIEhhbmRsZXJzIC0tLQ0KICBjb25zdCBnZXRSb29tV2lkdGggPSAoKSA9PiB7DQogICAgcmV0dXJuIHJvb21SZWYuY3VycmVudCA/IHJvb21SZWYuY3VycmVudC5vZmZzZXRXaWR0aCA6IDA7DQogIH07DQoNCiAgY29uc3QgaGFuZGxlTWVhc3VyZVN0YXJ0ID0gKGUpID0+IHsNCiAgICBpZiAocm9vbU1lYXN1cmVkKSByZXR1cm47DQogICAgc2V0SXNEcmFnZ2luZyh0cnVlKTsNCiAgICBjb25zdCBjbGllbnRYID0gZS50b3VjaGVzID8gZS50b3VjaGVzWzBdLmNsaWVudFggOiBlLmNsaWVudFg7DQogICAgc2V0U3RhcnRYKGNsaWVudFggLSByb29tUmVmLmN1cnJlbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCk7DQogICAgc2V0TWVhc3VyZVdpZHRoKDApOyAvLyBSZXNldCBvbiBuZXcgZHJhZw0KICB9Ow0KDQogIGNvbnN0IGhhbmRsZU1lYXN1cmVNb3ZlID0gKGUpID0+IHsNCiAgICBpZiAoIWlzRHJhZ2dpbmcgfHwgcm9vbU1lYXN1cmVkKSByZXR1cm47DQogICAgY29uc3QgY2xpZW50WCA9IGUudG91Y2hlcyA/IGUudG91Y2hlc1swXS5jbGllbnRYIDogZS5jbGllbnRYOw0KICAgIGNvbnN0IHJvb21SZWN0ID0gcm9vbVJlZi5jdXJyZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgIGNvbnN0IHJvb21XaWR0aCA9IHJvb21SZWN0LndpZHRoOw0KICAgIGxldCBjdXJyZW50WCA9IGNsaWVudFggLSByb29tUmVjdC5sZWZ0Ow0KICAgIGxldCB3aWR0aCA9IGN1cnJlbnRYIC0gc3RhcnRYOw0KICAgIA0KICAgIGlmICh3aWR0aCA8IDApIHdpZHRoID0gMDsNCiAgICBpZiAod2lkdGggPiByb29tV2lkdGgpIHdpZHRoID0gcm9vbVdpZHRoOw0KICAgIA0KICAgIHNldE1lYXN1cmVXaWR0aCh3aWR0aCk7DQogIH07DQoNCiAgY29uc3QgaGFuZGxlTWVhc3VyZUVuZCA9ICgpID0+IHsNCiAgICBpZiAoIWlzRHJhZ2dpbmcpIHJldHVybjsNCiAgICBzZXRJc0RyYWdnaW5nKGZhbHNlKTsNCiAgICBjb25zdCByb29tV2lkdGggPSBnZXRSb29tV2lkdGgoKTsNCiAgICBjb25zdCB0b2xlcmFuY2UgPSAyMDsgLy8gMjBweCB0b2xlcmFuY2UNCiAgICANCiAgICBpZiAobWVhc3VyZVdpZHRoID49IHJvb21XaWR0aCAtIHRvbGVyYW5jZSkgew0KICAgICAgc2V0TWVhc3VyZVdpZHRoKHJvb21XaWR0aCk7IC8vIFNuYXAgdG8gZnVsbCB3aWR0aA0KICAgICAgc2V0Um9vbU1lYXN1cmVkKHRydWUpOw0KICAgICAgc2V0TWVhc3VyZUZlZWRiYWNrKG51bGwpOyAvLyBDbGVhciBhbnkgImtlZXAgZHJhZ2dpbmciIGZlZWRiYWNrDQogICAgfSBlbHNlIHsNCiAgICAgIHNldE1lYXN1cmVGZWVkYmFjayh7IHR5cGU6ICd3YXJuJywgbWVzc2FnZTogJ05vdCBxdWl0ZSEgS2VlcCBkcmFnZ2luZyB0byBtZWFzdXJlIHRoZSB3aG9sZSB3aWR0aC4nIH0pOw0KICAgIH0NCiAgfTsNCg0KICBjb25zdCBoYW5kbGVVbml0Q2hvaWNlID0gKGNob2ljZSkgPT4gew0KICAgIGlmICghcm9vbU1lYXN1cmVkKSByZXR1cm47DQogICAgaWYgKGNob2ljZS5jb3JyZWN0KSB7DQogICAgICBzZXRNZWFzdXJlRmVlZGJhY2soeyB0eXBlOiAnZ29vZCcsIG1lc3NhZ2U6IGBQZXJmZWN0ISAiJHtjaG9pY2UudmFsdWV9IiBpcyB2ZXJ5IGNsZWFyIGFuZCBlYXN5IHRvIHVuZGVyc3RhbmQuYCB9KTsNCiAgICB9IGVsc2Ugew0KICAgICAgc2V0TWVhc3VyZUZlZWRiYWNrKHsgdHlwZTogJ2JhZCcsIG1lc3NhZ2U6IGNob2ljZS5leHBsYW5hdGlvbiB9KTsNCiAgICB9DQogIH07DQoNCiAgY29uc3QgcmVzZXRBY3Rpdml0eTIgPSAoKSA9PiB7DQogICAgc2V0TWVhc3VyZVdpZHRoKDApOw0KICAgIHNldElzRHJhZ2dpbmcoZmFsc2UpOw0KICAgIHNldFJvb21NZWFzdXJlZChmYWxzZSk7DQogICAgc2V0TWVhc3VyZUZlZWRiYWNrKG51bGwpOw0KICB9Ow0KICANCiAgLy8gLS0tIFJlbmRlciBMb2dpYyAtLS0NCg0KICBpZiAoY3VycmVudEFjdGl2aXR5ID09PSAxKSB7DQogICAgY29uc3QgYWxsQW5zd2VyZWQgPSBPYmplY3Qua2V5cyhzZWxlY3RlZEFuc3dlcnMpLmxlbmd0aCA9PT0gY3VycmVudEl0ZW1zLmxlbmd0aDsNCg0KICAgIHJldHVybiAoDQogICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7X19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDQ1NX19CiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdoMicsIHsgY2xhc3NOYW1lOiAidGV4dC0yeGwgZm9udC1ib2xkIG1iLTQgdGV4dC1ibHVlLTQwMCIgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA0NTZ9fSwgIkFjdGl2aXR5IDE6IENob29zZSB0aGUgUmlnaHQgVW5pdCIgICAgICkKICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3AnLCB7IGNsYXNzTmFtZTogInRleHQtZ3JheS0zMDAgbWItNiIgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNDU3fX0sICJTZWxlY3QgdGhlIG1vc3QgYXBwcm9wcmlhdGUgdW5pdCBmb3IgbWVhc3VyaW5nIGVhY2ggaXRlbS4gVGhpbmsgYWJvdXQgd2hpY2ggdW5pdCBtYWtlcyB0aGUgbnVtYmVyIGVhc2llc3QgdG8gdW5kZXJzdGFuZCEiICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAiZ3JpZCBncmlkLWNvbHMtMSBtZDpncmlkLWNvbHMtMyBnYXAtNiBtYi02IiAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA0NTl9fQogICAgICAgICAgLCBjdXJyZW50SXRlbXMubWFwKGl0ZW0gPT4gKA0KICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBrZXk6IGl0ZW0uaWQsIGNsYXNzTmFtZTogImJnLWdyYXktNzAwIHJvdW5kZWQtbGcgcC02IiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNDYxfX0KICAgICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAidGV4dC01eGwgbWItMyB0ZXh0LWNlbnRlciIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDQ2Mn19LCBpdGVtLmltYWdlKQogICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnaDMnLCB7IGNsYXNzTmFtZTogInRleHQtbGcgZm9udC1zZW1pYm9sZCBtYi0zIHRleHQtY2VudGVyIiAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDQ2M319LCBpdGVtLm5hbWUpCiAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImZsZXggZmxleC13cmFwIGdhcC0yIGp1c3RpZnktY2VudGVyIiAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDQ2NH19CiAgICAgICAgICAgICAgICAsIE9iamVjdC52YWx1ZXModW5pdE9wdGlvbnMpLmZsYXQoKS5maWx0ZXIoKHYsIGksIGEpID0+IGEuaW5kZXhPZih2KSA9PT0gaSkubWFwKHVuaXQgPT4gKA0KICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgnYnV0dG9uJywgew0KICAgICAgICAgICAgICAgICAgICBrZXk6IHVuaXQsDQogICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6ICgpID0+IGhhbmRsZUFuc3dlcihpdGVtLmlkLCB1bml0KSwNCiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBgcHgtNCBweS0yIHJvdW5kZWQtbGcgZm9udC1zZW1pYm9sZCB0cmFuc2l0aW9uLWFsbCAkew0KICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkQW5zd2Vyc1tpdGVtLmlkXSA9PT0gdW5pdA0KICAgICAgICAgICAgICAgICAgICAgICAgPyBfb3B0aW9uYWxDaGFpbihbZmVlZGJhY2ssICdhY2Nlc3MnLCBfMiA9PiBfMltpdGVtLmlkXSwgJ29wdGlvbmFsQWNjZXNzJywgXzMgPT4gXzMuY29ycmVjdF0pDQogICAgICAgICAgICAgICAgICAgICAgICAgID8gJ2JnLWdyZWVuLTYwMCB0ZXh0LXdoaXRlJw0KICAgICAgICAgICAgICAgICAgICAgICAgICA6IF9vcHRpb25hbENoYWluKFtmZWVkYmFjaywgJ2FjY2VzcycsIF80ID0+IF80W2l0ZW0uaWRdLCAnb3B0aW9uYWxBY2Nlc3MnLCBfNSA9PiBfNS5jb3JyZWN0XSkgPT09IGZhbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgID8gX29wdGlvbmFsQ2hhaW4oW2ZlZWRiYWNrLCAnYWNjZXNzJywgXzYgPT4gXzZbaXRlbS5pZF0sICdvcHRpb25hbEFjY2VzcycsIF83ID0+IF83Lndyb25nVHlwZV0pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAnYmctcmVkLTYwMCB0ZXh0LXdoaXRlJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogJ2JnLW9yYW5nZS02MDAgdGV4dC13aGl0ZScNCiAgICAgICAgICAgICAgICAgICAgICAgICAgOiAnYmctYmx1ZS02MDAgdGV4dC13aGl0ZScNCiAgICAgICAgICAgICAgICAgICAgICAgIDogJ2JnLWdyYXktNjAwIHRleHQtZ3JheS0yMDAgaG92ZXI6YmctZ3JheS01MDAnDQogICAgICAgICAgICAgICAgICAgIH0gY3Vyc29yLXBvaW50ZXJgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNDY2fX0NCgogICAgICAgICAgICAgICAgICAgICwgdW5pdAogICAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgKSkKICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgLCBmZWVkYmFja1tpdGVtLmlkXSAmJiAoDQogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6IGBtdC0zIHAtMyByb3VuZGVkLWxnICR7DQogICAgICAgICAgICAgICAgICBmZWVkYmFja1tpdGVtLmlkXS5jb3JyZWN0ID8gJ2JnLWdyZWVuLTkwMC81MCB0ZXh0LWdyZWVuLTIwMCcgOiANCiAgICAgICAgICAgICAgICAgIGZlZWRiYWNrW2l0ZW0uaWRdLndyb25nVHlwZSA/ICdiZy1yZWQtOTAwLzUwIHRleHQtcmVkLTIwMCcgOg0KICAgICAgICAgICAgICAgICAgJ2JnLW9yYW5nZS05MDAvNTAgdGV4dC1vcmFuZ2UtMjAwJw0KICAgICAgICAgICAgICAgIH1gLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNDg2fX0KICAgICAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImZsZXggaXRlbXMtc3RhcnQgZ2FwLTIiICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA0OTF9fQogICAgICAgICAgICAgICAgICAgICwgZmVlZGJhY2tbaXRlbS5pZF0uY29ycmVjdCA/IFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ2hlY2ssIHsgc2l6ZTogMjAsIGNsYXNzTmFtZTogIm10LTAuNSBmbGV4LXNocmluay0wIiAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA0OTJ9fSApIDogUmVhY3QuY3JlYXRlRWxlbWVudChYLCB7IHNpemU6IDIwLCBjbGFzc05hbWU6ICJtdC0wLjUgZmxleC1zaHJpbmstMCIgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNDkyfX0gKQogICAgICAgICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJ0ZXh0LXNtIiwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDQ5M319CiAgICAgICAgICAgICAgICAgICAgICAsIGZlZWRiYWNrW2l0ZW0uaWRdLnZhbHVlICYmICFmZWVkYmFja1tpdGVtLmlkXS53cm9uZ1R5cGUgJiYgKA0KICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJmb250LWJvbGQgbWItMSIgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNDk1fX0KICAgICAgICAgICAgICAgICAgICAgICAgICAsIGl0ZW0ubmFtZSwgIjogIiAsIGZlZWRiYWNrW2l0ZW0uaWRdLnZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiBmZWVkYmFja1tpdGVtLmlkXS53cm9uZ1R5cGUgPyAnZm9udC1ib2xkJyA6ICcnLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNDk5fX0KICAgICAgICAgICAgICAgICAgICAgICAgLCBmZWVkYmFja1tpdGVtLmlkXS5tZXNzYWdlCiAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICkKICAgICAgICAgICAgKQ0KICAgICAgICAgICkpCiAgICAgICAgKQoKICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAiZmxleCBnYXAtNCBqdXN0aWZ5LWNlbnRlciIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDUxMH19CiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicsIHsNCiAgICAgICAgICAgIG9uQ2xpY2s6IGdlbmVyYXRlTmV3RXhhbXBsZXMsDQogICAgICAgICAgICBjbGFzc05hbWU6ICJweC02IHB5LTMgYmctcHVycGxlLTYwMCBob3ZlcjpiZy1wdXJwbGUtNzAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBmb250LXNlbWlib2xkIHRyYW5zaXRpb24tYWxsIHNoYWRvdy1sZyBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiIgICAgICAgICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDUxMX19DQoKICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KFJlZnJlc2hDdywgeyBzaXplOiAyMCwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDUxNX19ICksICIgTmV3IEV4YW1wbGVzIgogICAgICAgICAgKQogICAgICAgICAgLCBhbGxBbnN3ZXJlZCAmJiAoDQogICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdidXR0b24nLCB7DQogICAgICAgICAgICAgIG9uQ2xpY2s6ICgpID0+IHNldEN1cnJlbnRBY3Rpdml0eSgyKSwNCiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAicHgtNiBweS0zIGJnLWdyZWVuLTYwMCBob3ZlcjpiZy1ncmVlbi03MDAgdGV4dC13aGl0ZSByb3VuZGVkLWxnIGZvbnQtc2VtaWJvbGQgdHJhbnNpdGlvbi1hbGwgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIiICAgICAgICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDUxOH19DQosICJOZXh0IEFjdGl2aXR5ICIKICAgICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudChDaGV2cm9uUmlnaHQsIHsgc2l6ZTogMjAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA1MjJ9fSApCiAgICAgICAgICAgICkNCiAgICAgICAgICApCiAgICAgICAgKQogICAgICApDQogICAgKTsNCiAgfQ0KDQogIC8vIC0tLSBBY3Rpdml0eSAyOiBXaHkgQ29udmVydD8gLS0tDQogIGNvbnN0IHJvb21XaWR0aFB4ID0gZ2V0Um9vbVdpZHRoKCk7DQogIGNvbnN0IG1lYXN1cmVkTW0gPSAobWVhc3VyZVdpZHRoIC8gcm9vbVdpZHRoUHggKiAzNzUwKS50b0ZpeGVkKDApOw0KICBjb25zdCBtZWFzdXJlZENtID0gKG1lYXN1cmVkTW0gLyAxMCkudG9GaXhlZCgxKTsNCiAgY29uc3QgbWVhc3VyZWRNID0gKG1lYXN1cmVkTW0gLyAxMDAwKS50b0ZpeGVkKDIpOw0KDQogIGNvbnN0IHVuaXRDaG9pY2VzID0gWw0KICAgIHsgdmFsdWU6ICczNzUwIG1tJywgZXhwbGFuYXRpb246ICdUb28gbWFueSBkaWdpdHMgdG8gcXVpY2tseSBncmFzcCcsIGNvcnJlY3Q6IGZhbHNlIH0sDQogICAgeyB2YWx1ZTogJzM3NSBjbScsIGV4cGxhbmF0aW9uOiAnQmV0dGVyLCBidXQgc3RpbGwgYSBsYXJnZSBudW1iZXInLCBjb3JyZWN0OiBmYWxzZSB9LA0KICAgIHsgdmFsdWU6ICczLjc1IG0nLCBleHBsYW5hdGlvbjogJ1BlcmZlY3QhIEVhc3kgdG8gdmlzdWFsaXplJywgY29ycmVjdDogdHJ1ZSB9LA0KICAgIHsgdmFsdWU6ICcwLjAwMzc1IGttJywgZXhwbGFuYXRpb246ICdUb28gc21hbGwgLSBoYXJkIHRvIHBpY3R1cmUnLCBjb3JyZWN0OiBmYWxzZSB9DQogIF07DQoNCiAgcmV0dXJuICgNCiAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IA0KICAgICAgb25Nb3VzZU1vdmU6IGhhbmRsZU1lYXN1cmVNb3ZlLCANCiAgICAgIG9uTW91c2VVcDogaGFuZGxlTWVhc3VyZUVuZCwgDQogICAgICBvblRvdWNoTW92ZTogaGFuZGxlTWVhc3VyZU1vdmUsIA0KICAgICAgb25Ub3VjaEVuZDogaGFuZGxlTWVhc3VyZUVuZCwNCiAgICAgIGNsYXNzTmFtZTogInNlbGVjdC1ub25lIiwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDU0NH19DQoKICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdoMicsIHsgY2xhc3NOYW1lOiAidGV4dC0yeGwgZm9udC1ib2xkIG1iLTQgdGV4dC1ibHVlLTQwMCIgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA1NTF9fSwgIkFjdGl2aXR5IDI6IFdoeSBEbyBXZSBDb252ZXJ0IFVuaXRzPyIgICAgICApCiAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncCcsIHsgY2xhc3NOYW1lOiAidGV4dC1ncmF5LTMwMCBtYi02IiAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA1NTJ9fSwgIllvdSdyZSBtZWFzdXJpbmcgYSByb29tLiBEcmFnIHRoZSBtZWFzdXJpbmcgdGFwZSB0byBmaW5kIGl0cyB3aWR0aCwgdGhlbiBwaWNrIHRoZSBiZXN0IHVuaXQgdG8gZGVzY3JpYmUgaXQuIiAgICAgICAgICAgICAgICAgICApCgogICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAiYmctZ3JheS03MDAgcm91bmRlZC1sZyBwLTYgbWQ6cC04IG1iLTYiICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDU1NH19CiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogInRleHQtY2VudGVyIG1iLTQiICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDU1NX19CiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAidGV4dC02eGwgbWItNCIgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNTU2fX0sICLwn5OPIikKICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnaDMnLCB7IGNsYXNzTmFtZTogInRleHQtMnhsIGZvbnQtYm9sZCBtYi02IiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNTU3fX0sICJNZWFzdXJlIHRoZSBSb29tOiIgICkKICAgICAgICApCgogICAgICAgIC8qIC0tLSBJbnRlcmFjdGl2ZSBNZWFzdXJlbWVudCAtLS0gKi8KICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgDQogICAgICAgICAgcmVmOiByb29tUmVmLA0KICAgICAgICAgIGNsYXNzTmFtZTogInJlbGF0aXZlIHctZnVsbCBoLTI0IGJnLWdyYXktODAwIHJvdW5kZWQtbGcgYm9yZGVyLTIgYm9yZGVyLWdyYXktNjAwIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiBweC00IGN1cnNvci1ncmFiIiAgICAgICAgICAgLA0KICAgICAgICAgIG9uTW91c2VEb3duOiBoYW5kbGVNZWFzdXJlU3RhcnQsDQogICAgICAgICAgb25Ub3VjaFN0YXJ0OiBoYW5kbGVNZWFzdXJlU3RhcnQsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA1NjF9fQ0KCiAgICAgICAgICAvKiBXYWxsIG1hcmtlcnMgKi8KICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJhYnNvbHV0ZSBsZWZ0LTAgdG9wLTAgaC1mdWxsIHctMiBiZy1ncmF5LTUwMCByb3VuZGVkLWwtbWQiICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNTY4fX0pCiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAiYWJzb2x1dGUgcmlnaHQtMCB0b3AtMCBoLWZ1bGwgdy0yIGJnLWdyYXktNTAwIHJvdW5kZWQtci1tZCIgICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA1Njl9fSkKCiAgICAgICAgICAvKiBNZWFzdXJpbmcgVGFwZSAqLwogICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IA0KICAgICAgICAgICAgY2xhc3NOYW1lOiAiYWJzb2x1dGUgbGVmdC0wIHRvcC0wIGgtZnVsbCBiZy15ZWxsb3ctNTAwLzMwIGJvcmRlci1yLTQgYm9yZGVyLXllbGxvdy02MDAgcm91bmRlZC1sLWxnIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktZW5kIHByLTIiICAgICAgICAgICAsDQogICAgICAgICAgICBzdHlsZTogeyB3aWR0aDogYCR7bWVhc3VyZVdpZHRofXB4YCB9LCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNTcyfX0NCgogICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7IGNsYXNzTmFtZTogInRleHQteWVsbG93LTEwMCBmb250LWJvbGQgdGV4dC1sZyIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDU3Nn19LCBtZWFzdXJlZE0sICIgbSIgKQogICAgICAgICAgKQoKICAgICAgICAgIC8qIERyYWcgSGFuZGxlICovCiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgDQogICAgICAgICAgICBjbGFzc05hbWU6ICJhYnNvbHV0ZSB0b3AtMS8yIC10cmFuc2xhdGUteS0xLzIgdy00IGgtMTIgYmctZ3JheS05MDAgYm9yZGVyLTIgYm9yZGVyLWdyYXktNDAwIHJvdW5kZWQtbWQgY3Vyc29yLWdyYWIgYWN0aXZlOmN1cnNvci1ncmFiYmluZyIgICAgICAgICAgLA0KICAgICAgICAgICAgc3R5bGU6IHsgbGVmdDogYCR7bWVhc3VyZVdpZHRoIC0gOH1weGAgfSwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDU4MH19DQopCgogICAgICAgICAgLCAhcm9vbU1lYXN1cmVkICYmICFpc0RyYWdnaW5nICYmICgNCiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7IGNsYXNzTmFtZTogInRleHQtZ3JheS00MDAgYW5pbWF0ZS1wdWxzZSB0ZXh0LWNlbnRlciB3LWZ1bGwiICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNTg2fX0sICJDbGljayBhbmQgZHJhZyB0byBtZWFzdXJlISIgICAgKQ0KICAgICAgICAgICkKICAgICAgICApCiAgICAgICAgLyogLS0tIEVuZCBJbnRlcmFjdGl2ZSBNZWFzdXJlbWVudCAtLS0gKi8KCiAgICAgICAgLCByb29tTWVhc3VyZWQgJiYgKA0KICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAibXQtOCIsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA1OTJ9fQogICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2g0JywgeyBjbGFzc05hbWU6ICJ0ZXh0LWxnIGZvbnQtc2VtaWJvbGQgdGV4dC1jZW50ZXIgbWItNCIgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA1OTN9fSwgIkdyZWF0ISBUaGUgcm9vbSBpcyAzLjc1IG0gKG9yIDM3NSBjbSkuIFdoaWNoIHdheSBpcyBiZXN0PyIgICAgICAgICAgICApCiAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJncmlkIGdyaWQtY29scy0xIG1kOmdyaWQtY29scy0yIGdhcC00IG1iLTYiICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDU5NH19CiAgICAgICAgICAgICAgLCB1bml0Q2hvaWNlcy5tYXAoKG9wdGlvbikgPT4gKA0KICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicsIHsNCiAgICAgICAgICAgICAgICAgIGtleTogb3B0aW9uLnZhbHVlLA0KICAgICAgICAgICAgICAgICAgb25DbGljazogKCkgPT4gaGFuZGxlVW5pdENob2ljZShvcHRpb24pLA0KICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiYmctZ3JheS04MDAgcC02IHJvdW5kZWQtbGcgYm9yZGVyLTIgYm9yZGVyLWdyYXktNjAwIGhvdmVyOmJvcmRlci1ibHVlLTUwMCB0cmFuc2l0aW9uLWFsbCB0ZXh0LWxlZnQiICAgICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDU5Nn19DQoKICAgICAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogInRleHQtM3hsIGZvbnQtYm9sZCB0ZXh0LWJsdWUtNDAwIG1iLTIiICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNjAxfX0sIG9wdGlvbi52YWx1ZSkKICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgKSkKICAgICAgICAgICAgKQogICAgICAgICAgKQ0KICAgICAgICApCgogICAgICAgICwgbWVhc3VyZUZlZWRiYWNrICYmICgNCiAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogYG10LTQgcC0zIHJvdW5kZWQtbGcgYm9yZGVyLTIgJHsNCiAgICAgICAgICAgIG1lYXN1cmVGZWVkYmFjay50eXBlID09PSAnZ29vZCcgPyAnYmctZ3JlZW4tOTAwLzUwIGJvcmRlci1ncmVlbi01MDAnIDoNCiAgICAgICAgICAgIG1lYXN1cmVGZWVkYmFjay50eXBlID09PSAnd2FybicgPyAnYmctb3JhbmdlLTkwMC81MCBib3JkZXItb3JhbmdlLTUwMCcgOg0KICAgICAgICAgICAgJ2JnLXJlZC05MDAvNTAgYm9yZGVyLXJlZC01MDAnDQogICAgICAgICAgfWAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA2MDl9fQogICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAiZmxleCBpdGVtcy1zdGFydCBnYXAtMiIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDYxNH19CiAgICAgICAgICAgICAgLCBtZWFzdXJlRmVlZGJhY2sudHlwZSA9PT0gJ2dvb2QnID8gUmVhY3QuY3JlYXRlRWxlbWVudChDaGVjaywgeyBzaXplOiAyMCwgY2xhc3NOYW1lOiAibXQtMC41IGZsZXgtc2hyaW5rLTAgdGV4dC1ncmVlbi00MDAiICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA2MTV9fSApIDogUmVhY3QuY3JlYXRlRWxlbWVudChYLCB7IHNpemU6IDIwLCBjbGFzc05hbWU6ICJtdC0wLjUgZmxleC1zaHJpbmstMCB0ZXh0LXJlZC00MDAiICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA2MTV9fSApCiAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdwJywgeyBjbGFzc05hbWU6IGB0ZXh0LXNtICR7DQogICAgICAgICAgICAgICAgbWVhc3VyZUZlZWRiYWNrLnR5cGUgPT09ICdnb29kJyA/ICd0ZXh0LWdyZWVuLTIwMCcgOg0KICAgICAgICAgICAgICAgIG1lYXN1cmVGZWVkYmFjay50eXBlID09PSAnd2FybicgPyAndGV4dC1vcmFuZ2UtMjAwJyA6DQogICAgICAgICAgICAgICAgJ3RleHQtcmVkLTIwMCcNCiAgICAgICAgICAgICAgfWAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA2MTZ9fQogICAgICAgICAgICAgICAgLCBtZWFzdXJlRmVlZGJhY2subWVzc2FnZQogICAgICAgICAgICAgICkKICAgICAgICAgICAgKQogICAgICAgICAgKQ0KICAgICAgICApCiAgICAgICkKCiAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJiZy1wdXJwbGUtOTAwLzMwIGJvcmRlci0yIGJvcmRlci1wdXJwbGUtNTAwIHJvdW5kZWQtbGcgcC02IG1iLTYiICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA2Mjh9fQogICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJmbGV4IGl0ZW1zLXN0YXJ0IGdhcC0zIiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNjI5fX0KICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudChMaWdodGJ1bGIsIHsgc2l6ZTogMjQsIGNsYXNzTmFtZTogInRleHQteWVsbG93LTQwMCBtdC0xIGZsZXgtc2hyaW5rLTAiICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA2MzB9fSApCiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNjMxfX0KICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdoNCcsIHsgY2xhc3NOYW1lOiAiZm9udC1ib2xkIHRleHQtbGcgbWItMiB0ZXh0LXB1cnBsZS0zMDAiICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNjMyfX0sICJLZXkgSW5zaWdodDoiICkKICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdwJywgeyBjbGFzc05hbWU6ICJ0ZXh0LWdyYXktMjAwIiwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDYzM319LCAiV2UgY29udmVydCB1bml0cyB0byBtYWtlIG1lYXN1cmVtZW50cyBlYXNpZXIgdG8gdW5kZXJzdGFuZCBhbmQgd29yayB3aXRoLiBUaGUgXCJiZXN0XCIgdW5pdCBkZXBlbmRzIG9uIHRoZSBzaXplIG9mIHdoYXQgd2UncmUgbWVhc3VyaW5nLiBUb28gbGFyZ2Ugb3IgdG9vIHNtYWxsIG51bWJlcnMgd2l0aCBkZWNpbWFscyBhcmUgaGFyZCB0byBwaWN0dXJlISIKCiAgICAgICAgICAgICkKICAgICAgICAgICkKICAgICAgICApCiAgICAgICkKCiAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJmbGV4IGp1c3RpZnktY2VudGVyIGdhcC00IiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNjQwfX0KICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicsIHsNCiAgICAgICAgICBvbkNsaWNrOiAoKSA9PiBzZXRDdXJyZW50QWN0aXZpdHkoMSksDQogICAgICAgICAgY2xhc3NOYW1lOiAicHgtNiBweS0zIGJnLWJsdWUtNjAwIGhvdmVyOmJnLWJsdWUtNzAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBmb250LXNlbWlib2xkIHRyYW5zaXRpb24tYWxsIiAgICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA2NDF9fQ0KLCAiQmFjayB0byBBY3Rpdml0eSAxIgoKICAgICAgICApCiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdidXR0b24nLCB7DQogICAgICAgICAgb25DbGljazogcmVzZXRBY3Rpdml0eTIsDQogICAgICAgICAgY2xhc3NOYW1lOiAicHgtNiBweS0zIGJnLWdyYXktNjAwIGhvdmVyOmJnLWdyYXktNTAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBmb250LXNlbWlib2xkIHRyYW5zaXRpb24tYWxsIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIiAgICAgICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA2NDd9fQ0KCiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoUmVmcmVzaEN3LCB7IHNpemU6IDE4LCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNjUxfX0gKSwgIiBSZXNldCIKICAgICAgICApCiAgICAgICkKICAgICkNCiAgKTsNCn07DQoNCi8vIFRhYiAyOiBVbmRlcnN0YW5kaW5nIENvbnZlcnNpb25zDQpjb25zdCBVbmRlcnN0YW5kaW5nQ29udmVyc2lvbnNUYWIgPSAoKSA9PiB7DQogIGNvbnN0IFtzbGlkZXJWYWx1ZSwgc2V0U2xpZGVyVmFsdWVdID0gdXNlU3RhdGUoMjUwKTsgLy8gQmFzZSB2YWx1ZSBpbiBjbQ0KICBjb25zdCBbY3VycmVudFVuaXQsIHNldEN1cnJlbnRVbml0XSA9IHVzZVN0YXRlKCdjbScpOw0KICBjb25zdCBbZmVlZGJhY2ssIHNldEZlZWRiYWNrXSA9IHVzZVN0YXRlKG51bGwpOyAvLyBTdGF0ZSBmb3IgZmVlZGJhY2sNCg0KICAvLyBNZW1vaXplIGNvbnZlcnNpb25zIG9iamVjdA0KICBjb25zdCBjb252ZXJzaW9ucyA9IFJlYWN0LnVzZU1lbW8oKCkgPT4gKHsNCiAgICBtbTogeyB2YWx1ZTogc2xpZGVyVmFsdWUgKiAxMCwgbGFiZWw6ICdtaWxsaW1ldGVycycgfSwNCiAgICBjbTogeyB2YWx1ZTogc2xpZGVyVmFsdWUsIGxhYmVsOiAnY2VudGltZXRlcnMnIH0sDQogICAgbTogeyB2YWx1ZTogc2xpZGVyVmFsdWUgLyAxMDAsIGxhYmVsOiAnbWV0ZXJzJyB9LA0KICAgIGttOiB7IHZhbHVlOiBzbGlkZXJWYWx1ZSAvIDEwMDAwMCwgbGFiZWw6ICdraWxvbWV0ZXJzJyB9DQogIH0pLCBbc2xpZGVyVmFsdWVdKTsNCg0KICAvLyBNZW1vaXplIGZlZWRiYWNrIGZ1bmN0aW9uDQogIGNvbnN0IGdldEZlZWRiYWNrID0gUmVhY3QudXNlQ2FsbGJhY2soKHVuaXQsIHZhbHVlKSA9PiB7DQogICAgc3dpdGNoICh1bml0KSB7DQogICAgICBjYXNlICdtbSc6DQogICAgICAgIGlmICh2YWx1ZSA+IDEwMDApIHJldHVybiB7IG1lc3NhZ2U6ICJUaGlzIG51bWJlciBpcyBnZXR0aW5nIGEgYml0IGxhcmdlISAnY20nIG9yICdtJyBtaWdodCBiZSBjbGVhcmVyLiIsIHR5cGU6ICd3YXJuJyB9Ow0KICAgICAgICBpZiAodmFsdWUgPCAxMCAmJiB2YWx1ZSA+IDApIHJldHVybiB7IG1lc3NhZ2U6ICJHb29kIGZvciB2ZXJ5IHNtYWxsIHRoaW5ncywgYnV0ICdjbScgbWlnaHQgYmUgZWFzaWVyIHRvIHJlYWQgaGVyZS4iLCB0eXBlOiAnb2snIH07DQogICAgICAgIGlmICh2YWx1ZSA9PT0gMCkgcmV0dXJuIHsgbWVzc2FnZTogIlRoaXMgdmFsdWUgaXMgMCEiLCB0eXBlOiAnb2snIH07DQogICAgICAgIHJldHVybiB7IG1lc3NhZ2U6ICJNaWxsaW1ldGVycyBhcmUgZ3JlYXQgZm9yIHByZWNpc2UsIHNtYWxsIG1lYXN1cmVtZW50cy4iLCB0eXBlOiAnb2snIH07DQogICAgICBjYXNlICdjbSc6DQogICAgICAgIGlmICh2YWx1ZSA+IDMwMCkgcmV0dXJuIHsgbWVzc2FnZTogIkNlbnRpbWV0ZXJzIHdvcmssIGJ1dCAnbWV0ZXJzJyBtaWdodCBiZSBzaW1wbGVyIGZvciB0aGlzIGxlbmd0aC4iLCB0eXBlOiAnd2FybicgfTsNCiAgICAgICAgaWYgKHZhbHVlIDwgMSAmJiB2YWx1ZSA+IDApIHJldHVybiB7IG1lc3NhZ2U6ICJUaGlzIGlzIGxlc3MgdGhhbiAxIGNtISAnbW0nIHdvdWxkIGJlIGJldHRlci4iLCB0eXBlOiAnd2FybicgfTsNCiAgICAgICAgcmV0dXJuIHsgbWVzc2FnZTogIkNlbnRpbWV0ZXJzIGFyZSBhIGdyZWF0LCBlYXN5LXRvLXJlYWQgdW5pdCBmb3IgdGhpcyBzaXplISIsIHR5cGU6ICdnb29kJyB9Ow0KICAgICAgY2FzZSAnbSc6DQogICAgICAgIGlmICh2YWx1ZSA+IDEwMCkgcmV0dXJuIHsgbWVzc2FnZTogIlRoaXMgaXMgYSBsYXJnZSBkaXN0YW5jZSEgJ2ttJyB3b3VsZCBiZSBtdWNoIGVhc2llci4iLCB0eXBlOiAnd2FybicgfTsNCiAgICAgICAgaWYgKHZhbHVlIDwgMSAmJiB2YWx1ZSA+IDApIHJldHVybiB7IG1lc3NhZ2U6ICJVc2luZyBhIGRlY2ltYWwgZm9yIG1ldGVycyBjYW4gYmUgYXdrd2FyZC4gJ2NtJyBtaWdodCBiZSBjbGVhcmVyLiIsIHR5cGU6ICd3YXJuJyB9Ow0KICAgICAgICBpZiAodmFsdWUgPj0gMSAmJiB2YWx1ZSA8IDEwKSByZXR1cm4geyBtZXNzYWdlOiAiTWV0ZXJzIGFyZSBwZXJmZWN0IGZvciB0aGlzIHNpemUsIHZlcnkgZWFzeSB0byBwaWN0dXJlISIsIHR5cGU6ICdnb29kJyB9Ow0KICAgICAgICByZXR1cm4geyBtZXNzYWdlOiAiTWV0ZXJzIHdvcmsgd2VsbCBmb3IgdGhpcyBsZW5ndGguIiwgdHlwZTogJ29rJyB9Ow0KICAgICAgY2FzZSAna20nOg0KICAgICAgICBpZiAodmFsdWUgPj0gMSkgcmV0dXJuIHsgbWVzc2FnZTogIktpbG9tZXRlcnMgYXJlIGZvciBsb25nIGRpc3RhbmNlcy4gVGhpcyBpcyBhIGdvb2QgdW5pdCBpZiB5b3UncmUgbWVhc3VyaW5nIGEgcm9hZCEiLCB0eXBlOiAnZ29vZCcgfTsNCiAgICAgICAgcmV0dXJuIHsgbWVzc2FnZTogIlRoaXMgbnVtYmVyIGlzIHRpbnkhIEtpbG9tZXRlcnMgYXJlIHdheSB0b28gYmlnIGZvciB0aGlzIG1lYXN1cmVtZW50LiIsIHR5cGU6ICdiYWQnIH07DQogICAgICBkZWZhdWx0Og0KICAgICAgICByZXR1cm4geyBtZXNzYWdlOiAnJywgdHlwZTogJ29rJyB9Ow0KICAgIH0NCiAgfSwgW10pOw0KDQogIC8vIFVwZGF0ZSBmZWVkYmFjayB3aGVuIHNsaWRlciBvciB1bml0IGNoYW5nZXMNCiAgdXNlRWZmZWN0KCgpID0+IHsNCiAgICBjb25zdCB2YWx1ZSA9IGNvbnZlcnNpb25zW2N1cnJlbnRVbml0XS52YWx1ZTsNCiAgICBjb25zdCBmZWVkYmFja01lc3NhZ2UgPSBnZXRGZWVkYmFjayhjdXJyZW50VW5pdCwgdmFsdWUpOw0KICAgIHNldEZlZWRiYWNrKGZlZWRiYWNrTWVzc2FnZSk7DQogIH0sIFtzbGlkZXJWYWx1ZSwgY3VycmVudFVuaXQsIGNvbnZlcnNpb25zLCBnZXRGZWVkYmFja10pOw0KDQogIHJldHVybiAoDQogICAgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2Jywge19fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA3MDV9fQogICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2gyJywgeyBjbGFzc05hbWU6ICJ0ZXh0LTJ4bCBmb250LWJvbGQgbWItNCB0ZXh0LWJsdWUtNDAwIiAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDcwNn19LCAiVW5kZXJzdGFuZGluZyBDb252ZXJzaW9ucyIgKQogICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3AnLCB7IGNsYXNzTmFtZTogInRleHQtZ3JheS0zMDAgbWItNiIgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzA3fX0sICJTZWUgaG93IHRoZSBzYW1lIG1lYXN1cmVtZW50IGNoYW5nZXMgd2hlbiB3ZSBjb252ZXJ0IGJldHdlZW4gdW5pdHMuIE5vdGljZSBob3cgdGhlIGRlY2ltYWwgcG9pbnQgbW92ZXMhIiAgICAgICAgICAgICAgICApCgogICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAiYmctZ3JheS03MDAgcm91bmRlZC1sZyBwLTggbWItOCIgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA3MDl9fQogICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnaDMnLCB7IGNsYXNzTmFtZTogInRleHQteGwgZm9udC1ib2xkIG1iLTYgdGV4dC1jZW50ZXIiICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzEwfX0sICJJbnRlcmFjdGl2ZSBDb252ZXJzaW9uIEV4cGxvcmVyIChCYXNlOiBjbSkiICAgICkKCiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogIm1iLTgiLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzEyfX0KICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnbGFiZWwnLCB7IGNsYXNzTmFtZTogImJsb2NrIHRleHQtc20gZm9udC1zZW1pYm9sZCBtYi0zIHRleHQtZ3JheS0zMDAiICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDcxM319LCAiQWRqdXN0IHRoZSBtZWFzdXJlbWVudDogIiAgICwgc2xpZGVyVmFsdWUsICIgY20iICkKICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJyZWxhdGl2ZSBwdC00IiAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA3MTR9fQogICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jywgew0KICAgICAgICAgICAgICB0eXBlOiAicmFuZ2UiLA0KICAgICAgICAgICAgICBtaW46ICIxIiwNCiAgICAgICAgICAgICAgbWF4OiAiNTAwIiwNCiAgICAgICAgICAgICAgdmFsdWU6IHNsaWRlclZhbHVlLA0KICAgICAgICAgICAgICBvbkNoYW5nZTogKGUpID0+IHNldFNsaWRlclZhbHVlKE51bWJlcihlLnRhcmdldC52YWx1ZSkpLA0KICAgICAgICAgICAgICBjbGFzc05hbWU6ICJ3LWZ1bGwgaC0yIGJnLXRyYW5zcGFyZW50IHJvdW5kZWQtbGcgYXBwZWFyYW5jZS1ub25lIGN1cnNvci1wb2ludGVyIHotMTAgcmVsYXRpdmUiICAgICAgICwNCiAgICAgICAgICAgICAgc3R5bGU6IHsNCiAgICAgICAgICAgICAgICAvLyBDdXN0b20gc3R5bGVzIGZvciB0aHVtYg0KICAgICAgICAgICAgICAgICctLXNsaWRlci10aHVtYi1iZyc6ICcjM2I4MmY2JywgLy8gYmx1ZS01MDANCiAgICAgICAgICAgICAgICAnLS1zbGlkZXItdGh1bWItYm9yZGVyJzogJyMxZTNhOGEnLCAvLyBibHVlLTgwMA0KICAgICAgICAgICAgICB9LCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzE1fX0NCiAgICAgICAgICAgICkKICAgICAgICAgICAgIC8qIFJ1bGVyIFRyYWNrICovCiAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJhYnNvbHV0ZSB0b3AtMS8yIGxlZnQtMCB3LWZ1bGwgaC0yIC10cmFuc2xhdGUteS1weCBiZy1ncmF5LTYwMCByb3VuZGVkLWxnIG92ZXJmbG93LWhpZGRlbiIgICAgICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDcyOX19CiAgICAgICAgICAgICAgICAvKiBUaWNrIG1hcmtzICovCiAgICAgICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAiYWJzb2x1dGUgdG9wLTAgbGVmdC0wIGgtZnVsbCB3LWZ1bGwgZmxleCBqdXN0aWZ5LWJldHdlZW4iICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzMxfX0KICAgICAgICAgICAgICAgICAgLCBbLi4uQXJyYXkoMTEpXS5tYXAoKF8sIGkpID0+ICgNCiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3BhbicsIHsga2V5OiBpLCBjbGFzc05hbWU6IGB3LTAuNSBoLWZ1bGwgJHtpICUgNSA9PT0gMCA/ICdiZy1ncmF5LTIwMCcgOiAnYmctZ3JheS00MDAnfWAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA3MzN9fSkNCiAgICAgICAgICAgICAgICAgICkpCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICkKICAgICAgICAgICAgLyogUnVsZXIgTGFiZWxzICovCiAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJhYnNvbHV0ZSAtYm90dG9tLTYgbGVmdC0wIHctZnVsbCBmbGV4IGp1c3RpZnktYmV0d2VlbiB0ZXh0LXhzIHRleHQtZ3JheS00MDAiICAgICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDczOH19CiAgICAgICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7X19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDczOX19LCAiMSIpCiAgICAgICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7X19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDc0MH19LCAiMTAwIikKICAgICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3BhbicsIHtfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzQxfX0sICIyMDAiKQogICAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywge19fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA3NDJ9fSwgIjMwMCIpCiAgICAgICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7X19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDc0M319LCAiNDAwIikKICAgICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3BhbicsIHtfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzQ0fX0sICI1MDAiKQogICAgICAgICAgICApCiAgICAgICAgICApCiAgICAgICAgKQoKICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAiZ3JpZCBncmlkLWNvbHMtMiBtZDpncmlkLWNvbHMtNCBnYXAtNCBtYi04IG10LTEyIiAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzQ5fX0KICAgICAgICAgICwgT2JqZWN0LmVudHJpZXMoY29udmVyc2lvbnMpLm1hcCgoW3VuaXQsIGRhdGFdKSA9PiAoDQogICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7DQogICAgICAgICAgICAgIGtleTogdW5pdCwNCiAgICAgICAgICAgICAgb25DbGljazogKCkgPT4gc2V0Q3VycmVudFVuaXQodW5pdCksIC8vIEp1c3Qgc2V0IHRoZSBjdXJyZW50IHVuaXQNCiAgICAgICAgICAgICAgY2xhc3NOYW1lOiBgcC02IHJvdW5kZWQtbGcgYm9yZGVyLTIgY3Vyc29yLXBvaW50ZXIgdHJhbnNpdGlvbi1hbGwgJHsNCiAgICAgICAgICAgICAgICBjdXJyZW50VW5pdCA9PT0gdW5pdA0KICAgICAgICAgICAgICAgICAgPyAnYm9yZGVyLWJsdWUtNTAwIGJnLWJsdWUtOTAwLzMwJw0KICAgICAgICAgICAgICAgICAgOiAnYm9yZGVyLWdyYXktNjAwIGJnLWdyYXktODAwIGhvdmVyOmJvcmRlci1ncmF5LTUwMCcNCiAgICAgICAgICAgICAgfWAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA3NTF9fQ0KCiAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogInRleHQtM3hsIGZvbnQtYm9sZCB0ZXh0LWJsdWUtNDAwIG1iLTEiICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzYwfX0KICAgICAgICAgICAgICAgICwgZGF0YS52YWx1ZS50b0xvY2FsZVN0cmluZyh1bmRlZmluZWQsIHsgDQogICAgICAgICAgICAgICAgICBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IHVuaXQgPT09ICdrbScgPyA1IDogMiwgDQogICAgICAgICAgICAgICAgICBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDAgDQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogInRleHQtc20gdGV4dC1ncmF5LTQwMCIgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzY2fX0sIGRhdGEubGFiZWwsICIgKCIgLCB1bml0LCAiKSIpCiAgICAgICAgICAgICkNCiAgICAgICAgICApKQogICAgICAgICkKCiAgICAgICAgLyogLS0tIEZlZWRiYWNrIEJveCAtLS0gKi8KICAgICAgICAsIGZlZWRiYWNrICYmICgNCiAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogYG1iLTggcC00IHJvdW5kZWQtbGcgYm9yZGVyLTIgJHsNCiAgICAgICAgICAgIGZlZWRiYWNrLnR5cGUgPT09ICdnb29kJyA/ICdiZy1ncmVlbi05MDAvNTAgYm9yZGVyLWdyZWVuLTUwMCcgOg0KICAgICAgICAgICAgZmVlZGJhY2sudHlwZSA9PT0gJ3dhcm4nID8gJ2JnLW9yYW5nZS05MDAvNTAgYm9yZGVyLW9yYW5nZS01MDAnIDoNCiAgICAgICAgICAgIGZlZWRiYWNrLnR5cGUgPT09ICdiYWQnID8gJ2JnLXJlZC05MDAvNTAgYm9yZGVyLXJlZC01MDAnIDoNCiAgICAgICAgICAgICdiZy1ibHVlLTkwMC8zMCBib3JkZXItYmx1ZS01MDAnIC8vICdvaycgdHlwZQ0KICAgICAgICAgIH1gLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzczfX0KICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImZsZXggaXRlbXMtc3RhcnQgZ2FwLTIiICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA3Nzl9fQogICAgICAgICAgICAgICwgZmVlZGJhY2sudHlwZSA9PT0gJ2dvb2QnID8gUmVhY3QuY3JlYXRlRWxlbWVudChDaGVjaywgeyBzaXplOiAyMCwgY2xhc3NOYW1lOiAibXQtMC41IGZsZXgtc2hyaW5rLTAgdGV4dC1ncmVlbi00MDAiICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA3ODB9fSApIDoNCiAgICAgICAgICAgICAgIGZlZWRiYWNrLnR5cGUgPT09ICdiYWQnID8gUmVhY3QuY3JlYXRlRWxlbWVudChYLCB7IHNpemU6IDIwLCBjbGFzc05hbWU6ICJtdC0wLjUgZmxleC1zaHJpbmstMCB0ZXh0LXJlZC00MDAiICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA3ODF9fSApIDoNCiAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoTGlnaHRidWxiLCB7IHNpemU6IDIwLCBjbGFzc05hbWU6ICJtdC0wLjUgZmxleC1zaHJpbmstMCB0ZXh0LXllbGxvdy00MDAiICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA3ODJ9fSApCiAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdwJywgeyBjbGFzc05hbWU6IGB0ZXh0LXNtICR7DQogICAgICAgICAgICAgICAgZmVlZGJhY2sudHlwZSA9PT0gJ2dvb2QnID8gJ3RleHQtZ3JlZW4tMjAwJyA6DQogICAgICAgICAgICAgICAgZmVlZGJhY2sudHlwZSA9PT0gJ3dhcm4nID8gJ3RleHQtb3JhbmdlLTIwMCcgOg0KICAgICAgICAgICAgICAgIGZlZWRiYWNrLnR5cGUgPT09ICdiYWQnID8gJ3RleHQtcmVkLTIwMCcgOg0KICAgICAgICAgICAgICAgICd0ZXh0LWJsdWUtMjAwJw0KICAgICAgICAgICAgICB9YCwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDc4M319CiAgICAgICAgICAgICAgICAsIGZlZWRiYWNrLm1lc3NhZ2UKICAgICAgICAgICAgICApCiAgICAgICAgICAgICkKICAgICAgICAgICkNCiAgICAgICAgKQogICAgICAgIC8qIC0tLSBFbmQgRmVlZGJhY2sgQm94IC0tLSAqLwoKCiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImJnLWdyYXktODAwIHJvdW5kZWQtbGcgcC02IiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzk3fX0KICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnaDQnLCB7IGNsYXNzTmFtZTogImZvbnQtYm9sZCBtYi00IHRleHQtbGcgdGV4dC1ibHVlLTMwMCIgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA3OTh9fSwgIkNvbnZlcnNpb24gUmVsYXRpb25zaGlwczoiICkKICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJzcGFjZS15LTMgdGV4dC1ncmF5LTIwMCIgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogNzk5fX0KICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImZsZXggZmxleC13cmFwIGl0ZW1zLWNlbnRlciBnYXAteC0zIGdhcC15LTEiICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDgwMH19CiAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICJmb250LW1vbm8gYmctZ3JheS03MDAgcHgtMyBweS0xIHJvdW5kZWQiICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDgwMX19LCAiMSBtID0gMTAwIGNtIiAgICApCiAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICJ0ZXh0LWdyYXktNDAwIiwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDgwMn19LCAi4oaSIG11bHRpcGx5IGJ5IDEwMCB0byBnbyBmcm9tIG0gdG8gY20iICAgICAgICAgKQogICAgICAgICAgICApCiAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJmbGV4IGZsZXgtd3JhcCBpdGVtcy1jZW50ZXIgZ2FwLXgtMyBnYXAteS0xIiAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA4MDR9fQogICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3BhbicsIHsgY2xhc3NOYW1lOiAiZm9udC1tb25vIGJnLWdyYXktNzAwIHB4LTMgcHktMSByb3VuZGVkIiAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA4MDV9fSwgIjEgbSA9IDEwMDAgbW0iICAgICkKICAgICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7IGNsYXNzTmFtZTogInRleHQtZ3JheS00MDAiLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogODA2fX0sICLihpIgbXVsdGlwbHkgYnkgMTAwMCB0byBnbyBmcm9tIG0gdG8gbW0iICAgICAgICAgKQogICAgICAgICAgICApCiAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJmbGV4IGZsZXgtd3JhcCBpdGVtcy1jZW50ZXIgZ2FwLXgtMyBnYXAteS0xIiAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA4MDh9fQogICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3BhbicsIHsgY2xhc3NOYW1lOiAiZm9udC1tb25vIGJnLWdyYXktNzAwIHB4LTMgcHktMSByb3VuZGVkIiAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA4MDl9fSwgIjEga20gPSAxMDAwIG0iICAgICkKICAgICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7IGNsYXNzTmFtZTogInRleHQtZ3JheS00MDAiLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogODEwfX0sICLihpIgbXVsdGlwbHkgYnkgMTAwMCB0byBnbyBmcm9tIGttIHRvIG0iICAgICAgICAgKQogICAgICAgICAgICApCiAgICAgICAgICApCiAgICAgICAgKQogICAgICApCgogICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAiYmctcHVycGxlLTkwMC8zMCBib3JkZXItMiBib3JkZXItcHVycGxlLTUwMCByb3VuZGVkLWxnIHAtNiIgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogODE2fX0KICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAiZmxleCBpdGVtcy1zdGFydCBnYXAtMyIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDgxN319CiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoTGlnaHRidWxiLCB7IHNpemU6IDI0LCBjbGFzc05hbWU6ICJ0ZXh0LXllbGxvdy00MDAgbXQtMSBmbGV4LXNocmluay0wIiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogODE4fX0gKQogICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7X19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDgxOX19CiAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnaDQnLCB7IGNsYXNzTmFtZTogImZvbnQtYm9sZCB0ZXh0LWxnIG1iLTIgdGV4dC1wdXJwbGUtMzAwIiAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDgyMH19LCAiQ29udmVyc2lvbiBGYWN0b3JzOiIgKQogICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3AnLCB7IGNsYXNzTmFtZTogInRleHQtZ3JheS0yMDAgbWItMyIgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogODIxfX0sICJBIGNvbnZlcnNpb24gZmFjdG9yIGlzIGEgcmF0aW8gdGhhdCBlcXVhbHMgMSwgbGlrZSBcIjEwMCBjbSAvIDEgbVwiLiBXaGVuIHdlIG11bHRpcGx5IGJ5IGl0LCB3ZSdyZSBub3QgY2hhbmdpbmcgdGhlIGFjdHVhbCBtZWFzdXJlbWVudOKAlGp1c3QgaG93IHdlIGV4cHJlc3MgaXQhIgoKICAgICAgICAgICAgKQogICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3AnLCB7IGNsYXNzTmFtZTogInRleHQtZ3JheS0yMDAiLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogODI0fX0sICLigKIgR29pbmcgdG8gYSBzbWFsbGVyIHVuaXQ/IE11bHRpcGx5ICh0aGUgbnVtYmVyIGdldHMgYmlnZ2VyKSIKICAgICAgICAgICAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdicicsIHtfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogODI1fX0gKSwgIuKAoiBHb2luZyB0byBhIGxhcmdlciB1bml0PyBEaXZpZGUgKHRoZSBudW1iZXIgZ2V0cyBzbWFsbGVyKSIKCiAgICAgICAgICAgICkKICAgICAgICAgICkKICAgICAgICApCiAgICAgICkKICAgICkNCiAgKTsNCn07DQoNCi8vIC0tLSBGcmFjdGlvbiBDb21wb25lbnQgZm9yIFRhYiAzIC0tLQ0KY29uc3QgRnJhY3Rpb24gPSAoeyBudW0sIGRlbiwgbnVtQ2FuY2VsbGVkLCBkZW5DYW5jZWxsZWQgfSkgPT4gew0KICBjb25zdCBbbnVtVmFsLCBudW1Vbml0XSA9IG51bS5zcGxpdCgnICcpOw0KICBjb25zdCBbZGVuVmFsLCBkZW5Vbml0XSA9IGRlbi5zcGxpdCgnICcpOw0KICANCiAgcmV0dXJuICgNCiAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImlubGluZS1mbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciB0ZXh0LWxnIG1kOnRleHQteGwgbXgtMSBmb250LW1vbm8iICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogODQxfX0KICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICJweC0yIiwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDg0Mn19CiAgICAgICAgLCBudW1WYWwsICcgJwogICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3BhbicsIHsgY2xhc3NOYW1lOiBgJHtudW1DYW5jZWxsZWQgPyAnbGluZS10aHJvdWdoIHRleHQtcmVkLTQwMCcgOiAnJ31gLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogODQ0fX0KICAgICAgICAgICwgbnVtVW5pdAogICAgICAgICkKICAgICAgKQogICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7IGNsYXNzTmFtZTogImJvcmRlci10LTIgYm9yZGVyLWdyYXktNDAwIHctZnVsbCBteS0xIiAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDg0OH19KQogICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7IGNsYXNzTmFtZTogInB4LTIiLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogODQ5fX0KICAgICAgICAsIGRlblZhbCwgJyAnCiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6IGAke2RlbkNhbmNlbGxlZCA/ICdsaW5lLXRocm91Z2ggdGV4dC1yZWQtNDAwJyA6ICcnfWAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiA4NTF9fQogICAgICAgICAgLCBkZW5Vbml0CiAgICAgICAgKQogICAgICApCiAgICApDQogICk7DQp9Ow0KDQoNCi8vIFRhYiAzOiBVbml0IENhbmNlbGxhdGlvbg0KY29uc3QgVW5pdENhbmNlbGxhdGlvblRhYiA9ICgpID0+IHsNCiAgY29uc3QgW2N1cnJlbnRMZXZlbCwgc2V0Q3VycmVudExldmVsXSA9IHVzZVN0YXRlKDEpOw0KICBjb25zdCBbc2VsZWN0ZWRGYWN0b3JzLCBzZXRTZWxlY3RlZEZhY3RvcnNdID0gdXNlU3RhdGUoW10pOw0KICBjb25zdCBbc2hvd1NvbHV0aW9uLCBzZXRTaG93U29sdXRpb25dID0gdXNlU3RhdGUoZmFsc2UpOw0KICBjb25zdCBbaGludCwgc2V0SGludF0gPSB1c2VTdGF0ZShudWxsKTsgLy8gU3RhdGUgZm9yIEhpbnRzDQoNCiAgLy8gVXNlIFJlYWN0LnVzZU1lbW8gdG8gYXZvaWQgcmVkZWZpbmluZyB0aGlzIG9iamVjdCBvbiBldmVyeSByZW5kZXINCiAgY29uc3QgbGV2ZWxzID0gUmVhY3QudXNlTWVtbygoKSA9PiAoew0KICAgIDE6IHsNCiAgICAgIHRpdGxlOiAnTGV2ZWwgMTogV2hhdCBpcyBDYW5jZWxsaW5nPycsDQogICAgICBwcm9ibGVtOiAnMTUwIGNtIHRvIG1ldGVycycsDQogICAgICBzdGFydDogeyB2YWx1ZTogMTUwLCB1bml0OiAnY20nIH0sDQogICAgICB0YXJnZXQ6ICdtJywNCiAgICAgIGZhY3RvcnM6IFsNCiAgICAgICAgeyBudW06ICcxIG0nLCBkZW46ICcxMDAgY20nLCBjb3JyZWN0OiB0cnVlLCBpZDogJzEtMScgfSwNCiAgICAgICAgeyBudW06ICcxMDAgY20nLCBkZW46ICcxIG0nLCBjb3JyZWN0OiBmYWxzZSwgaWQ6ICcxLTInIH0sDQogICAgICAgIHsgbnVtOiAnMSBrbScsIGRlbjogJzEwMDAgbScsIGNvcnJlY3Q6IGZhbHNlLCBpZDogJzEtMycgfQ0KICAgICAgXSwNCiAgICAgIHNvbHV0aW9uOiBbICcxLTEnIF0sDQogICAgICBleHBsYW5hdGlvbjogJ1dlIHVzZSB0aGUgY29udmVyc2lvbiBmYWN0b3Igd2l0aCAiY20iIGluIHRoZSBkZW5vbWluYXRvciBzbyBpdCBjYW5jZWxzIHdpdGggdGhlICJjbSIgaW4gb3VyIHN0YXJ0aW5nIHZhbHVlLicsDQogICAgICBjYWxjdWxhdGlvbjogJyggMTUwIMOXIDEgKSAvIDEwMCA9IDEuNSBtJw0KICAgIH0sDQogICAgMjogew0KICAgICAgdGl0bGU6ICdMZXZlbCAyOiBNdWx0aS1TdGVwIChjbSDihpIgbSDihpIga20pJywNCiAgICAgIHByb2JsZW06ICcyNTAsMDAwIGNtIHRvIGtpbG9tZXRlcnMnLA0KICAgICAgc3RhcnQ6IHsgdmFsdWU6IDI1MDAwMCwgdW5pdDogJ2NtJyB9LA0KICAgICAgdGFyZ2V0OiAna20nLA0KICAgICAgZmFjdG9yczogWw0KICAgICAgICB7IG51bTogJzEgbScsIGRlbjogJzEwMCBjbScsIGNvcnJlY3Q6IHRydWUsIG9yZGVyOiAxLCBpZDogJzItMScgfSwNCiAgICAgICAgeyBudW06ICcxIGttJywgZGVuOiAnMTAwMCBtJywgY29ycmVjdDogdHJ1ZSwgb3JkZXI6IDIsIGlkOiAnMi0yJyB9LA0KICAgICAgICB7IG51bTogJzEwMCBjbScsIGRlbjogJzEgbScsIGNvcnJlY3Q6IGZhbHNlLCBpZDogJzItMycgfSwNCiAgICAgICAgeyBudW06ICcxMDAwIG0nLCBkZW46ICcxIGttJywgY29ycmVjdDogZmFsc2UsIGlkOiAnMi00JyB9DQogICAgICBdLA0KICAgICAgc29sdXRpb246IFsnMi0xJywgJzItMiddLA0KICAgICAgZXhwbGFuYXRpb246ICdGaXJzdCBjYW5jZWwgImNtIiB0byBnZXQgIm0iLCB0aGVuIGNhbmNlbCAibSIgdG8gZ2V0ICJrbSIuIFRoZSBvcmRlciBtYXR0ZXJzIScsDQogICAgICBjYWxjdWxhdGlvbjogJyggMjUwMDAwIMOXIDEgw5cgMSApIC8gKCAxMDAgw5cgMTAwMCApID0gMi41IGttJw0KICAgIH0sDQogICAgMzogew0KICAgICAgdGl0bGU6ICdMZXZlbCAzOiBUaW1lIENvbnZlcnNpb24gKHNlYyDihpIgbWluIOKGkiBociknLA0KICAgICAgcHJvYmxlbTogJzcyMDAgc2Vjb25kcyB0byBob3VycycsDQogICAgICBzdGFydDogeyB2YWx1ZTogNzIwMCwgdW5pdDogJ3MnIH0sDQogICAgICB0YXJnZXQ6ICdocicsDQogICAgICBmYWN0b3JzOiBbDQogICAgICAgIHsgbnVtOiAnMSBtaW4nLCBkZW46ICc2MCBzJywgY29ycmVjdDogdHJ1ZSwgb3JkZXI6IDEsIGlkOiAnMy0xJyB9LA0KICAgICAgICB7IG51bTogJzEgaHInLCBkZW46ICc2MCBtaW4nLCBjb3JyZWN0OiB0cnVlLCBvcmRlcjogMiwgaWQ6ICczLTInIH0sDQogICAgICAgIHsgbnVtOiAnNjAgcycsIGRlbjogJzEgbWluJywgY29ycmVjdDogZmFsc2UsIGlkOiAnMy0zJyB9LA0KICAgICAgICB7IG51bTogJzYwIG1pbicsIGRlbjogJzEgaHInLCBjb3JyZWN0OiBmYWxzZSwgaWQ6ICczLTQnIH0NCiAgICAgIF0sDQogICAgICBzb2x1dGlvbjogWyczLTEnLCAnMy0yJ10sDQogICAgICBleHBsYW5hdGlvbjogJ0NhbmNlbCAic2Vjb25kcyIgd2l0aCB0aGUgZmlyc3QgZmFjdG9yLCB0aGVuIGNhbmNlbCAibWludXRlcyIgd2l0aCB0aGUgc2Vjb25kIHRvIGJlIGxlZnQgd2l0aCAiaG91cnMiLicsDQogICAgICBjYWxjdWxhdGlvbjogJyggNzIwMCDDlyAxIMOXIDEgKSAvICggNjAgw5cgNjAgKSA9IDIgaHInDQogICAgfQ0KICB9KSwgW10pOyAvLyBFbXB0eSBkZXBlbmRlbmN5IGFycmF5IG1lYW5zIHRoaXMgb2JqZWN0IGlzIGNyZWF0ZWQgb25seSBvbmNlDQoNCiAgY29uc3QgY3VycmVudFByb2JsZW0gPSBsZXZlbHNbY3VycmVudExldmVsXTsNCg0KICAvLyBUaGlzIHN0YXRlIHdpbGwgdHJhY2sgdGhlICJsaXZlIiBjYW5jZWxsYXRpb24gYXMgdXNlciBjbGlja3MNCiAgY29uc3QgW2xpdmVDYW5jZWxsYXRpb24sIHNldExpdmVDYW5jZWxsYXRpb25dID0gdXNlU3RhdGUoe30pOw0KDQogIC8vIFRoaXMgZnVuY3Rpb24gdXBkYXRlcyB0aGUgbGl2ZSBjYW5jZWxsYXRpb24gc3RhdGUgYW5kIHJldHVybnMgdGhlIGN1cnJlbnQgYWN0aXZlIHVuaXQNCiAgY29uc3QgdXBkYXRlTGl2ZUNhbmNlbGxhdGlvbiA9IChmYWN0b3JzKSA9PiB7DQogICAgbGV0IGFjdGl2ZVVuaXQgPSBjdXJyZW50UHJvYmxlbS5zdGFydC51bml0Ow0KICAgIGNvbnN0IGNhbmNlbGxhdGlvbnMgPSB7fTsgLy8geyAnMS0xJzogeyBudW06IGZhbHNlLCBkZW46IHRydWUgfSwgJ3N0YXJ0JzogeyB1bml0OiB0cnVlIH0gfQ0KICAgIA0KICAgIGxldCBzdGFydFVuaXRDYW5jZWxsZWQgPSBmYWxzZTsNCiAgICANCiAgICAvLyBTb3J0IGZhY3RvcnMgYnkgc2VsZWN0aW9uIG9yZGVyIGZvciB0aGlzIGxvZ2ljDQogICAgY29uc3Qgb3JkZXJlZEZhY3RvcnMgPSBmYWN0b3JzOyANCg0KICAgIGZvciAoY29uc3QgZmFjdG9yIG9mIG9yZGVyZWRGYWN0b3JzKSB7DQogICAgICBjb25zdCBbbnVtVmFsLCBudW1Vbml0XSA9IGZhY3Rvci5udW0uc3BsaXQoJyAnKTsNCiAgICAgIGNvbnN0IFtkZW5WYWwsIGRlblVuaXRdID0gZmFjdG9yLmRlbi5zcGxpdCgnICcpOw0KICAgICAgDQogICAgICBsZXQgZGVuQ2FuY2VsbGVkID0gZmFsc2U7DQogICAgICANCiAgICAgIC8vIENoZWNrIGlmIHRoZSBkZW5vbWluYXRvciBjYW5jZWxzIHRoZSBhY3RpdmUgdW5pdA0KICAgICAgaWYgKGRlblVuaXQgPT09IGFjdGl2ZVVuaXQpIHsNCiAgICAgICAgZGVuQ2FuY2VsbGVkID0gdHJ1ZTsNCiAgICAgICAgDQogICAgICAgIC8vIE1hcmsgdGhlIGFjdGl2ZSB1bml0IGFzIGNhbmNlbGxlZA0KICAgICAgICBpZiAoIXN0YXJ0VW5pdENhbmNlbGxlZCkgew0KICAgICAgICAgIGNhbmNlbGxhdGlvbnNbJ3N0YXJ0J10gPSB7IHVuaXQ6IHRydWUgfTsNCiAgICAgICAgICBzdGFydFVuaXRDYW5jZWxsZWQgPSB0cnVlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIC8vIEZpbmQgdGhlIHByZXZpb3VzIGZhY3RvciB0aGF0IHByb3ZpZGVkIHRoaXMgdW5pdA0KICAgICAgICAgIGNvbnN0IHByZXZGYWN0b3IgPSBvcmRlcmVkRmFjdG9ycy5maW5kKChmLCBpKSA9PiBpIDwgb3JkZXJlZEZhY3RvcnMuaW5kZXhPZihmYWN0b3IpICYmIGYubnVtLnNwbGl0KCcgJylbMV0gPT09IGFjdGl2ZVVuaXQpOw0KICAgICAgICAgIGlmIChwcmV2RmFjdG9yKSB7DQogICAgICAgICAgICBjYW5jZWxsYXRpb25zW3ByZXZGYWN0b3IuaWRdID0geyAuLi5jYW5jZWxsYXRpb25zW3ByZXZGYWN0b3IuaWRdLCBudW06IHRydWUgfTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIFRoZSBuZXcgYWN0aXZlIHVuaXQgaXMgdGhpcyBmYWN0b3IncyBudW1lcmF0b3INCiAgICAgICAgYWN0aXZlVW5pdCA9IG51bVVuaXQ7DQogICAgICB9DQogICAgICANCiAgICAgIGNhbmNlbGxhdGlvbnNbZmFjdG9yLmlkXSA9IHsgLi4uY2FuY2VsbGF0aW9uc1tmYWN0b3IuaWRdLCBkZW46IGRlbkNhbmNlbGxlZCB9Ow0KICAgIH0NCiAgICANCiAgICBzZXRMaXZlQ2FuY2VsbGF0aW9uKGNhbmNlbGxhdGlvbnMpOw0KICAgIHJldHVybiBhY3RpdmVVbml0OyAvLyBSZXR1cm4gdGhlIG5ldyBhY3RpdmUgdW5pdCBmb3IgaGludCBsb2dpYw0KICB9Ow0KDQogIGNvbnN0IGhhbmRsZUZhY3RvckNsaWNrID0gKGZhY3RvcikgPT4gew0KICAgIGlmIChzaG93U29sdXRpb24pIHJldHVybjsNCiAgICANCiAgICBjb25zdCBpc1NlbGVjdGVkID0gc2VsZWN0ZWRGYWN0b3JzLnNvbWUoZiA9PiBmLmlkID09PSBmYWN0b3IuaWQpOw0KICAgIGxldCBuZXdTZWxlY3RlZEZhY3RvcnM7DQogICAgaWYgKGlzU2VsZWN0ZWQpIHsNCiAgICAgIG5ld1NlbGVjdGVkRmFjdG9ycyA9IHNlbGVjdGVkRmFjdG9ycy5maWx0ZXIoZiA9PiBmLmlkICE9PSBmYWN0b3IuaWQpOw0KICAgIH0gZWxzZSB7DQogICAgICBuZXdTZWxlY3RlZEZhY3RvcnMgPSBbLi4uc2VsZWN0ZWRGYWN0b3JzLCBmYWN0b3JdOw0KICAgIH0NCiAgICANCiAgICBzZXRTZWxlY3RlZEZhY3RvcnMobmV3U2VsZWN0ZWRGYWN0b3JzKTsNCiAgICBjb25zdCBuZXdBY3RpdmVVbml0ID0gdXBkYXRlTGl2ZUNhbmNlbGxhdGlvbihuZXdTZWxlY3RlZEZhY3RvcnMpOyAvLyBVcGRhdGUgbGl2ZSBjYW5jZWxsYXRpb24NCg0KICAgIC8vIC0tLSBIaW50IExvZ2ljIC0tLQ0KICAgIGNvbnN0IHN0YXJ0VW5pdCA9IGN1cnJlbnRQcm9ibGVtLnN0YXJ0LnVuaXQ7DQogICAgY29uc3QgdGFyZ2V0VW5pdCA9IGN1cnJlbnRQcm9ibGVtLnRhcmdldDsNCiAgICANCiAgICBpZiAobmV3U2VsZWN0ZWRGYWN0b3JzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgc2V0SGludChudWxsKTsNCiAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgLy8gR2V0IHRoZSBsYXN0IHNlbGVjdGVkIGZhY3RvciBhbmQgaXRzIHVuaXRzDQogICAgY29uc3QgbGFzdEZhY3RvciA9IG5ld1NlbGVjdGVkRmFjdG9yc1tuZXdTZWxlY3RlZEZhY3RvcnMubGVuZ3RoIC0gMV07DQogICAgY29uc3QgW2xhc3ROdW1WYWwsIGxhc3ROdW1Vbml0XSA9IGxhc3RGYWN0b3IubnVtLnNwbGl0KCcgJyk7DQogICAgY29uc3QgW2xhc3REZW5WYWwsIGxhc3REZW5Vbml0XSA9IGxhc3RGYWN0b3IuZGVuLnNwbGl0KCcgJyk7DQogICAgDQogICAgLy8gR2V0IHRoZSBhY3RpdmUgdW5pdCAqYmVmb3JlKiB0aGlzIGxhc3QgY2xpY2sNCiAgICBsZXQgYWN0aXZlVW5pdCA9IHN0YXJ0VW5pdDsNCiAgICBsZXQgc3RhcnRDYW5jZWxsZWQgPSBmYWxzZTsNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5ld1NlbGVjdGVkRmFjdG9ycy5sZW5ndGggLSAxOyBpKyspIHsNCiAgICAgICAgY29uc3QgZiA9IG5ld1NlbGVjdGVkRmFjdG9yc1tpXTsNCiAgICAgICAgY29uc3QgW251bVUsIGRlblVdID0gW2YubnVtLnNwbGl0KCcgJylbMV0sIGYuZGVuLnNwbGl0KCcgJylbMV1dOw0KICAgICAgICBpZiAoZGVuVSA9PT0gYWN0aXZlVW5pdCkgew0KICAgICAgICAgICAgaWYgKCFzdGFydENhbmNlbGxlZCkgew0KICAgICAgICAgICAgICAgIHN0YXJ0Q2FuY2VsbGVkID0gdHJ1ZTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gVGhpcyBsb2dpYyBmaW5kcyB0aGUgKnByZXZpb3VzKiBmYWN0b3IgdGhhdCBnYXZlIHVzIHRoZSBhY3RpdmUgdW5pdA0KICAgICAgICAgICAgICAgIGNvbnN0IHBGYWN0b3JzID0gbmV3U2VsZWN0ZWRGYWN0b3JzLnNsaWNlKDAsIGkpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHBGYWN0b3IgPSBwRmFjdG9ycy5yZXZlcnNlKCkuZmluZChwZiA9PiBwZi5udW0uc3BsaXQoJyAnKVsxXSA9PT0gYWN0aXZlVW5pdCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBhY3RpdmVVbml0ID0gbnVtVTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8vIE5vdyBjaGVjayB0aGUgbGFzdCBmYWN0b3INCiAgICBpZiAobGFzdERlblVuaXQgPT09IGFjdGl2ZVVuaXQpIHsNCiAgICAgIC8vIENvcnJlY3QgY2FuY2VsbGF0aW9uDQogICAgICBpZiAobmV3QWN0aXZlVW5pdCA9PT0gdGFyZ2V0VW5pdCkgew0KICAgICAgICBzZXRIaW50KHsgdHlwZTogJ2dvb2QnLCBtZXNzYWdlOiBgUGVyZmVjdCEgWW91J3ZlIGNhbmNlbGxlZCAiJHthY3RpdmVVbml0fSIgYW5kIGFyZSBsZWZ0IHdpdGggIiR7bmV3QWN0aXZlVW5pdH0iLCB3aGljaCBpcyB5b3VyIHRhcmdldCB1bml0IWAgfSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBzZXRIaW50KHsgdHlwZTogJ2dvb2QnLCBtZXNzYWdlOiBgR29vZCEgWW91J3ZlIGNhbmNlbGxlZCAiJHthY3RpdmVVbml0fSIuIE5vdyB5b3UgbmVlZCB0byBjYW5jZWwgIiR7bmV3QWN0aXZlVW5pdH0iLmAgfSk7DQogICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgIC8vIEluY29ycmVjdCBjYW5jZWxsYXRpb24NCiAgICAgIGlmIChhY3RpdmVVbml0ID09PSB0YXJnZXRVbml0KSB7DQogICAgICAgICBzZXRIaW50KHsgdHlwZTogJ3dhcm4nLCBtZXNzYWdlOiBgV2hvb3BzISBZb3UgYWxyZWFkeSByZWFjaGVkIHlvdXIgdGFyZ2V0IHVuaXQgIiR7dGFyZ2V0VW5pdH0iLiBZb3UgZG9uJ3QgbmVlZCBhbnkgbW9yZSBmYWN0b3JzLmAgfSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICAgc2V0SGludCh7IHR5cGU6ICd3YXJuJywgbWVzc2FnZTogYE5vdCB0aGlzIG9uZS4gVG8gY2FuY2VsICIke2FjdGl2ZVVuaXR9IiwgeW91IG5lZWQgYSBmYWN0b3Igd2l0aCAiJHthY3RpdmVVbml0fSIgb24gdGhlIGJvdHRvbSAoZGVub21pbmF0b3IpLmAgfSk7DQogICAgICB9DQogICAgfQ0KICB9Ow0KDQogIGNvbnN0IGNoZWNrQW5zd2VyID0gKCkgPT4gew0KICAgIHNldFNob3dTb2x1dGlvbih0cnVlKTsNCiAgICBzZXRIaW50KG51bGwpOyAvLyBDbGVhciBoaW50cyB3aGVuIGNoZWNraW5nDQogIH07DQoNCiAgY29uc3QgcmVzZXQgPSAoKSA9PiB7DQogICAgc2V0U2VsZWN0ZWRGYWN0b3JzKFtdKTsNCiAgICBzZXRTaG93U29sdXRpb24oZmFsc2UpOw0KICAgIHNldEhpbnQobnVsbCk7IC8vIENsZWFyIGhpbnRzIG9uIHJlc2V0DQogICAgc2V0TGl2ZUNhbmNlbGxhdGlvbih7fSk7IC8vIENsZWFyIGxpdmUgY2FuY2VsbGF0aW9uDQogIH07DQoNCiAgY29uc3QgbmV4dExldmVsID0gKCkgPT4gew0KICAgIGlmIChjdXJyZW50TGV2ZWwgPCBPYmplY3Qua2V5cyhsZXZlbHMpLmxlbmd0aCkgew0KICAgICAgc2V0Q3VycmVudExldmVsKGN1cnJlbnRMZXZlbCArIDEpOw0KICAgICAgcmVzZXQoKTsNCiAgICB9DQogIH07DQogIA0KICBjb25zdCBwcmV2TGV2ZWwgPSAoKSA9PiB7DQogICAgaWYgKGN1cnJlbnRMZXZlbCA+IDEpIHsNCiAgICAgIHNldEN1cnJlbnRMZXZlbChjdXJyZW50TGV2ZWwgLSAxKTsNCiAgICAgIHJlc2V0KCk7DQogICAgfQ0KICB9Ow0KICANCiAgLy8gQ2hlY2sgaWYgdGhlIHNlbGVjdGVkIGZhY3RvcnMgYXJlIGNvcnJlY3QNCiAgbGV0IGlzQ29ycmVjdCA9IGZhbHNlOw0KICBpZiAoc2hvd1NvbHV0aW9uKSB7DQogICAgY29uc3Qgc2VsZWN0ZWRJZHMgPSBzZWxlY3RlZEZhY3RvcnMubWFwKGYgPT4gZi5pZCkuc29ydCgpOw0KICAgIGNvbnN0IHNvbHV0aW9uSWRzID0gY3VycmVudFByb2JsZW0uc29sdXRpb24uc29ydCgpOw0KICAgIGlzQ29ycmVjdCA9IEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkSWRzKSA9PT0gSlNPTi5zdHJpbmdpZnkoc29sdXRpb25JZHMpOw0KICB9DQoNCiAgLy8gRGV0ZXJtaW5lIGZpbmFsIHNvbHV0aW9uIGNhbmNlbGxhdGlvbiAod2hlbiBzaG93U29sdXRpb24gaXMgdHJ1ZSBhbmQgaXNDb3JyZWN0KQ0KICBjb25zdCBmaW5hbENhbmNlbGxhdGlvbnMgPSB1c2VNZW1vKCgpID0+IHsNCiAgICAvLyBVc2UgbGl2ZUNhbmNlbGxhdGlvbiBpZiB3ZSdyZSBub3Qgc2hvd2luZyB0aGUgc29sdXRpb24geWV0DQogICAgaWYgKCFzaG93U29sdXRpb24pIHJldHVybiBsaXZlQ2FuY2VsbGF0aW9uOw0KICAgIC8vIElmIHNob3dpbmcgc29sdXRpb24gYnV0IGl0J3Mgd3JvbmcsICpzdGlsbCogdXNlIGxpdmVDYW5jZWxsYXRpb24NCiAgICBpZiAoc2hvd1NvbHV0aW9uICYmICFpc0NvcnJlY3QpIHJldHVybiBsaXZlQ2FuY2VsbGF0aW9uOw0KICAgIA0KICAgIC8vIElmIHNvbHV0aW9uIGlzIHNob3duIEFORCBjb3JyZWN0LCBjYWxjdWxhdGUgdGhlIGRlZmluaXRpdmUgY2FuY2VsbGF0aW9uDQogICAgbGV0IGFjdGl2ZVVuaXQgPSBjdXJyZW50UHJvYmxlbS5zdGFydC51bml0Ow0KICAgIGNvbnN0IGNhbmNlbGxhdGlvbnMgPSB7fTsNCiAgICBsZXQgc3RhcnRVbml0Q2FuY2VsbGVkID0gZmFsc2U7DQoNCiAgICAvLyBTb3J0IHNlbGVjdGVkIGZhY3RvcnMgYnkgdGhlIGludGVuZGVkIG9yZGVyIGZvciBtdWx0aS1zdGVwIHByb2JsZW1zDQogICAgY29uc3Qgb3JkZXJlZEZhY3RvcnMgPSBbLi4uc2VsZWN0ZWRGYWN0b3JzXS5zb3J0KChhLCBiKSA9PiAoYS5vcmRlciB8fCAwKSAtIChiLm9yZGVyIHx8IDApKTsNCg0KICAgIGZvciAoY29uc3QgZmFjdG9yIG9mIG9yZGVyZWRGYWN0b3JzKSB7DQogICAgICBjb25zdCBbbnVtVmFsLCBudW1Vbml0XSA9IGZhY3Rvci5udW0uc3BsaXQoJyAnKTsNCiAgICAgIGNvbnN0IFtkZW5WYWwsIGRlblVuaXRdID0gZmFjdG9yLmRlbi5zcGxpdCgnICcpOw0KICAgICAgDQogICAgICBsZXQgZGVuQ2FuY2VsbGVkID0gZmFsc2U7DQogICAgICANCiAgICAgIGlmIChkZW5Vbml0ID09PSBhY3RpdmVVbml0KSB7DQogICAgICAgIGRlbkNhbmNlbGxlZCA9IHRydWU7DQogICAgICAgIGlmICghc3RhcnRVbml0Q2FuY2VsbGVkKSB7DQogICAgICAgICAgY2FuY2VsbGF0aW9uc1snc3RhcnQnXSA9IHsgdW5pdDogdHJ1ZSB9Ow0KICAgICAgICAgIHN0YXJ0VW5pdENhbmNlbGxlZCA9IHRydWU7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgLy8gRmluZCB0aGUgcHJldmlvdXMgZmFjdG9yIHRoYXQgcHJvdmlkZWQgdGhpcyB1bml0DQogICAgICAgICAgY29uc3QgcHJldkZhY3RvciA9IG9yZGVyZWRGYWN0b3JzLmZpbmQoZiA9PiBmLm51bS5zcGxpdCgnICcpWzFdID09PSBhY3RpdmVVbml0KTsNCiAgICAgICAgICBpZiAocHJldkZhY3Rvcikgew0KICAgICAgICAgICAgY2FuY2VsbGF0aW9uc1twcmV2RmFjdG9yLmlkXSA9IHsgLi4uY2FuY2VsbGF0aW9uc1twcmV2RmFjdG9yLmlkXSwgbnVtOiB0cnVlIH07DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGFjdGl2ZVVuaXQgPSBudW1Vbml0Ow0KICAgICAgfQ0KICAgICAgY2FuY2VsbGF0aW9uc1tmYWN0b3IuaWRdID0geyAuLi5jYW5jZWxsYXRpb25zW2ZhY3Rvci5pZF0sIGRlbjogZGVuQ2FuY2VsbGVkIH07DQogICAgfQ0KICAgIHJldHVybiBjYW5jZWxsYXRpb25zOw0KICB9LCBbc2hvd1NvbHV0aW9uLCBpc0NvcnJlY3QsIHNlbGVjdGVkRmFjdG9ycywgY3VycmVudFByb2JsZW0sIGxpdmVDYW5jZWxsYXRpb25dKTsNCg0KDQogIHJldHVybiAoDQogICAgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2Jywge19fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMTAzfX0KICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdoMicsIHsgY2xhc3NOYW1lOiAidGV4dC0yeGwgZm9udC1ib2xkIG1iLTQgdGV4dC1ibHVlLTQwMCIgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMTA0fX0sICJVbml0IENhbmNlbGxhdGlvbiIgKQogICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3AnLCB7IGNsYXNzTmFtZTogInRleHQtZ3JheS0zMDAgbWItNiIgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTEwNX19LCAiTGVhcm4gaG93IHRvIHVzZSBmcmFjdGlvbnMgdG8gY2FuY2VsIHVuaXRzIGFuZCBjb252ZXJ0IG1lYXN1cmVtZW50cyBzdGVwIGJ5IHN0ZXAuIiAgICAgICAgICAgICApCgogICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAiYmctZ3JheS03MDAgcm91bmRlZC1sZyBwLTYgbWItNiIgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMTA3fX0KICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAiZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtY2VudGVyIG1iLTQiICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTEwOH19CiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2gzJywgeyBjbGFzc05hbWU6ICJ0ZXh0LXhsIGZvbnQtYm9sZCB0ZXh0LXB1cnBsZS0zMDAiICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMTA5fX0sIGN1cnJlbnRQcm9ibGVtLnRpdGxlKQogICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImZsZXggZ2FwLTIiICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDExMTB9fQogICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicsIHsNCiAgICAgICAgICAgICAgb25DbGljazogcHJldkxldmVsLA0KICAgICAgICAgICAgICBkaXNhYmxlZDogY3VycmVudExldmVsID09PSAxLA0KICAgICAgICAgICAgICBjbGFzc05hbWU6ICJwLTIgYmctYmx1ZS02MDAgcm91bmRlZC1mdWxsIGRpc2FibGVkOm9wYWNpdHktMzAgaG92ZXI6YmctYmx1ZS01MDAgdHJhbnNpdGlvbi1hbGwiICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMTExfX0NCgogICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudChDaGV2cm9uTGVmdCwgeyBzaXplOiAyMCwgY2xhc3NOYW1lOiAidGV4dC13aGl0ZSIsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMTE2fX0gKQogICAgICAgICAgICApCiAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnYnV0dG9uJywgew0KICAgICAgICAgICAgICBvbkNsaWNrOiBuZXh0TGV2ZWwsDQogICAgICAgICAgICAgIGRpc2FibGVkOiBjdXJyZW50TGV2ZWwgPT09IE9iamVjdC5rZXlzKGxldmVscykubGVuZ3RoLA0KICAgICAgICAgICAgICBjbGFzc05hbWU6ICJwLTIgYmctYmx1ZS02MDAgcm91bmRlZC1mdWxsIGRpc2FibGVkOm9wYWNpdHktMzAgaG92ZXI6YmctYmx1ZS01MDAgdHJhbnNpdGlvbi1hbGwiICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMTE4fX0NCgogICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudChDaGV2cm9uUmlnaHQsIHsgc2l6ZTogMjAsIGNsYXNzTmFtZTogInRleHQtd2hpdGUiLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTEyM319ICkKICAgICAgICAgICAgKQogICAgICAgICAgKQogICAgICAgICkKICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3AnLCB7IGNsYXNzTmFtZTogInRleHQtbGcgdGV4dC1ncmF5LTIwMCBtYi02IiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTEyN319CiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7IGNsYXNzTmFtZTogImZvbnQtc2VtaWJvbGQiLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTEyOH19LCAiUHJvYmxlbToiKSwgIiBDb252ZXJ0ICIgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3BhbicsIHsgY2xhc3NOYW1lOiAiZm9udC1ib2xkIHRleHQtYmx1ZS00MDAiICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDExMjh9fSwgY3VycmVudFByb2JsZW0ucHJvYmxlbSkKICAgICAgICApCgogICAgICAgIC8qIEVxdWF0aW9uIEJ1aWxkZXIgKi8KICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAiZmxleCBmbGV4LXdyYXAgaXRlbXMtY2VudGVyIGJnLWdyYXktODAwIHAtNCByb3VuZGVkLWxnIG1pbi1oLVsxMDBweF0gb3ZlcmZsb3cteC1hdXRvIiAgICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMTMyfX0KICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJpbmxpbmUtZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIgdGV4dC1sZyBtZDp0ZXh0LXhsIG14LTEgZm9udC1tb25vIiAgICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDExMzN9fQogICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7IGNsYXNzTmFtZTogInB4LTIiLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTEzNH19CiAgICAgICAgICAgICAgLCBjdXJyZW50UHJvYmxlbS5zdGFydC52YWx1ZSwgJyAnCiAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6IGAke19vcHRpb25hbENoYWluKFtmaW5hbENhbmNlbGxhdGlvbnMsICdhY2Nlc3MnLCBfOCA9PiBfOFsnc3RhcnQnXSwgJ29wdGlvbmFsQWNjZXNzJywgXzkgPT4gXzkudW5pdF0pID8gJ2xpbmUtdGhyb3VnaCB0ZXh0LXJlZC00MDAnIDogJyd9YCwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDExMzZ9fQogICAgICAgICAgICAgICAgLCBjdXJyZW50UHJvYmxlbS5zdGFydC51bml0CiAgICAgICAgICAgICAgKQogICAgICAgICAgICApCiAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3BhbicsIHsgY2xhc3NOYW1lOiAiYm9yZGVyLXQtMiBib3JkZXItZ3JheS00MDAgdy1mdWxsIG15LTEiICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTE0MH19KQogICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7IGNsYXNzTmFtZTogInB4LTIiLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTE0MX19LCAiMSIpCiAgICAgICAgICApCgogICAgICAgICAgLCBzZWxlY3RlZEZhY3RvcnMubGVuZ3RoID4gMCAmJiBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICJ0ZXh0LTJ4bCBteC0yIGZvbnQtbW9ubyIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDExNDR9fSwgIsOXIikKCiAgICAgICAgICAsIHNlbGVjdGVkRmFjdG9ycy5tYXAoKGZhY3RvciwgaW5kZXgpID0+ICgNCiAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFJlYWN0LkZyYWdtZW50LCB7IGtleTogZmFjdG9yLmlkLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTE0N319CiAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KEZyYWN0aW9uLCB7IA0KICAgICAgICAgICAgICAgIG51bTogZmFjdG9yLm51bSwgDQogICAgICAgICAgICAgICAgZGVuOiBmYWN0b3IuZGVuLCANCiAgICAgICAgICAgICAgICBudW1DYW5jZWxsZWQ6IF9vcHRpb25hbENoYWluKFtmaW5hbENhbmNlbGxhdGlvbnMsICdhY2Nlc3MnLCBfMTAgPT4gXzEwW2ZhY3Rvci5pZF0sICdvcHRpb25hbEFjY2VzcycsIF8xMSA9PiBfMTEubnVtXSksDQogICAgICAgICAgICAgICAgZGVuQ2FuY2VsbGVkOiBfb3B0aW9uYWxDaGFpbihbZmluYWxDYW5jZWxsYXRpb25zLCAnYWNjZXNzJywgXzEyID0+IF8xMltmYWN0b3IuaWRdLCAnb3B0aW9uYWxBY2Nlc3MnLCBfMTMgPT4gXzEzLmRlbl0pLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTE0OH19DQogICAgICAgICAgICAgICkKICAgICAgICAgICAgICAsIGluZGV4IDwgc2VsZWN0ZWRGYWN0b3JzLmxlbmd0aCAtIDEgJiYgUmVhY3QuY3JlYXRlRWxlbWVudCgnc3BhbicsIHsgY2xhc3NOYW1lOiAidGV4dC0yeGwgbXgtMiBmb250LW1vbm8iICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMTU0fX0sICLDlyIpCiAgICAgICAgICAgICApDQogICAgICAgICAgICkpCgogICAgICAgICAgLCBzaG93U29sdXRpb24gJiYgaXNDb3JyZWN0ICYmICgNCiAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICJ0ZXh0LTJ4bCBteC0yIGZvbnQtbW9ubyIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDExNTl9fSwgIj0iKQ0KICAgICAgICAgICkKICAgICAgICAgICwgc2hvd1NvbHV0aW9uICYmIGlzQ29ycmVjdCAmJiAoDQogICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogInRleHQtMnhsIGZvbnQtYm9sZCB0ZXh0LWdyZWVuLTQwMCBtbC0yIiAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDExNjJ9fQogICAgICAgICAgICAgICwgY3VycmVudFByb2JsZW0uY2FsY3VsYXRpb24uc3BsaXQoJz0nKVsxXQogICAgICAgICAgICApDQogICAgICAgICAgKQogICAgICAgICkKCiAgICAgICAgLyogRmFjdG9yIEJhbmsgKi8KICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAibXktNiIsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMTY5fX0KICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnaDQnLCB7IGNsYXNzTmFtZTogImZvbnQtc2VtaWJvbGQgbWItMyB0ZXh0LWdyYXktMzAwIiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTE3MH19LCAiQ2hvb3NlIHlvdXIgY29udmVyc2lvbiBmYWN0b3Iocyk6IiAgICkKICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJmbGV4IGZsZXgtd3JhcCBnYXAtMyIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDExNzF9fQogICAgICAgICAgICAsIGN1cnJlbnRQcm9ibGVtLmZhY3RvcnMubWFwKGZhY3RvciA9PiB7DQogICAgICAgICAgICAgIGNvbnN0IGlzU2VsZWN0ZWQgPSBzZWxlY3RlZEZhY3RvcnMuc29tZShmID0+IGYuaWQgPT09IGZhY3Rvci5pZCk7DQogICAgICAgICAgICAgIHJldHVybiAoDQogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgnYnV0dG9uJywgew0KICAgICAgICAgICAgICAgICAga2V5OiBmYWN0b3IuaWQsDQogICAgICAgICAgICAgICAgICBvbkNsaWNrOiAoKSA9PiBoYW5kbGVGYWN0b3JDbGljayhmYWN0b3IpLA0KICAgICAgICAgICAgICAgICAgZGlzYWJsZWQ6IHNob3dTb2x1dGlvbiwNCiAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogYHRyYW5zaXRpb24tYWxsIHAtMiByb3VuZGVkLWxnICR7DQogICAgICAgICAgICAgICAgICAgIGlzU2VsZWN0ZWQNCiAgICAgICAgICAgICAgICAgICAgICA/ICdiZy1ibHVlLTYwMCB0ZXh0LXdoaXRlIHNoYWRvdy1sZycNCiAgICAgICAgICAgICAgICAgICAgICA6ICdiZy1ncmF5LTYwMCB0ZXh0LWdyYXktMjAwIGhvdmVyOmJnLWdyYXktNTAwJw0KICAgICAgICAgICAgICAgICAgfSAke3Nob3dTb2x1dGlvbiA/ICdvcGFjaXR5LTUwIGN1cnNvci1ub3QtYWxsb3dlZCcgOiAnY3Vyc29yLXBvaW50ZXInfWAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMTc1fX0NCgogICAgICAgICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoRnJhY3Rpb24sIHsgbnVtOiBmYWN0b3IubnVtLCBkZW46IGZhY3Rvci5kZW4sIG51bUNhbmNlbGxlZDogZmFsc2UsIGRlbkNhbmNlbGxlZDogZmFsc2UsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMTg1fX0gKQogICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgfSkKICAgICAgICAgICkKICAgICAgICApCgogICAgICAgIC8qIEhpbnQgQm94ICovCiAgICAgICAgLCBoaW50ICYmICFzaG93U29sdXRpb24gJiYgKA0KICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiBgbXktNCBwLTMgcm91bmRlZC1sZyBib3JkZXItMiAkew0KICAgICAgICAgICAgaGludC50eXBlID09PSAnZ29vZCcgPyAnYmctZ3JlZW4tOTAwLzUwIGJvcmRlci1ncmVlbi01MDAnIDoNCiAgICAgICAgICAgIGhpbnQudHlwZSA9PT0gJ3dhcm4nID8gJ2JnLW9yYW5nZS05MDAvNTAgYm9yZGVyLW9yYW5nZS01MDAnIDoNCiAgICAgICAgICAgICdiZy1yZWQtOTAwLzUwIGJvcmRlci1yZWQtNTAwJw0KICAgICAgICAgIH1gLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTE5NH19CiAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJmbGV4IGl0ZW1zLXN0YXJ0IGdhcC0yIiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTE5OX19CiAgICAgICAgICAgICAgLCBoaW50LnR5cGUgPT09ICdnb29kJyA/IFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ2hlY2ssIHsgc2l6ZTogMjAsIGNsYXNzTmFtZTogIm10LTAuNSBmbGV4LXNocmluay0wIHRleHQtZ3JlZW4tNDAwIiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTIwMH19ICkgOiBSZWFjdC5jcmVhdGVFbGVtZW50KExpZ2h0YnVsYiwgeyBzaXplOiAyMCwgY2xhc3NOYW1lOiAibXQtMC41IGZsZXgtc2hyaW5rLTAgdGV4dC15ZWxsb3ctNDAwIiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTIwMH19ICkKICAgICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3AnLCB7IGNsYXNzTmFtZTogYHRleHQtc20gJHsNCiAgICAgICAgICAgICAgICBoaW50LnR5cGUgPT09ICdnb29kJyA/ICd0ZXh0LWdyZWVuLTIwMCcgOg0KICAgICAgICAgICAgICAgIGhpbnQudHlwZSA9PT0gJ3dhcm4nID8gJ3RleHQtb3JhbmdlLTIwMCcgOg0KICAgICAgICAgICAgICAgICd0ZXh0LXJlZC0yMDAnDQogICAgICAgICAgICAgIH1gLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTIwMX19CiAgICAgICAgICAgICAgICAsIGhpbnQubWVzc2FnZQogICAgICAgICAgICAgICkKICAgICAgICAgICAgKQogICAgICAgICAgKQ0KICAgICAgICApCgogICAgICAgIC8qIENvbnRyb2xzICovCiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImZsZXggZmxleC13cmFwIGdhcC00IG10LTYiICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTIxM319CiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicsIHsNCiAgICAgICAgICAgIG9uQ2xpY2s6IGNoZWNrQW5zd2VyLA0KICAgICAgICAgICAgZGlzYWJsZWQ6IHNob3dTb2x1dGlvbiwNCiAgICAgICAgICAgIGNsYXNzTmFtZTogInB4LTYgcHktMyBiZy1ibHVlLTYwMCBob3ZlcjpiZy1ibHVlLTcwMCB0ZXh0LXdoaXRlIHJvdW5kZWQtbGcgZm9udC1zZW1pYm9sZCB0cmFuc2l0aW9uLWFsbCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiBkaXNhYmxlZDpvcGFjaXR5LTUwIiAgICAgICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTIxNH19DQoKICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KENoZWNrLCB7IHNpemU6IDIwLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTIxOX19ICksICIgQ2hlY2sgQW5zd2VyIgogICAgICAgICAgKQogICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdidXR0b24nLCB7DQogICAgICAgICAgICBvbkNsaWNrOiByZXNldCwNCiAgICAgICAgICAgIGNsYXNzTmFtZTogInB4LTYgcHktMyBiZy1ncmF5LTYwMCBob3ZlcjpiZy1ncmF5LTUwMCB0ZXh0LXdoaXRlIHJvdW5kZWQtbGcgZm9udC1zZW1pYm9sZCB0cmFuc2l0aW9uLWFsbCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiIgICAgICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTIyMX19DQoKICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KFJlZnJlc2hDdywgeyBzaXplOiAxOCwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEyMjV9fSApLCAiIFJlc2V0IgogICAgICAgICAgKQogICAgICAgICkKCiAgICAgICAgLyogU29sdXRpb24gRmVlZGJhY2sgKi8KICAgICAgICAsIHNob3dTb2x1dGlvbiAmJiAoDQogICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6IGBtdC02IHAtNCByb3VuZGVkLWxnIGJvcmRlci0yICR7DQogICAgICAgICAgICBpc0NvcnJlY3QgPyAnYmctZ3JlZW4tOTAwLzUwIGJvcmRlci1ncmVlbi01MDAnIDogJ2JnLXJlZC05MDAvNTAgYm9yZGVyLXJlZC01MDAnDQogICAgICAgICAgfWAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMjMxfX0KICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImZsZXggaXRlbXMtc3RhcnQgZ2FwLTMiICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMjM0fX0KICAgICAgICAgICAgICAsIGlzQ29ycmVjdCA/IFJlYWN0LmNyZWF0ZUVsZW1lbnQoVHJvcGh5LCB7IHNpemU6IDI0LCBjbGFzc05hbWU6ICJ0ZXh0LXllbGxvdy00MDAiLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTIzNX19ICkgOiBSZWFjdC5jcmVhdGVFbGVtZW50KFgsIHsgc2l6ZTogMjQsIGNsYXNzTmFtZTogInRleHQtcmVkLTQwMCIsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMjM1fX0gKQogICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2Jywge19fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMjM2fX0KICAgICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnaDQnLCB7IGNsYXNzTmFtZTogImZvbnQtYm9sZCB0ZXh0LWxnIG1iLTIiICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMjM3fX0KICAgICAgICAgICAgICAgICAgLCBpc0NvcnJlY3QgPyAnQ29ycmVjdCEnIDogJ05vdCBRdWl0ZSEnCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3AnLCB7IGNsYXNzTmFtZTogIm1iLTIiLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTI0MH19CiAgICAgICAgICAgICAgICAgICwgaXNDb3JyZWN0ID8gY3VycmVudFByb2JsZW0uZXhwbGFuYXRpb24gOiAnWW91ciBzZWxlY3RlZCBmYWN0b3JzIGRvblwndCBtYXRjaCB0aGUgc29sdXRpb24uIFRyeSBhZ2FpbiEnCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAsIGlzQ29ycmVjdCAmJiAoDQogICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImZvbnQtbW9ubyBiZy1ncmF5LTgwMCBwLTMgcm91bmRlZCBtdC0yIiAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMjQ0fX0sICJDYWxjdWxhdGlvbjogIgogICAgICAgICAgICAgICAgICAgICAsIGN1cnJlbnRQcm9ibGVtLmNhbGN1bGF0aW9uCiAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgKQogICAgICAgICAgICApCiAgICAgICAgICApDQogICAgICAgICkKICAgICAgKQogICAgKQ0KICApOw0KfTsNCg0KDQovLyBUYWIgNDogUHJhY3RpY2UNCmNvbnN0IFByYWN0aWNlVGFiID0gKCkgPT4gew0KICBjb25zdCBbcXVlc3Rpb25zLCBzZXRRdWVzdGlvbnNdID0gdXNlU3RhdGUoW10pOw0KICBjb25zdCBbY3VycmVudFF1ZXN0aW9uSW5kZXgsIHNldEN1cnJlbnRRdWVzdGlvbkluZGV4XSA9IHVzZVN0YXRlKDApOw0KICBjb25zdCBbdXNlckFuc3dlcnMsIHNldFVzZXJBbnN3ZXJzXSA9IHVzZVN0YXRlKHt9KTsNCiAgY29uc3QgW3Nob3dGZWVkYmFjaywgc2V0U2hvd0ZlZWRiYWNrXSA9IHVzZVN0YXRlKGZhbHNlKTsNCiAgY29uc3QgW3VzZWRRdWVzdGlvbklkcywgc2V0VXNlZFF1ZXN0aW9uSWRzXSA9IHVzZVN0YXRlKFtdKTsNCiAgY29uc3QgW3Njb3JlLCBzZXRTY29yZV0gPSB1c2VTdGF0ZSgwKTsNCg0KICBjb25zdCBhbGxRdWVzdGlvbnMgPSB1c2VNZW1vKCgpID0+IFsNCiAgICB7IGlkOiAxLCBxOiAnQ29udmVydCA1LjUgbWV0ZXJzIHRvIGNlbnRpbWV0ZXJzLicsIGE6IDU1MCwgdW5pdDogJ2NtJywgdHlwZTogJ3NpbXBsZScgfSwNCiAgICB7IGlkOiAyLCBxOiAnQ29udmVydCAyLjUga2lsb21ldGVycyB0byBtZXRlcnMuJywgYTogMjUwMCwgdW5pdDogJ20nLCB0eXBlOiAnc2ltcGxlJyB9LA0KICAgIHsgaWQ6IDMsIHE6ICdDb252ZXJ0IDE1MDAgZ3JhbXMgdG8ga2lsb2dyYW1zLicsIGE6IDEuNSwgdW5pdDogJ2tnJywgdHlwZTogJ3NpbXBsZScgfSwNCiAgICB7IGlkOiA0LCBxOiAnQ29udmVydCA3NTAgbWlsbGlncmFtcyB0byBncmFtcy4nLCBhOiAwLjc1LCB1bml0OiAnZycsIHR5cGU6ICdzaW1wbGUnIH0sDQogICAgeyBpZDogNSwgcTogJ0NvbnZlcnQgMy4yIGxpdGVycyB0byBtaWxsaWxpdGVycy4nLCBhOiAzMjAwLCB1bml0OiAnbUwnLCB0eXBlOiAnc2ltcGxlJyB9LA0KICAgIHsgaWQ6IDYsIHE6ICdDb252ZXJ0IDQ1IHNlY29uZHMgdG8gbWludXRlcy4nLCBhOiAwLjc1LCB1bml0OiAnbWluJywgdHlwZTogJ3NpbXBsZScgfSwNCiAgICB7IGlkOiA3LCBxOiAnQ29udmVydCAyLjUgaG91cnMgdG8gbWludXRlcy4nLCBhOiAxNTAsIHVuaXQ6ICdtaW4nLCB0eXBlOiAnc2ltcGxlJyB9LA0KICAgIHsgaWQ6IDgsIHE6ICdIb3cgbWFueSBpbmNoZXMgYXJlIGluIDUwLjggY20/ICgxIGluY2ggPSAyLjU0IGNtKScsIGE6IDIwLCB1bml0OiAnaW4nLCB0eXBlOiAnbWl4ZWQnIH0sDQogICAgeyBpZDogOSwgcTogJ0hvdyBtYW55IGtpbG9ncmFtcyBpcyAxNjUgbGJzPyAoMSBrZyDiiYggMi4yIGxicyknLCBhOiA3NSwgdW5pdDogJ2tnJywgdHlwZTogJ21peGVkJyB9LA0KICAgIHsgaWQ6IDEwLCBxOiAnSG93IG1hbnkgbWV0ZXJzIGFyZSBpbiAxLjIgbWlsZXM/ICgxIG1pbGUg4omIIDEuNjA5IGttKScsIGE6IDE5MzAuOCwgdW5pdDogJ20nLCB0eXBlOiAnY2hhbGxlbmdlJyB9LA0KICAgIHsgaWQ6IDExLCBxOiAnQ29udmVydCAyIGRheXMgaW50byBzZWNvbmRzLicsIGE6IDE3MjgwMCwgdW5pdDogJ3MnLCB0eXBlOiAnY2hhbGxlbmdlJyB9LA0KICAgIHsgaWQ6IDEyLCBxOiAnQ29udmVydCAwLjUga2cgdG8gbWlsbGlncmFtcy4nLCBhOiA1MDAwMDAsIHVuaXQ6ICdtZycsIHR5cGU6ICdjaGFsbGVuZ2UnIH0sDQogICAgeyBpZDogMTMsIHE6ICdIb3cgbWFueSBVUyBnYWxsb25zIGlzIDIwIGxpdGVycz8gKDEgZ2FsIOKJiCAzLjc4NSBMKScsIGE6IDUuMjgsIHVuaXQ6ICdnYWwnLCB0eXBlOiAnbWl4ZWQnIH0sDQogIF0sIFtdKTsNCg0KICBjb25zdCBnZW5lcmF0ZVF1ZXN0aW9ucyA9IHVzZUNhbGxiYWNrKCgpID0+IHsNCiAgICBsZXQgYXZhaWxhYmxlID0gYWxsUXVlc3Rpb25zLmZpbHRlcihxID0+ICF1c2VkUXVlc3Rpb25JZHMuaW5jbHVkZXMocS5pZCkpOw0KICAgIGlmIChhdmFpbGFibGUubGVuZ3RoIDwgNSkgew0KICAgICAgc2V0VXNlZFF1ZXN0aW9uSWRzKFtdKTsNCiAgICAgIGF2YWlsYWJsZSA9IGFsbFF1ZXN0aW9uczsNCiAgICB9DQogICAgDQogICAgY29uc3Qgc2h1ZmZsZWQgPSBbLi4uYXZhaWxhYmxlXS5zb3J0KCgpID0+IDAuNSAtIE1hdGgucmFuZG9tKCkpOw0KICAgIGNvbnN0IHNlbGVjdGVkID0gc2h1ZmZsZWQuc2xpY2UoMCwgNSk7DQogICAgDQogICAgc2V0UXVlc3Rpb25zKHNlbGVjdGVkKTsNCiAgICBzZXRVc2VkUXVlc3Rpb25JZHMocHJldiA9PiBbLi4ucHJldiwgLi4uc2VsZWN0ZWQubWFwKHEgPT4gcS5pZCldKTsNCiAgICBzZXRDdXJyZW50UXVlc3Rpb25JbmRleCgwKTsNCiAgICBzZXRVc2VyQW5zd2Vycyh7fSk7DQogICAgc2V0U2hvd0ZlZWRiYWNrKGZhbHNlKTsNCiAgICBzZXRTY29yZSgwKTsNCiAgfSwgW2FsbFF1ZXN0aW9ucywgdXNlZFF1ZXN0aW9uSWRzXSk7DQoNCiAgdXNlRWZmZWN0KCgpID0+IHsNCiAgICBpZiAocXVlc3Rpb25zLmxlbmd0aCA9PT0gMCkgew0KICAgICAgZ2VuZXJhdGVRdWVzdGlvbnMoKTsNCiAgICB9DQogIH0sIFtxdWVzdGlvbnMsIGdlbmVyYXRlUXVlc3Rpb25zXSk7DQoNCiAgY29uc3QgaGFuZGxlQW5zd2VyQ2hhbmdlID0gKGUpID0+IHsNCiAgICBzZXRVc2VyQW5zd2Vycyh7DQogICAgICAuLi51c2VyQW5zd2VycywNCiAgICAgIFtjdXJyZW50UXVlc3Rpb25JbmRleF06IGUudGFyZ2V0LnZhbHVlDQogICAgfSk7DQogIH07DQoNCiAgY29uc3QgY2hlY2tBbnN3ZXIgPSAoKSA9PiB7DQogICAgY29uc3QgdXNlckFuc3dlciA9IHBhcnNlRmxvYXQodXNlckFuc3dlcnNbY3VycmVudFF1ZXN0aW9uSW5kZXhdKTsNCiAgICBjb25zdCBjb3JyZWN0QW5zd2VyID0gcXVlc3Rpb25zW2N1cnJlbnRRdWVzdGlvbkluZGV4XS5hOw0KICAgIA0KICAgIC8vIENoZWNrIGZvciBmbG9hdGluZyBwb2ludCBpc3N1ZXMNCiAgICBjb25zdCBpc0NvcnJlY3QgPSBNYXRoLmFicyh1c2VyQW5zd2VyIC0gY29ycmVjdEFuc3dlcikgPCAwLjAxOw0KDQogICAgaWYgKGlzQ29ycmVjdCkgew0KICAgICAgc2V0U2NvcmUocyA9PiBzICsgMSk7DQogICAgfQ0KICAgIHNldFNob3dGZWVkYmFjayh0cnVlKTsNCiAgfTsNCg0KICBjb25zdCBuZXh0UXVlc3Rpb24gPSAoKSA9PiB7DQogICAgc2V0U2hvd0ZlZWRiYWNrKGZhbHNlKTsNCiAgICBzZXRDdXJyZW50UXVlc3Rpb25JbmRleChpID0+IGkgKyAxKTsNCiAgfTsNCg0KICBpZiAocXVlc3Rpb25zLmxlbmd0aCA9PT0gMCkgew0KICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7X19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEzMzN9fSwgIkxvYWRpbmcgcXVlc3Rpb25zLi4uIiApOw0KICB9DQoNCiAgY29uc3QgaXNRdWl6T3ZlciA9IGN1cnJlbnRRdWVzdGlvbkluZGV4ID49IHF1ZXN0aW9ucy5sZW5ndGg7DQogIA0KICBpZiAoaXNRdWl6T3Zlcikgew0KICAgIHJldHVybiAoDQogICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7X19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEzNDB9fQogICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnaDInLCB7IGNsYXNzTmFtZTogInRleHQtMnhsIGZvbnQtYm9sZCBtYi00IHRleHQtYmx1ZS00MDAiICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTM0MX19LCAiUHJhY3RpY2UgQ29tcGxldGUhIiApCiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImJnLWdyYXktNzAwIHJvdW5kZWQtbGcgcC04IHRleHQtY2VudGVyIiAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEzNDJ9fQogICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KFRyb3BoeSwgeyBzaXplOiA2NCwgY2xhc3NOYW1lOiAidGV4dC15ZWxsb3ctNDAwIG14LWF1dG8gbWItNiIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEzNDN9fSApCiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2gzJywgeyBjbGFzc05hbWU6ICJ0ZXh0LTN4bCBmb250LWJvbGQgbWItNCIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEzNDR9fSwgIllvdXIgU2NvcmU6ICIgICwgc2NvcmUsICIgLyAiICAsIHF1ZXN0aW9ucy5sZW5ndGgpCiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3AnLCB7IGNsYXNzTmFtZTogInRleHQtZ3JheS0zMDAgbWItOCIgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTM0NX19CiAgICAgICAgICAgICwgc2NvcmUgPT09IHF1ZXN0aW9ucy5sZW5ndGggPyAiQW1hemluZyB3b3JrISBZb3UncmUgYSB1bml0IGNvbnZlcnNpb24gbWFzdGVyISIgOiAiR3JlYXQgZWZmb3J0ISBLZWVwIHByYWN0aWNpbmcgdG8gaW1wcm92ZS4iCiAgICAgICAgICApCiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicsIHsNCiAgICAgICAgICAgIG9uQ2xpY2s6IGdlbmVyYXRlUXVlc3Rpb25zLA0KICAgICAgICAgICAgY2xhc3NOYW1lOiAicHgtNiBweS0zIGJnLWJsdWUtNjAwIGhvdmVyOmJnLWJsdWUtNzAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBmb250LXNlbWlib2xkIHRyYW5zaXRpb24tYWxsIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIG14LWF1dG8iICAgICAgICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMzQ4fX0NCgogICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoUmVmcmVzaEN3LCB7IHNpemU6IDIwLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTM1Mn19ICksICIgVHJ5IE5ldyBRdWVzdGlvbnMiCiAgICAgICAgICApCiAgICAgICAgKQogICAgICApDQogICAgKTsNCiAgfQ0KDQogIGNvbnN0IGN1cnJlbnRRdWVzdGlvbiA9IHF1ZXN0aW9uc1tjdXJyZW50UXVlc3Rpb25JbmRleF07DQogIGNvbnN0IHVzZXJBbnN3ZXIgPSB1c2VyQW5zd2Vyc1tjdXJyZW50UXVlc3Rpb25JbmRleF07DQoNCiAgbGV0IGlzQ29ycmVjdCA9IGZhbHNlOw0KICBpZiAoc2hvd0ZlZWRiYWNrKSB7DQogICAgY29uc3QgdXNlckFuc3dlck51bSA9IHBhcnNlRmxvYXQodXNlckFuc3dlcik7DQogICAgY29uc3QgY29ycmVjdEFuc3dlciA9IGN1cnJlbnRRdWVzdGlvbi5hOw0KICAgIGlzQ29ycmVjdCA9IE1hdGguYWJzKHVzZXJBbnN3ZXJOdW0gLSBjb3JyZWN0QW5zd2VyKSA8IDAuMDE7DQogIH0NCg0KICByZXR1cm4gKA0KICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTM3MH19CiAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnaDInLCB7IGNsYXNzTmFtZTogInRleHQtMnhsIGZvbnQtYm9sZCBtYi00IHRleHQtYmx1ZS00MDAiICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTM3MX19LCAiUHJhY3RpY2UgWm9uZSIgKQogICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3AnLCB7IGNsYXNzTmFtZTogInRleHQtZ3JheS0zMDAgbWItNiIgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTM3Mn19LCAiVGVzdCB5b3VyIGtub3dsZWRnZSEgRW50ZXIgdGhlIGNvcnJlY3QgbnVtYmVyIGZvciB0aGUgY29udmVyc2lvbi4iICAgICAgICAgKQoKICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImJnLWdyYXktNzAwIHJvdW5kZWQtbGcgcC04IiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTM3NH19CiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBtYi00IiAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEzNzV9fQogICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICJ0ZXh0LXNtIGZvbnQtc2VtaWJvbGQgdGV4dC1ncmF5LTQwMCIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEzNzZ9fSwgIlF1ZXN0aW9uICIgLCBjdXJyZW50UXVlc3Rpb25JbmRleCArIDEsICIgb2YgIiAgLCBxdWVzdGlvbnMubGVuZ3RoKQogICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6IGBweC0zIHB5LTEgcm91bmRlZC1mdWxsIHRleHQteHMgZm9udC1ib2xkICR7DQogICAgICAgICAgICBjdXJyZW50UXVlc3Rpb24udHlwZSA9PT0gJ3NpbXBsZScgPyAnYmctZ3JlZW4tODAwIHRleHQtZ3JlZW4tMjAwJyA6DQogICAgICAgICAgICBjdXJyZW50UXVlc3Rpb24udHlwZSA9PT0gJ21peGVkJyA/ICdiZy15ZWxsb3ctODAwIHRleHQteWVsbG93LTIwMCcgOg0KICAgICAgICAgICAgJ2JnLXJlZC04MDAgdGV4dC1yZWQtMjAwJw0KICAgICAgICAgIH1gLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTM3N319CiAgICAgICAgICAgICwgY3VycmVudFF1ZXN0aW9uLnR5cGUKICAgICAgICAgICkKICAgICAgICApCgogICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnaDMnLCB7IGNsYXNzTmFtZTogInRleHQteGwgZm9udC1zZW1pYm9sZCBtYi02IHRleHQtZ3JheS0yMDAiICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTM4Nn19LCBjdXJyZW50UXVlc3Rpb24ucSkKCiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImZsZXggZmxleC1jb2wgc206ZmxleC1yb3cgZ2FwLTIgaXRlbXMtY2VudGVyIiAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxMzg4fX0KICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnaW5wdXQnLCB7DQogICAgICAgICAgICB0eXBlOiAibnVtYmVyIiwNCiAgICAgICAgICAgIHN0ZXA6ICJhbnkiLA0KICAgICAgICAgICAgdmFsdWU6IHVzZXJBbnN3ZXIgfHwgJycsDQogICAgICAgICAgICBvbkNoYW5nZTogaGFuZGxlQW5zd2VyQ2hhbmdlLA0KICAgICAgICAgICAgZGlzYWJsZWQ6IHNob3dGZWVkYmFjaywNCiAgICAgICAgICAgIGNsYXNzTmFtZTogInByYWN0aWNlLWlucHV0IGZsZXgtZ3JvdyB3LWZ1bGwgc206dy1hdXRvIHB4LTQgcHktMyBiZy1ncmF5LTgwMCBib3JkZXItMiBib3JkZXItZ3JheS02MDAgcm91bmRlZC1sZyB0ZXh0LXdoaXRlIHRleHQtbGcgZm9jdXM6b3V0bGluZS1ub25lIGZvY3VzOmJvcmRlci1ibHVlLTUwMCBkaXNhYmxlZDpvcGFjaXR5LTUwIiAgICAgICAgICAgICAgLA0KICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICJUeXBlIHlvdXIgYW5zd2VyIiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTM4OX19DQogICAgICAgICAgKQogICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICJ0ZXh0LWxnIGZvbnQtc2VtaWJvbGQgdGV4dC1ncmF5LTMwMCIgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDEzOTh9fSwgY3VycmVudFF1ZXN0aW9uLnVuaXQpCiAgICAgICAgKQoKICAgICAgICAsIHNob3dGZWVkYmFjayAmJiAoDQogICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6IGBtdC02IHAtNCByb3VuZGVkLWxnIGJvcmRlci0yICR7DQogICAgICAgICAgICBpc0NvcnJlY3QgPyAnYmctZ3JlZW4tOTAwLzUwIGJvcmRlci1ncmVlbi01MDAnIDogJ2JnLXJlZC05MDAvNTAgYm9yZGVyLXJlZC01MDAnDQogICAgICAgICAgfWAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxNDAyfX0KICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogImZsZXggaXRlbXMtc3RhcnQgZ2FwLTMiICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxNDA1fX0KICAgICAgICAgICAgICAsIGlzQ29ycmVjdCA/IFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ2hlY2ssIHsgc2l6ZTogMjQsIGNsYXNzTmFtZTogInRleHQtZ3JlZW4tNDAwIiwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDE0MDZ9fSApIDogUmVhY3QuY3JlYXRlRWxlbWVudChYLCB7IHNpemU6IDI0LCBjbGFzc05hbWU6ICJ0ZXh0LXJlZC00MDAiLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTQwNn19ICkKICAgICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTQwN319CiAgICAgICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2g0JywgeyBjbGFzc05hbWU6ICJmb250LWJvbGQgdGV4dC1sZyBtYi0xIiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTQwOH19CiAgICAgICAgICAgICAgICAgICwgaXNDb3JyZWN0ID8gJ0NvcnJlY3QhJyA6ICdJbmNvcnJlY3QnCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3AnLCB7IGNsYXNzTmFtZTogInRleHQtYmFzZSIsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxNDExfX0sICJUaGUgY29ycmVjdCBhbnN3ZXIgaXMgIgogICAgICAgICAgICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzc05hbWU6ICJmb250LWJvbGQiLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTQxMn19LCBjdXJyZW50UXVlc3Rpb24uYSwgIiAiICwgY3VycmVudFF1ZXN0aW9uLnVuaXQpLCAiLiIKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICApCiAgICAgICAgICAgICkKICAgICAgICAgICkNCiAgICAgICAgKQoKICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAibXQtOCIsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxNDE5fX0KICAgICAgICAgICwgIXNob3dGZWVkYmFjayA/ICgNCiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicsIHsNCiAgICAgICAgICAgICAgb25DbGljazogY2hlY2tBbnN3ZXIsDQogICAgICAgICAgICAgIGRpc2FibGVkOiAhdXNlckFuc3dlciwNCiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAicHgtNiBweS0zIGJnLWJsdWUtNjAwIGhvdmVyOmJnLWJsdWUtNzAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBmb250LXNlbWlib2xkIHRyYW5zaXRpb24tYWxsIHctZnVsbCBzbTp3LWF1dG8gZGlzYWJsZWQ6b3BhY2l0eS01MCIgICAgICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTQyMX19DQosICJDaGVjayBBbnN3ZXIiCgogICAgICAgICAgICApDQogICAgICAgICAgKSA6ICgNCiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicsIHsNCiAgICAgICAgICAgICAgb25DbGljazogbmV4dFF1ZXN0aW9uLA0KICAgICAgICAgICAgICBjbGFzc05hbWU6ICJweC02IHB5LTMgYmctcHVycGxlLTYwMCBob3ZlcjpiZy1wdXJwbGUtNzAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBmb250LXNlbWlib2xkIHRyYW5zaXRpb24tYWxsIHctZnVsbCBzbTp3LWF1dG8iICAgICAgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTQyOX19DQosICJOZXh0IFF1ZXN0aW9uICIKICAgICAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudChDaGV2cm9uUmlnaHQsIHsgc2l6ZTogMjAsIGNsYXNzTmFtZTogImlubGluZSIsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxNDMzfX0gKQogICAgICAgICAgICApDQogICAgICAgICAgKQogICAgICAgICkKICAgICAgKQogICAgKQ0KICApOw0KfTsNCg0KDQovLyBNYWluIEFwcCBDb21wb25lbnQNCmNvbnN0IFVuaXRDb252ZXJzaW9uQXBwID0gKCkgPT4gew0KICBjb25zdCBbYWN0aXZlVGFiLCBzZXRBY3RpdmVUYWJdID0gdXNlU3RhdGUoMCk7DQogIC8vIFJlbW92ZWQgaXNEYXJrTW9kZSBzdGF0ZSBhbmQgcmVsYXRlZCB1c2VFZmZlY3RzL3RvZ2dsZSBmdW5jdGlvbg0KDQogIC8vIEZvcmNlIGRhcmsgbW9kZSBvbiBpbml0aWFsIGxvYWQNCiAgdXNlRWZmZWN0KCgpID0+IHsNCiAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnZGFyaycpOw0KICAgIC8vIENsZWFuIHVwIGZ1bmN0aW9uIHRvIHJlbW92ZSB0aGUgY2xhc3MgaWYgY29tcG9uZW50IHVubW91bnRzIChvcHRpb25hbCBidXQgZ29vZCBwcmFjdGljZSkNCiAgICByZXR1cm4gKCkgPT4gew0KICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdkYXJrJyk7DQogICAgfQ0KICB9LCBbXSk7IC8vIEVtcHR5IGRlcGVuZGVuY3kgYXJyYXkgZW5zdXJlcyB0aGlzIHJ1bnMgb25seSBvbmNlIG9uIG1vdW50DQoNCg0KICBjb25zdCB0YWJzID0gWydTY2FsZScsICdDb252ZXJzaW9ucycsICdDYW5jZWxsYXRpb24nLCAnUHJhY3RpY2UnXTsNCg0KICByZXR1cm4gKA0KICAgIC8vIEVuc3VyZSB0aGUgbWFpbiBjb250YWluZXIgYWx3YXlzIHVzZXMgZGFyayBtb2RlIHN0eWxlcw0KICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAibWluLWgtc2NyZWVuIGJnLWdyYXktOTAwIHRleHQtZ3JheS0xMDAgcC00IG1kOnAtNiIgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTQ2Mn19CiAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJtYXgtdy02eGwgbXgtYXV0byIgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTQ2M319CiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdoZWFkZXInLCB7IGNsYXNzTmFtZTogIm1iLTYgbWQ6bWItOCBmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIiICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDE0NjR9fQogICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7X19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDE0NjV9fQogICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2gxJywgeyBjbGFzc05hbWU6ICJ0ZXh0LTN4bCBtZDp0ZXh0LTR4bCBmb250LWJvbGQgbWItMSBiZy1ncmFkaWVudC10by1yIGZyb20tYmx1ZS01MDAgdG8tcHVycGxlLTUwMCBiZy1jbGlwLXRleHQgdGV4dC10cmFuc3BhcmVudCIgICAgICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDE0NjZ9fSwgIlVuaXQgQ29udmVyc2lvbiIKCiAgICAgICAgICAgICkKICAgICAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdwJywgeyBjbGFzc05hbWU6ICJ0ZXh0LXNtIG1kOnRleHQtYmFzZSB0ZXh0LWdyYXktNDAwIiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTQ2OX19LCAiTGVhcm4gbWVhc3VyZW1lbnQgYW5kIHVuaXQgY29udmVyc2lvbnMgc3RlcCBieSBzdGVwIiAgICAgICApCiAgICAgICAgICApCiAgICAgICAgICAvKiBSZW1vdmVkIERhcmsgTW9kZSBUb2dnbGUgQnV0dG9uICovCiAgICAgICAgKQoKICAgICAgICAvKiBUYWJzICovCiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCduYXYnLCB7IGNsYXNzTmFtZTogIm1iLTYgbWQ6bWItOCIgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTQ3NX19CiAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgY2xhc3NOYW1lOiAiZmxleCBmbGV4LXdyYXAgZ2FwLTIgcGItMiAtbWItMiIgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTQ3Nn19CiAgICAgICAgICAgICwgdGFicy5tYXAoKHRhYiwgaW5kZXgpID0+ICgNCiAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgnYnV0dG9uJywgew0KICAgICAgICAgICAgICAgIGtleTogaW5kZXgsDQogICAgICAgICAgICAgICAgb25DbGljazogKCkgPT4gc2V0QWN0aXZlVGFiKGluZGV4KSwNCiAgICAgICAgICAgICAgICAvLyBBZGp1c3RlZCBzdHlsZXMgdG8gYXNzdW1lIGRhcmsgbW9kZSBiYWNrZ3JvdW5kIChkYXJrOmJnLWdyYXktODAwIC0+IGJnLWdyYXktODAwLCBldGMuKQ0KICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogYHB4LTQgcHktMiBtZDpweC02IG1kOnB5LTMgcm91bmRlZC1sZyBmb250LXNlbWlib2xkIHdoaXRlc3BhY2Utbm93cmFwIHRyYW5zaXRpb24tYWxsIHRyYW5zZm9ybSBhY3RpdmU6c2NhbGUtOTUgJHsNCiAgICAgICAgICAgICAgICAgIGFjdGl2ZVRhYiA9PT0gaW5kZXgNCiAgICAgICAgICAgICAgICAgICAgPyAnYmctYmx1ZS02MDAgdGV4dC13aGl0ZSBzaGFkb3ctbGcgc2hhZG93LWJsdWUtNTAwLzUwJyAvLyBLZWVwIGFjdGl2ZSBzdHlsZSBjbGVhcg0KICAgICAgICAgICAgICAgICAgICA6ICdiZy1ncmF5LTgwMCB0ZXh0LWdyYXktNDAwIGhvdmVyOmJnLWdyYXktNzAwIGFjdGl2ZTpiZy1ncmF5LTYwMCcgLy8gVXNlIGRhcmsgbW9kZSBpbmFjdGl2ZSBzdHlsZXMgZGlyZWN0bHkNCiAgICAgICAgICAgICAgICB9YCwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDE0Nzh9fQ0KCiAgICAgICAgICAgICAgICAsIGluZGV4ICsgMSwgIi4gIiAsIHRhYgogICAgICAgICAgICAgICkNCiAgICAgICAgICAgICkpCiAgICAgICAgICApCiAgICAgICAgKQoKICAgICAgICAvKiBUYWIgQ29udGVudCAqLwogICAgICAgIC8qIEFkanVzdGVkIHN0eWxlcyB0byBhc3N1bWUgZGFyayBtb2RlIGJhY2tncm91bmQgKGRhcms6YmctZ3JheS04MDAgLT4gYmctZ3JheS04MDAsIGV0Yy4pICovCiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdtYWluJywgeyBjbGFzc05hbWU6ICJiZy1ncmF5LTgwMCByb3VuZGVkLXhsIHAtNiBtZDpwLTggc2hhZG93LTJ4bCIgICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTQ5Nn19CiAgICAgICAgICAsIGFjdGl2ZVRhYiA9PT0gMCAmJiBSZWFjdC5jcmVhdGVFbGVtZW50KFNlbnNlT2ZTY2FsZVRhYiwge19fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxNDk3fX0gKQogICAgICAgICAgLCBhY3RpdmVUYWIgPT09IDEgJiYgUmVhY3QuY3JlYXRlRWxlbWVudChVbmRlcnN0YW5kaW5nQ29udmVyc2lvbnNUYWIsIHtfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTQ5OH19ICkKICAgICAgICAgICwgYWN0aXZlVGFiID09PSAyICYmIFJlYWN0LmNyZWF0ZUVsZW1lbnQoVW5pdENhbmNlbGxhdGlvblRhYiwge19fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxNDk5fX0gKQogICAgICAgICAgLCBhY3RpdmVUYWIgPT09IDMgJiYgUmVhY3QuY3JlYXRlRWxlbWVudChQcmFjdGljZVRhYiwge19fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxNTAwfX0gKQogICAgICAgICkKCiAgICAgICAgLCBSZWFjdC5jcmVhdGVFbGVtZW50KCdmb290ZXInLCB7IGNsYXNzTmFtZTogInRleHQtY2VudGVyIG10LTggdGV4dC1ncmF5LTYwMCB0ZXh0LXNtIiAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDE1MDN9fSwgIlVuaXQgQ29udmVyc2lvbiBUdXRvciBBcHAiCgogICAgICAgICkKICAgICAgKQogICAgKQ0KICApOw0KfTsNCg0KLy8gRXJyb3IgQm91bmRhcnkNCmNsYXNzIEVycm9yQm91bmRhcnkgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQgew0KICBjb25zdHJ1Y3Rvcihwcm9wcykgew0KICAgIHN1cGVyKHByb3BzKTsNCiAgICB0aGlzLnN0YXRlID0geyBoYXNFcnJvcjogZmFsc2UsIGVycm9yOiBudWxsIH07DQogIH0NCg0KICBzdGF0aWMgZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yKGVycm9yKSB7DQogICAgcmV0dXJuIHsgaGFzRXJyb3I6IHRydWUsIGVycm9yOiBlcnJvciB9Ow0KICB9DQoNCiAgY29tcG9uZW50RGlkQ2F0Y2goZXJyb3IsIGVycm9ySW5mbykgew0KICAgIGNvbnNvbGUuZXJyb3IoIlVuY2F1Z2h0IGVycm9yOiIsIGVycm9yLCBlcnJvckluZm8pOw0KICB9DQoNCiAgcmVuZGVyKCkgew0KICAgIGlmICh0aGlzLnN0YXRlLmhhc0Vycm9yKSB7DQogICAgICByZXR1cm4gKA0KICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7IGNsYXNzTmFtZTogIm1pbi1oLXNjcmVlbiBiZy1ncmF5LTkwMCB0ZXh0LWdyYXktMTAwIHAtNiBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciIgICAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxNTI5fX0KICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzc05hbWU6ICJiZy1yZWQtOTAwLzUwIGJvcmRlci0yIGJvcmRlci1yZWQtNTAwIHAtOCByb3VuZGVkLWxnIG1heC13LTJ4bCIgICAgICwgX19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDE1MzB9fQogICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2gxJywgeyBjbGFzc05hbWU6ICJ0ZXh0LTN4bCBmb250LWJvbGQgbWItNCB0ZXh0LXJlZC0zMDAiICAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTUzMX19LCAiU29tZXRoaW5nIHdlbnQgd3JvbmcuIiAgKQogICAgICAgICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3AnLCB7IGNsYXNzTmFtZTogInRleHQtbGcgdGV4dC1ncmF5LTIwMCBtYi02IiAgLCBfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTUzMn19LCAiQW4gZXJyb3Igb2NjdXJyZWQgaW4gdGhlIGFwcGxpY2F0aW9uLiBQbGVhc2UgdHJ5IHJlZnJlc2hpbmcgdGhlIHBhZ2UuIiAgICAgICAgICApCiAgICAgICAgICAgICwgUmVhY3QuY3JlYXRlRWxlbWVudCgncHJlJywgeyBjbGFzc05hbWU6ICJiZy1ncmF5LTgwMCBwLTQgcm91bmRlZC1sZyB0ZXh0LXJlZC0yMDAgb3ZlcmZsb3cteC1hdXRvIiAgICAsIF9fc2VsZjogdGhpcywgX19zb3VyY2U6IHtmaWxlTmFtZTogX2pzeEZpbGVOYW1lLCBsaW5lTnVtYmVyOiAxNTMzfX0KICAgICAgICAgICAgICAsIHRoaXMuc3RhdGUuZXJyb3IgJiYgdGhpcy5zdGF0ZS5lcnJvci50b1N0cmluZygpCiAgICAgICAgICAgICkKICAgICAgICAgICkKICAgICAgICApDQogICAgICApOw0KICAgIH0NCiAgICByZXR1cm4gdGhpcy5wcm9wcy5jaGlsZHJlbjsNCiAgfQ0KfQ0KDQovLyBGaW5hbCBBcHAgZXhwb3J0DQpleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBBcHAoKSB7DQogIHJldHVybiAoDQogICAgUmVhY3QuY3JlYXRlRWxlbWVudChFcnJvckJvdW5kYXJ5LCB7X19zZWxmOiB0aGlzLCBfX3NvdXJjZToge2ZpbGVOYW1lOiBfanN4RmlsZU5hbWUsIGxpbmVOdW1iZXI6IDE1NDd9fQogICAgICAsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoVW5pdENvbnZlcnNpb25BcHAsIHtfX3NlbGY6IHRoaXMsIF9fc291cmNlOiB7ZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwgbGluZU51bWJlcjogMTU0OH19ICkKICAgICkNCiAgKTsNCn0NCg0KLy8gQ3VzdG9tIENTUyBmb3Igc2xpZGVyIHRodW1iIGFuZCB0byBoaWRlIG51bWJlciBpbnB1dCBzcGlubmVycw0KY29uc3Qgc3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpOw0Kc3R5bGUudGV4dENvbnRlbnQgPSBgDQogIC8qIC0tLSBTbGlkZXIgVGh1bWIgU3R5bGVzIC0tLSAqLw0KICBpbnB1dFt0eXBlPXJhbmdlXTo6LXdlYmtpdC1zbGlkZXItdGh1bWIgew0KICAgIC13ZWJraXQtYXBwZWFyYW5jZTogbm9uZTsNCiAgICBhcHBlYXJhbmNlOiBub25lOw0KICAgIHdpZHRoOiAyMHB4Ow0KICAgIGhlaWdodDogMjBweDsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1zbGlkZXItdGh1bWItYmcsICMzYjgyZjYpOw0KICAgIGJvcmRlcjogMnB4IHNvbGlkIHZhcigtLXNsaWRlci10aHVtYi1ib3JkZXIsICMxZTNhOGEpOw0KICAgIGJvcmRlci1yYWRpdXM6IDUwJTsNCiAgICBjdXJzb3I6IGdyYWI7DQogICAgbWFyZ2luLXRvcDogLTZweDsgLyogQ2VudGVyIDIwcHggdGh1bWIgb24gOHB4IHRyYWNrICggKDgtMjApLzIgPSAtNiApICovDQogICAgdHJhbnNpdGlvbjogYmFja2dyb3VuZC1jb2xvciAwLjJzOw0KICAgIHotaW5kZXg6IDIwOyAvKiBFbnN1cmUgdGh1bWIgaXMgYWJvdmUgdHJhY2sgKi8NCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7IC8qIEVuc3VyZSB6LWluZGV4IGlzIGFwcGxpZWQgKi8NCiAgfQ0KICBpbnB1dFt0eXBlPXJhbmdlXTo6LW1vei1yYW5nZS10aHVtYiB7DQogICAgd2lkdGg6IDIwcHg7DQogICAgaGVpZ2h0OiAyMHB4Ow0KICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXNsaWRlci10aHVtYi1iZywgIzNiODJmNik7DQogICAgYm9yZGVyOiAycHggc29saWQgdmFyKC0tc2xpZGVyLXRodW1iLWJvcmRlciwgIzFlM2E4YSk7DQogICAgYm9yZGVyLXJhZGl1czogNTAlOw0KICAgIGN1cnNvcjogZ3JhYjsNCiAgICB6LWluZGV4OiAyMDsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogIH0NCiAgaW5wdXRbdHlwZT1yYW5nZV06YWN0aXZlOjotd2Via2l0LXNsaWRlci10aHVtYiB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogIzYwYTVmYTsgLyogQSBsaWdodGVyIGJsdWUgZm9yIGFjdGl2ZSBzdGF0ZSAqLw0KICAgIGN1cnNvcjogZ3JhYmJpbmc7DQogIH0NCiAgaW5wdXRbdHlwZT1yYW5nZV06YWN0aXZlOjotbW96LXJhbmdlLXRodW1iIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjNjBhNWZhOw0KICAgIGN1cnNvcjogZ3JhYmJpbmc7DQogIH0NCg0KICAvKiAtLS0gSGlkZSBOdW1iZXIgSW5wdXQgU3Bpbm5lcnMgLS0tICovDQogIC5wcmFjdGljZS1pbnB1dDo6LXdlYmtpdC1vdXRlci1zcGluLWJ1dHRvbiwNCiAgLnByYWN0aWNlLWlucHV0Ojotd2Via2l0LWlubmVyLXNwaW4tYnV0dG9uIHsNCiAgICAtd2Via2l0LWFwcGVhcmFuY2U6IG5vbmU7DQogICAgbWFyZ2luOiAwOw0KICB9DQogIC5wcmFjdGljZS1pbnB1dFt0eXBlPW51bWJlcl0gew0KICAgIC1tb3otYXBwZWFyYW5jZTogdGV4dGZpZWxkOw0KICB9DQpgOw0KZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzdHlsZSk7DQoNCgppbXBvcnQgeyBjcmVhdGVSb290IH0gZnJvbSAicmVhY3QtZG9tL2NsaWVudCI7CgogICAgZXhwb3J0IGNvbnN0IF9SZWFjdCA9IFJlYWN0OwogICAgZXhwb3J0IGNvbnN0IF9jcmVhdGVSb290ID0gY3JlYXRlUm9vdDsKICA=";

      const binaryString = atob(encodedReactCode);
      const bytes = new Uint8Array(binaryString.length);
      for (let i = 0; i < binaryString.length; i++) {
        bytes[i] = binaryString.charCodeAt(i);
      }
      const decodedReactCode = new TextDecoder("utf-8").decode(bytes);

      const blob = new Blob([decodedReactCode], {
        type: "application/javascript",
      });
      const moduleUrl = URL.createObjectURL(blob);

      import(moduleUrl)
        .then((module) => {
          const rootElement = document.getElementById("root");
          if (
            rootElement &&
            module.default &&
            typeof module.default === "function"
          ) {
            const React = module._React;
            const createRoot = module._createRoot;
            const root = createRoot(rootElement);
            root.render(React.createElement(module.default));
          } else {
            console.error(
              "Failed to mount React app: root element or module default export is not valid"
            );
          }

          URL.revokeObjectURL(moduleUrl);
        })
        .catch((error) => {
          console.error("Error importing module:", error);
          URL.revokeObjectURL(moduleUrl);
        });
    </script>
  </body>
</html>
